LavaPack.loadBundle([[2460,{"../fsm.cjs":2442,"../logging.cjs":2449,"../utils.cjs":2473,"./Timer.cjs":2461,"./constants.cjs":2462,"./location/index.cjs":2465,"./registry/index.cjs":2469,"./selectors.cjs":2472,"@metamask/base-controller":1222,"@metamask/permission-controller":2260,"@metamask/rpc-errors":2384,"@metamask/snaps-rpc-methods":2507,"@metamask/snaps-sdk":2563,"@metamask/snaps-utils":2677,"@metamask/utils":2799,"@xstate/fsm":3267,"async-mutex":3582,nanoid:4718,semver:5252},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapController=n.SNAP_APPROVAL_RESULT=n.SNAP_APPROVAL_UPDATE=n.SNAP_APPROVAL_INSTALL=n.controllerName=void 0;const l=e("@metamask/base-controller"),u=e("@metamask/permission-controller"),d=e("@metamask/rpc-errors"),p=e("@metamask/snaps-rpc-methods"),h=e("@metamask/snaps-sdk"),m=e("@metamask/snaps-utils"),f=e("@metamask/utils"),g=e("@xstate/fsm"),y=e("async-mutex"),v=e("nanoid"),b=e("semver"),S=e("./constants.cjs"),w=e("./location/index.cjs"),T=e("./registry/index.cjs"),_=e("./selectors.cjs"),k=e("./Timer.cjs"),E=e("../fsm.cjs"),P=e("../logging.cjs"),A=e("../utils.cjs");n.controllerName="SnapController",n.SNAP_APPROVAL_INSTALL="wallet_installSnap",n.SNAP_APPROVAL_UPDATE="wallet_updateSnap",n.SNAP_APPROVAL_RESULT="wallet_installSnapResult";const C=new Set(["initialPermissions","id","version","enabled","blocked"]),M={snaps:{},snapStates:{},unencryptedSnapStates:{}};function O(e){return Object.keys(e).reduce((t,n)=>(C.has(n)&&(t[n]=e[n]),t),{})}var I=new WeakMap,j=new WeakMap,R=new WeakMap,x=new WeakMap,N=new WeakMap,D=new WeakMap,L=new WeakMap,F=new WeakMap,U=new WeakMap,$=new WeakMap,B=new WeakMap,H=new WeakMap,G=new WeakMap,q=new WeakMap,V=new WeakMap,W=new WeakMap,Y=new WeakMap,K=new WeakMap,z=new WeakMap,J=new WeakMap,Z=new WeakSet,X=new WeakMap;class Q extends l.BaseController{constructor({closeAllConnections:e,messenger:t,state:l,dynamicPermissions:u=["eth_accounts"],environmentEndowmentPermissions:d=[],excludedPermissions:p={},idleTimeCheckInterval:g=(0,f.inMilliseconds)(5,f.Duration.Second),maxIdleTime:y=(0,f.inMilliseconds)(30,f.Duration.Second),maxRequestTime:v=(0,f.inMilliseconds)(60,f.Duration.Second),fetchFunction:b=globalThis.fetch.bind(undefined),featureFlags:T={},detectSnapLocation:_=w.detectSnapLocation,preinstalledSnaps:k=null,encryptor:E,getMnemonicSeed:P,getFeatureFlags:C=()=>({}),clientCryptography:O,trackEvent:Q}){var ae,ie,re;super({messenger:t,metadata:{snapStates:{persist:!0,anonymous:!1},unencryptedSnapStates:{persist:!0,anonymous:!1},snaps:{persist:e=>Object.values(e).filter(e=>e.status!==m.SnapStatus.Installing).map(e=>({...e,status:m.SnapStatus.Stopped})).reduce((e,t)=>(e[t.id]=t,e),{}),anonymous:!1}},name:n.controllerName,state:{...M,...l}}),i(ie=this,re=Z),re.add(ie),a(this,I,void 0),a(this,j,void 0),a(this,R,void 0),a(this,x,void 0),a(this,N,void 0),a(this,D,void 0),a(this,L,void 0),a(this,F,void 0),s(this,"maxRequestTime",void 0),a(this,U,void 0),a(this,$,void 0),a(this,B,void 0),a(this,H,void 0),a(this,G,void 0),a(this,q,void 0),a(this,V,void 0),a(this,W,void 0),a(this,Y,void 0),a(this,K,void 0),a(this,z,void 0),a(this,J,void 0),a(this,X,(0,A.debouncePersistState)((e,t,n)=>{c(Z,this,We).call(this,e).stateMutex.runExclusive(async()=>{const s=await c(Z,this,ge).call(this,e,t,n);return n?this.update(t=>{t.snapStates[e]=s}):this.update(t=>{t.unencryptedSnapStates[e]=s})}).catch(m.logError)},S.STATE_DEBOUNCE_TIMEOUT)),o(I,this,e),o(j,this,u),o(R,this,d),o(x,this,p),o(N,this,T),o(D,this,b),o(L,this,g),o(F,this,y),this.maxRequestTime=v,o(G,this,_),o(U,this,E),o($,this,P),o(B,this,C),o(H,this,O),o(K,this,k),this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),o(V,this,new Map),o(q,this,new Map),o(z,this,Q),c(Z,this,se).call(this),this.messagingSystem.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messagingSystem.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messagingSystem.subscribe("SnapController:snapInstalled",({id:e},t)=>{c(Z,this,tt).call(this,t,e,m.HandlerType.OnInstall).catch(t=>{(0,m.logError)(`Error when calling \`onInstall\` lifecycle hook for snap "${e}": ${(0,h.getErrorMessage)(t)}`)})}),this.messagingSystem.subscribe("SnapController:snapUpdated",({id:e},t,n)=>{c(Z,this,tt).call(this,n,e,m.HandlerType.OnUpdate).catch(t=>{(0,m.logError)(`Error when calling \`onUpdate\` lifecycle hook for snap "${e}": ${(0,h.getErrorMessage)(t)}`)})}),this.messagingSystem.subscribe("KeyringController:lock",c(Z,this,nt).bind(this)),c(Z,this,ee).call(this),c(Z,this,te).call(this),Object.values((null===(ae=this.state)||void 0===ae?void 0:ae.snaps)??{}).forEach(e=>c(Z,this,Ye).call(this,e.id)),r(K,this)&&c(Z,this,ne).call(this,r(K,this)),o(J,this,(0,A.throttleTracking)((e,t,n,s)=>{const a=this.messagingSystem.call("SnapsRegistry:getMetadata",e);r(z,this).call(this,{event:"Snap Export Used",category:"Snaps",properties:{snap_id:e,export:t,snap_category:null==a?void 0:a.category,success:n,origin:s}})}))}init(){c(Z,this,et).call(this,S.METAMASK_ORIGIN,m.HandlerType.OnStart)}async updateBlockedSnaps(){c(Z,this,ce).call(this),await this.messagingSystem.call("SnapsRegistry:update");const e=await this.messagingSystem.call("SnapsRegistry:get",Object.values(this.state.snaps).reduce((e,t)=>(e[t.id]={version:t.version,checksum:t.manifest.source.shasum},e),{}));await Promise.all(Object.entries(e).map(async([e,{status:t,reason:n}])=>t===T.SnapsRegistryStatus.Blocked?c(Z,this,ae).call(this,e,n):c(Z,this,ie).call(this,e)))}_onUnhandledSnapError(e,t){(0,m.logError)(`Unhandled error from "${e}":`,t),this.stopSnap(e,m.SnapStatusEvents.Crash).catch(e=>{(0,m.logError)(e)})}_onOutboundRequest(e){const t=c(Z,this,We).call(this,e);t.pendingInboundRequests.filter(e=>"running"===e.timer.status).forEach(e=>e.timer.pause()),t.pendingOutboundRequests+=1}_onOutboundResponse(e){const t=c(Z,this,We).call(this,e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.filter(e=>"paused"===e.timer.status).forEach(e=>e.timer.resume())}async startSnap(e){c(Z,this,ce).call(this);const t=this.state.snaps[e];if(!t.enabled)throw new Error(`Snap "${e}" is disabled.`);await c(Z,this,Ee).call(this,{snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update(t=>{t.snaps[e].enabled=!0}),this.messagingSystem.publish("SnapController:snapEnabled",this.getTruncatedExpect(e))}async disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);this.update(t=>{t.snaps[e].enabled=!1}),this.isRunning(e)&&await this.stopSnap(e,m.SnapStatusEvents.Stop),this.messagingSystem.publish("SnapController:snapDisabled",this.getTruncatedExpect(e))}async stopSnap(e,t=m.SnapStatusEvents.Stop){const n=c(Z,this,Ve).call(this,e);if(!n)throw new Error(`The snap "${e}" is not running.`);if(n.stopPromise)return void await n.stopPromise;const{promise:s,resolve:a}=(0,f.createDeferredPromise)();n.stopPromise=s;try{var i;if(this.isRunning(e))null===(i=r(I,this))||void 0===i||i.call(this,e),await c(Z,this,de).call(this,e)}finally{n.lastRequest=null,n.pendingInboundRequests=[],n.pendingOutboundRequests=0,n.stopPromise=null,this.isRunning(e)&&c(Z,this,ue).call(this,e,t),a()}}async stopAllSnaps(e=m.SnapStatusEvents.Stop){const t=Object.values(this.state.snaps).filter(e=>this.isRunning(e.id)).map(async t=>this.stopSnap(t.id,e));await Promise.allSettled(t)}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,f.assert)(t!==undefined,new Error(`Snap "${e}" not found.`)),t}getTruncated(e){const t=this.get(e);return t?O(t):null}getTruncatedExpect(e){return O(this.getExpect(e))}async updateSnapState(e,t,n){const s=c(Z,this,We).call(this,e);n?s.state=t:s.unencryptedState=t,r(X,this).call(this,e,t,n)}clearSnapState(e,t){const n=c(Z,this,We).call(this,e);t?n.state=null:n.unencryptedState=null,r(X,this).call(this,e,null,t)}async getSnapState(e,t){const n=c(Z,this,We).call(this,e);return await n.getStateMutex.runExclusive(async()=>{const s=t?n.state:n.unencryptedState;if(s!==undefined)return s;const a=t?this.state.snapStates[e]:this.state.unencryptedSnapStates[e];if(null===a||a===undefined)return null;if(!t){const e=JSON.parse(a);return n.unencryptedState=e,e}const i=await c(Z,this,me).call(this,e,a);return n.state=i,i})}async getSnapFile(e,t,n=h.AuxiliaryFileEncoding.Base64){var s;const a=this.getExpect(e),i=(0,m.normalizeRelative)(t),r=null===(s=a.auxiliaryFiles)||void 0===s||null===(s=s.find(e=>e.path===i))||void 0===s?void 0:s.value;if(!r)return null;const o=await(0,m.encodeAuxiliaryFile)(r,n);return(0,f.assert)(o.length<m.MAX_FILE_SIZE,`Failed to encode static file to "${n}": Static files must be less than 64 MB when encoded.`),o}isMinimumPlatformVersion(e,t){const n=this.getExpect(e),{platformVersion:s}=n.manifest;return!!s&&(0,b.gte)(s,t)}async clearState(){const e=Object.keys(this.state.snaps);await this.stopAllSnaps(),e.forEach(e=>c(Z,this,Se).call(this,e)),this.update(e=>{e.snaps={},e.snapStates={},e.unencryptedSnapStates={}}),r(q,this).clear(),r(V,this).clear(),r(K,this)&&c(Z,this,ne).call(this,r(K,this))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");e.forEach(e=>{const t=this.getExpect(e);(0,f.assert)(!1!==t.removable,`${e} is not removable.`)}),await Promise.all(e.map(async e=>{const t=this.getExpect(e),n=this.getTruncatedExpect(e);await this.disableSnap(e),c(Z,this,Se).call(this,e),c(Z,this,be).call(this,e),r(q,this).delete(e),this.update(t=>{delete t.snaps[e],delete t.snapStates[e],delete t.unencryptedSnapStates[e]}),t.status!==m.SnapStatus.Installing&&this.messagingSystem.publish("SnapController:snapUninstalled",n)}))}removeSnapFromSubject(e,t){var n,s;const a=this.messagingSystem.call("PermissionController:getPermissions",e),i=null==a||null===(n=a[p.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);if(!i)return;if(Boolean(null===(s=i.value)||void 0===s?void 0:s[t])){const n={...i.value};delete n[t],Object.keys(n).length>0?this.messagingSystem.call("PermissionController:updateCaveat",e,p.WALLET_SNAP_PERMISSION_KEY,m.SnapCaveatType.SnapIds,n):this.messagingSystem.call("PermissionController:revokePermissions",{[e]:[p.WALLET_SNAP_PERMISSION_KEY]})}}revokeDynamicSnapPermissions(e,t){(0,f.assert)(t.every(e=>r(j,this).includes(e)),"Non-dynamic permissions cannot be revoked"),this.messagingSystem.call("PermissionController:revokePermissions",{[e]:t})}incrementActiveReferences(e){c(Z,this,We).call(this,e).activeReferences+=1}decrementActiveReferences(e){const t=c(Z,this,We).call(this,e);(0,f.assert)(t.activeReferences>0,"SnapController reference management is in an invalid state."),t.activeReferences-=1}getAllSnaps(){return Object.values(this.state.snaps).map(O)}getRunnableSnaps(){return(0,_.getRunnableSnaps)(this.getAllSnaps())}getPermittedSnaps(e){var t;const n=(null===(t=(this.messagingSystem.call("PermissionController:getPermissions",e)??{})[p.WALLET_SNAP_PERMISSION_KEY])||void 0===t||null===(t=t.caveats)||void 0===t||null===(t=t.find(e=>e.type===m.SnapCaveatType.SnapIds))||void 0===t?void 0:t.value)??{};return Object.keys(n).reduce((e,t)=>{const n=this.get(t),s=this.getTruncated(t);return s&&(null==n?void 0:n.status)!==m.SnapStatus.Installing&&(e[t]=s),e},{})}async installSnaps(e,t){c(Z,this,ce).call(this);const n={},s=Object.keys(t),a=[],i=[];try{for(const[s,{version:o}]of Object.entries(t)){(0,m.assertIsValidSnapId)(s);const[t,l]=(0,m.resolveVersionRange)(o);if(t)throw d.rpcErrors.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${o}".`);const u=r(G,this).call(this,s,{versionRange:l,fetch:r(D,this),allowLocal:r(N,this).allowLocalSnaps,resolveVersion:async e=>r(N,this).requireAllowlist?await c(Z,this,_e).call(this,s,e):e}),p=this.has(s)&&!u.shouldAlwaysReload;if(p&&c(Z,this,Qe).call(this,s,l)){const e=this.getExpect(s);a.push({snapId:s,oldVersion:e.version});let t=c(Z,this,Be).call(this,s);if(t!==undefined)throw new Error("This snap is already being updated.");t=c(Z,this,He).call(this,s),t.newVersion=l}else p||i.push(s);n[s]=await this.processRequestedSnap(e,s,u,l)}i.forEach(t=>this.messagingSystem.publish("SnapController:snapInstalled",this.getTruncatedExpect(t),e,!1)),a.forEach(({snapId:t,oldVersion:n})=>this.messagingSystem.publish("SnapController:snapUpdated",this.getTruncatedExpect(t),n,e,!1)),s.forEach(e=>r(V,this).delete(e))}catch(e){const t=i.filter(e=>this.has(e));await this.removeSnaps(t);const n=[...r(V,this).keys()],s=a.map(({snapId:e})=>e).filter(e=>n.includes(e));throw await c(Z,this,qe).call(this,s),e}return n}async processRequestedSnap(e,t,s,a){const i=this.getTruncated(t);if(i&&!s.shouldAlwaysReload)return(0,f.satisfiesVersionRange)(i.version,a)?i:await this.updateSnap(e,t,s,a,!1);c(Z,this,oe).call(this);let r=c(Z,this,we).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_INSTALL});this.messagingSystem.publish("SnapController:snapInstallStarted",t,e,!1),i&&this.isRunning(t)&&await this.stopSnap(t,m.SnapStatusEvents.Stop),i&&s.shouldAlwaysReload&&c(Z,this,Se).call(this,t);try{const{sourceCode:i}=await c(Z,this,ke).call(this,{origin:e,id:t,location:s,versionRange:a});await this.authorize(t,r),r=c(Z,this,we).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),await c(Z,this,Ee).call(this,{snapId:t,sourceCode:i});const o=this.getTruncatedExpect(t);return c(Z,this,Te).call(this,r.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL}),o}catch(s){(0,m.logError)(`Error when adding ${t}.`,s);const a=s instanceof Error?s.message:s.toString();throw c(Z,this,Te).call(this,r.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL,error:a}),this.messagingSystem.publish("SnapController:snapInstallFailed",t,e,!1,a),s}}async updateSnap(e,t,s,a=m.DEFAULT_REQUESTED_SNAP_VERSION,i=!0){c(Z,this,oe).call(this),c(Z,this,ce).call(this);const r=this.getExpect(t);if(r.preinstalled)throw new Error("Preinstalled Snaps cannot be manually updated.");if(!(0,f.isValidSemVerRange)(a))throw new Error(`Received invalid snap version range: "${a}".`);let o=c(Z,this,we).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_UPDATE});try{this.messagingSystem.publish("SnapController:snapInstallStarted",t,e,!0);const l=r.manifest,u=await(0,A.fetchSnap)(t,s),{sourceCode:h,manifest:g}=u,y=g.result,v=y.version;if(!(0,f.gtVersion)(v,r.version))throw d.rpcErrors.invalidParams(`Snap "${t}@${r.version}" is already installed. Couldn't update to a version inside requested "${a}" range.`);if(!(0,f.satisfiesVersionRange)(v,a))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${v}" which doesn't satisfy requested version range "${a}".`);await c(Z,this,re).call(this,t,{version:v,checksum:y.source.shasum,permissions:y.initialPermissions,platformVersion:y.platformVersion});const b=(0,p.processSnapPermissions)(y.initialPermissions);c(Z,this,Ce).call(this,b);const{newPermissions:S,unusedPermissions:w,approvedPermissions:T}=c(Z,this,Ke).call(this,t,b),{newConnections:_,unusedConnections:k,approvedConnections:E}=c(Z,this,Je).call(this,t,l.initialConnections??{},y.initialConnections??{});c(Z,this,Te).call(this,o.id,{permissions:S,newVersion:y.version,newPermissions:S,approvedPermissions:T,unusedPermissions:w,newConnections:_,unusedConnections:k,approvedConnections:E,loading:!1});const{permissions:P,...C}=await o.promise;o=c(Z,this,we).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),this.isRunning(t)&&await this.stopSnap(t,m.SnapStatusEvents.Stop),c(Z,this,ue).call(this,t,m.SnapStatusEvents.Update),c(Z,this,Ae).call(this,{origin:e,id:t,files:u,isUpdate:!0}),c(Z,this,Xe).call(this,{snapId:t,unusedPermissions:w,newPermissions:P,requestData:C}),y.initialConnections&&c(Z,this,ye).call(this,t,l.initialConnections??null,y.initialConnections);const M=c(Z,this,Be).call(this,t);M!==undefined&&(M.permissions.revoked=w,M.permissions.granted=P,M.permissions.requestData=C);const O=h.toString();(0,f.assert)("string"==typeof O&&O.length>0,`Invalid source code for snap "${t}".`);try{await c(Z,this,Ee).call(this,{snapId:t,sourceCode:O})}catch{throw new Error(`Snap ${t} crashed with updated source code.`)}const I=this.getTruncatedExpect(t);return i&&this.messagingSystem.publish("SnapController:snapUpdated",I,r.version,e,!1),c(Z,this,Te).call(this,o.id,{loading:!1,type:n.SNAP_APPROVAL_UPDATE}),I}catch(s){(0,m.logError)(`Error when updating ${t},`,s);const a=s instanceof Error?s.message:s.toString();throw c(Z,this,Te).call(this,o.id,{loading:!1,error:a,type:n.SNAP_APPROVAL_UPDATE}),this.messagingSystem.publish("SnapController:snapInstallFailed",t,e,!0,a),s}}async authorize(e,t){(0,P.log)(`Authorizing snap: ${e}`);const n=this.state.snaps[e],{initialPermissions:s,initialConnections:a}=n;try{const i=(0,p.processSnapPermissions)(s);c(Z,this,Ce).call(this,i),c(Z,this,Te).call(this,t.id,{loading:!1,connections:a??{},permissions:i});const{permissions:r,...o}=await t.promise;c(Z,this,Xe).call(this,{snapId:e,newPermissions:r,requestData:o}),n.manifest.initialConnections&&c(Z,this,ye).call(this,e,null,n.manifest.initialConnections)}finally{c(Z,this,We).call(this,e).installPromise=null}}destroy(){super.destroy(),r(W,this)&&clearTimeout(r(W,this)),this.messagingSystem.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messagingSystem.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messagingSystem.clearEventSubscriptions("SnapController:snapInstalled"),this.messagingSystem.clearEventSubscriptions("SnapController:snapUpdated")}async handleRequest({snapId:e,origin:t,handler:n,request:s}){c(Z,this,ce).call(this),(0,f.assert)(t===S.METAMASK_ORIGIN||(0,m.isValidUrl)(t),"'origin' must be a valid URL or 'metamask'.");const a={jsonrpc:"2.0",id:(0,v.nanoid)(),...s};(0,f.assertIsJsonRpcRequest)(a);const i=p.handlerEndowments[n];(0,f.assert)("string"==typeof i||null===i,"'permissionName' must be either a string or null.");const r=this.messagingSystem.call("PermissionController:getPermissions",e);if(!(null===i||r&&(0,f.hasProperty)(r,i)))throw new Error(`Snap "${e}" is not permitted to use "${i}".`);const o=i?r[i]:undefined;if(i===p.SnapEndowments.Rpc||i===p.SnapEndowments.Keyring){(0,f.assert)(o);const n=this.messagingSystem.call("SubjectMetadataController:getSubjectMetadata",t),s=i===p.SnapEndowments.Rpc?(0,p.getRpcCaveatOrigins)(o):(0,p.getKeyringCaveatOrigins)(o);if((0,f.assert)(s),!(0,m.isOriginAllowed)(s,(null==n?void 0:n.subjectType)??u.SubjectType.Website,t))throw new Error(`Snap "${e}" is not permitted to handle requests from "${t}".`)}if(t!==S.METAMASK_ORIGIN&&S.CLIENT_ONLY_HANDLERS.includes(n))throw new Error(`"${n}" can only be invoked by MetaMask.`);if(!this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);if(this.state.snaps[e].status===m.SnapStatus.Installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);const l=c(Z,this,Oe).call(this,o),d=c(Z,this,We).call(this,e);if(d.stopPromise&&await d.stopPromise,!this.isRunning(e)){d.startPromise||(d.startPromise=this.startSnap(e));try{await d.startPromise}finally{d.startPromise=null}}const h=c(Z,this,Le).call(this,e,n,a),g=new k.Timer(l);c(Z,this,Ue).call(this,e,h.id,g);const y=this.messagingSystem.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:n,request:h});try{const s=await(0,A.withTimeout)(y,g);if(s===A.hasTimedOut){const t=null!==d.stopPromise||!this.isRunning(e);throw new Error(t?`${e} was stopped and the request was cancelled. This is likely because the Snap crashed.`:`${e} failed to respond to the request in time.`)}await c(Z,this,Fe).call(this,e,n,s);const a=await c(Z,this,Re).call(this,e,n,h,s);return c(Z,this,$e).call(this,e,h.id,n,t,!0),a}catch(s){c(Z,this,$e).call(this,e,h.id,n,t,!1);const[a,i]=(0,m.unwrapError)(s),r=null!==d.stopPromise||!this.isRunning(e);throw i||(r||(0,m.logError)(`"${e}" crashed due to an unhandled error:`,a),await this.stopSnap(e,m.SnapStatusEvents.Crash)),a}}setClientActive(e){e?c(Z,this,et).call(this,S.METAMASK_ORIGIN,m.HandlerType.OnActive):c(Z,this,et).call(this,S.METAMASK_ORIGIN,m.HandlerType.OnInactive)}}function ee(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:m.SnapStatus.Installing,states:{[m.SnapStatus.Installing]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e}}},[m.SnapStatus.Updating]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Stop]:m.SnapStatus.Stopped}},[m.SnapStatus.Running]:{on:{[m.SnapStatusEvents.Stop]:m.SnapStatus.Stopped,[m.SnapStatusEvents.Crash]:m.SnapStatus.Crashed}},[m.SnapStatus.Stopped]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Update]:m.SnapStatus.Updating}},[m.SnapStatus.Crashed]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Update]:m.SnapStatus.Updating}}}};o(Y,this,(0,g.createMachine)(t)),(0,E.validateMachine)(r(Y,this))}function te(){this.messagingSystem.registerActionHandler(`${n.controllerName}:init`,(...e)=>this.init(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:clearSnapState`,(...e)=>this.clearSnapState(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:get`,(...e)=>this.get(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getSnapState`,async(...e)=>this.getSnapState(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:handleRequest`,async(...e)=>this.handleRequest(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:has`,(...e)=>this.has(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:updateBlockedSnaps`,async()=>this.updateBlockedSnaps()),this.messagingSystem.registerActionHandler(`${n.controllerName}:updateSnapState`,async(...e)=>this.updateSnapState(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:enable`,(...e)=>this.enableSnap(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:disable`,async(...e)=>this.disableSnap(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:remove`,async(...e)=>this.removeSnap(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getPermitted`,(...e)=>this.getPermittedSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:install`,async(...e)=>this.installSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getAll`,(...e)=>this.getAllSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getRunnableSnaps`,(...e)=>this.getRunnableSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:incrementActiveReferences`,(...e)=>this.incrementActiveReferences(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:decrementActiveReferences`,(...e)=>this.decrementActiveReferences(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:disconnectOrigin`,(...e)=>this.removeSnapFromSubject(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:revokeDynamicPermissions`,(...e)=>this.revokeDynamicSnapPermissions(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getFile`,async(...e)=>this.getSnapFile(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:stopAllSnaps`,async(...e)=>this.stopAllSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:isMinimumPlatformVersion`,(...e)=>this.isMinimumPlatformVersion(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:setClientActive`,(...e)=>this.setClientActive(...e))}function ne(e){for(const{snapId:n,manifest:s,files:a,removable:i,hidden:r,hideSnapBranding:o}of e){var t;const e=this.get(n),l=e!==undefined,u=l&&(0,f.gtVersion)(s.version,e.version);if(l&&(!u||!0!==e.preinstalled))continue;const d=new m.VirtualFile({path:m.NpmSnapFileNames.Manifest,value:JSON.stringify(s),result:s}),h=a.map(({path:e,value:t})=>new m.VirtualFile({value:t,path:e})),{filePath:g,iconPath:y}=s.source.location.npm,v=h.find(e=>e.path===g),b=y?h.find(e=>e.path===y):undefined;(0,f.assert)(v,"Source code not provided for preinstalled snap."),(0,f.assert)(!y||y&&b,"Icon not provided for preinstalled snap."),(0,f.assert)(s.source.files===undefined,"Auxiliary files are not currently supported for preinstalled snaps.");const w=(null===(t=s.source.locales)||void 0===t?void 0:t.map(e=>h.find(t=>t.path===e)))??[],T=(0,m.getValidatedLocalizationFiles)(w.filter(Boolean));(0,f.assert)(w.length===T.length,"Missing localization files for preinstalled snap.");const _={manifest:d,sourceCode:v,svgIcon:b,auxiliaryFiles:[],localizationFiles:T};c(Z,this,Ae).call(this,{id:n,origin:S.METAMASK_ORIGIN,files:_,removable:i,hidden:r,hideSnapBranding:o,preinstalled:!0});const k=(0,p.processSnapPermissions)(s.initialPermissions);c(Z,this,Ce).call(this,k);const{newPermissions:E,unusedPermissions:P}=c(Z,this,Ke).call(this,n,k);c(Z,this,Xe).call(this,{snapId:n,newPermissions:E,unusedPermissions:P}),s.initialConnections&&c(Z,this,ye).call(this,n,(null==e?void 0:e.initialConnections)??null,s.initialConnections),this.update(e=>{e.snaps[n].status=m.SnapStatus.Stopped}),c(Z,this,Ye).call(this,n),u?this.messagingSystem.publish("SnapController:snapUpdated",this.getTruncatedExpect(n),e.version,S.METAMASK_ORIGIN,!0):this.messagingSystem.publish("SnapController:snapInstalled",this.getTruncatedExpect(n),S.METAMASK_ORIGIN,!0)}}function se(){o(W,this,setTimeout(()=>{c(Z,this,le).call(this).catch(e=>{(0,m.logError)(e)}),c(Z,this,se).call(this)},r(L,this)))}async function ae(e,t){if(this.has(e)){try{this.update(n=>{n.snaps[e].blocked=!0,n.snaps[e].blockInformation=t}),await this.disableSnap(e)}catch(t){(0,m.logError)(`Encountered error when stopping blocked snap "${e}".`,t)}this.messagingSystem.publish(`${n.controllerName}:snapBlocked`,e,t)}}function ie(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update(t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation}),this.messagingSystem.publish(`${n.controllerName}:snapUnblocked`,e))}async function re(e,{platformVersion:t,...n}){const s=(await this.messagingSystem.call("SnapsRegistry:get",{[e]:n}))[e];var a;if(s.status===T.SnapsRegistryStatus.Blocked)throw new Error(`Cannot install version "${n.version}" of snap "${e}": The version is blocked. ${(null===(a=s.reason)||void 0===a?void 0:a.explanation)??""}`);const i=Object.keys(n.permissions).some(e=>!S.ALLOWED_PERMISSIONS.includes(e));if(r(N,this).requireAllowlist&&i&&s.status!==T.SnapsRegistryStatus.Verified)throw new Error(`Cannot install version "${n.version}" of snap "${e}": ${s.status===T.SnapsRegistryStatus.Unavailable?"The registry is temporarily unavailable.":"The snap is not on the allowlist."}`);c(Z,this,Me).call(this,e,t)}function oe(){(0,f.assert)(!0!==r(N,this).disableSnapInstallation,"Installing Snaps is currently disabled in this version of MetaMask.")}function ce(){const e=r(B,this).call(this);(0,f.assert)(!0!==e.disableSnaps,"The Snaps platform requires basic functionality to be used. Enable basic functionality in the settings to use the Snaps platform.")}async function le(){const e=[...r(q,this).entries()];return Promise.all(e.filter(([e,t])=>0===t.activeReferences&&0===t.pendingInboundRequests.length&&t.lastRequest&&r(F,this)&&(0,f.timeSince)(t.lastRequest)>r(F,this)).map(async([e])=>this.stopSnap(e,m.SnapStatusEvents.Stop)))}function ue(e,t){const{interpreter:n}=c(Z,this,We).call(this,e);n.send(t),this.update(t=>{t.snaps[e].status=n.state.value})}async function de(e){await this.messagingSystem.call("ExecutionService:terminateSnap",e),await new Promise(e=>setTimeout(e,1));c(Z,this,We).call(this,e).pendingInboundRequests.filter(e=>"finished"!==e.timer.status).forEach(e=>e.timer.finish()),await new Promise(e=>setTimeout(e,1)),this.messagingSystem.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}function pe(e,t=c(Z,this,We).call(this,e)){return null!==t.encryptionKey&&null!==t.encryptionSalt}async function he({snapId:e,salt:t,useCache:n,keyMetadata:s}){const a=c(Z,this,We).call(this,e);if(c(Z,this,pe).call(this,e,a)&&n)return{key:await r(U,this).importKey(a.encryptionKey),salt:a.encryptionSalt};const i=t??r(U,this).generateSalt(),o=await r($,this).call(this),l=await(0,p.getEncryptionEntropy)({snapId:e,seed:o,cryptographicFunctions:r(H,this)}),u=await r(U,this).keyFromPassword(l,i,!0,s),d=await r(U,this).exportKey(u);return n&&(a.encryptionKey=d,a.encryptionSalt=i),{key:u,salt:i}}async function me(e,t){try{const n=JSON.parse(t),{salt:s,keyMetadata:a}=n,i=c(Z,this,pe).call(this,e)||r(U,this).isVaultUpdated(t),{key:o}=await c(Z,this,he).call(this,{snapId:e,salt:s,useCache:i,keyMetadata:a??S.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS});return await r(U,this).decryptWithKey(o,n)}catch{throw d.rpcErrors.internal({message:"Failed to decrypt snap state, the state must be corrupted."})}}async function fe(e,t){const{key:n,salt:s}=await c(Z,this,he).call(this,{snapId:e,useCache:!0}),a=await r(U,this).encryptWithKey(n,t);return a.salt=s,JSON.stringify(a)}async function ge(e,t,n){return null===t?null:n?await c(Z,this,fe).call(this,e,t):JSON.stringify(t)}function ye(e,t,n){if(t){const s=(0,A.setDiff)(t,n);for(const t of Object.keys(s))this.removeSnapFromSubject(t,e)}for(const t of Object.keys(n))c(Z,this,ve).call(this,t,e)}function ve(e,t){var n,s;const a=this.messagingSystem.call("PermissionController:getPermissions",e),i=null==a||null===(n=a[p.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);if(Boolean(null==i||null===(s=i.value)||void 0===s?void 0:s[t]))return;if(i)return void this.messagingSystem.call("PermissionController:updateCaveat",e,p.WALLET_SNAP_PERMISSION_KEY,m.SnapCaveatType.SnapIds,{...i.value,[t]:{}});const r={[p.WALLET_SNAP_PERMISSION_KEY]:{caveats:[{type:m.SnapCaveatType.SnapIds,value:{[t]:{}}}]}};this.messagingSystem.call("PermissionController:grantPermissions",{approvedPermissions:r,subject:{origin:e}})}function be(e){const t=this.messagingSystem.call("PermissionController:getSubjectNames");for(const n of t)this.removeSnapFromSubject(n,e)}function Se(e){this.messagingSystem.call("PermissionController:hasPermissions",e)&&this.messagingSystem.call("PermissionController:revokeAllPermissions",e)}function we({origin:e,snapId:t,type:n}){const s=(0,v.nanoid)();return{id:s,promise:this.messagingSystem.call("ApprovalController:addRequest",{origin:e,id:s,type:n,requestData:{metadata:{id:s,origin:t,dappOrigin:e},snapId:t},requestState:{loading:!0}},!0)}}function Te(e,t){try{this.messagingSystem.call("ApprovalController:updateRequestState",{id:e,requestState:t})}catch{}}async function _e(e,t){return await this.messagingSystem.call("SnapsRegistry:resolveVersion",e,t)}async function ke(e){const{id:t,location:n,versionRange:s}=e;c(Z,this,Ye).call(this,t);const a=c(Z,this,We).call(this,t);a.installPromise||((0,P.log)(`Adding snap: ${t}`),a.installPromise=(async()=>{const a=await(0,A.fetchSnap)(t,n),i=a.manifest.result;if(!(0,f.satisfiesVersionRange)(i.version,s))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${i.version}" which doesn't satisfy requested version range "${s}".`);await c(Z,this,re).call(this,t,{version:i.version,checksum:i.source.shasum,permissions:i.initialPermissions,platformVersion:i.platformVersion});const o=r(N,this).forcePreinstalledSnaps&&(0,A.isLocalSnapId)(t)?{preinstalled:!0,hideSnapBranding:!0,hidden:!1}:{};return c(Z,this,Ae).call(this,{...e,files:a,id:t,...o})})());try{return await a.installPromise}catch(e){throw a.installPromise=null,e}}async function Ee(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const n=c(Z,this,We).call(this,t),s=await this.messagingSystem.call("ExecutionService:executeSnap",{...e,endowments:await c(Z,this,Pe).call(this,t)});return c(Z,this,ue).call(this,t,m.SnapStatusEvents.Start),n.lastRequest=Date.now(),s}catch(e){throw await c(Z,this,de).call(this,t),e}}async function Pe(e){let t=[];for(const n of r(R,this))if(this.messagingSystem.call("PermissionController:hasPermission",e,n)){const s=await this.messagingSystem.call("PermissionController:getEndowments",e,n);if(s){if(!Array.isArray(s)||s.some(e=>"string"!=typeof e))throw new Error("Expected an array of string endowment names.");t=t.concat(s)}}const n=[...new Set([...m.DEFAULT_ENDOWMENTS,...t])];return n.length<m.DEFAULT_ENDOWMENTS.length+t.length&&(0,m.logError)(`Duplicate endowments found for ${e}. Default endowments should not be requested.`,t),n}function Ae(e){const{id:t,origin:n,files:s,isUpdate:a=!1,removable:i,preinstalled:o,hidden:l,hideSnapBranding:d}=e,{manifest:p,sourceCode:h,svgIcon:g,auxiliaryFiles:y,localizationFiles:v}=s;(0,m.assertIsSnapManifest)(p.result);const{version:b}=p.result,S=h.toString();(0,f.assert)("string"==typeof S&&S.length>0,`Invalid source code for snap "${t}".`);const w=y.map(e=>((0,f.assert)("string"==typeof e.data.base64),{path:e.path,value:e.data.base64})),T=this.state.snaps[t],_=[...(null==T?void 0:T.versionHistory)??[],{version:b,date:Date.now(),origin:n}],k=v.map(e=>e.result),E={...T,blocked:!1,enabled:!0,removable:i,preinstalled:o,hidden:l,hideSnapBranding:d,id:t,initialConnections:p.result.initialConnections,initialPermissions:p.result.initialPermissions,manifest:p.result,status:r(Y,this).config.initial,sourceCode:S,version:b,versionHistory:_,auxiliaryFiles:w,localizationFiles:k};delete E.blockInformation;const{inversePatches:P}=this.update(e=>{e.snaps[t]=E});if(a){const e=c(Z,this,Be).call(this,t);e!==undefined&&(e.statePatches=P)}const{proposedName:A}=(0,m.getLocalizedSnapManifest)(p.result,"en",k);return this.messagingSystem.call("SubjectMetadataController:addSubjectMetadata",{subjectType:u.SubjectType.Snap,name:A,origin:E.id,version:b,svgIcon:(null==g?void 0:g.toString())??null}),{...E,sourceCode:S}}function Ce(e){const t=Object.keys(e),n=Array.from(new Set(Object.values(p.handlerEndowments)));(0,f.assert)(t.some(e=>n.includes(e)),`A snap must request at least one of the following permissions: ${n.filter(e=>null!==e).join(", ")}.`);const s=t.reduce((e,t)=>((0,f.hasProperty)(r(x,this),t)&&e.push(r(x,this)[t]),e),[]);(0,f.assert)(0===s.length,`One or more permissions are not allowed:\n${s.join("\n")}`)}function Me(e,t){if(t!==undefined&&(0,b.gt)(t,(0,m.getPlatformVersion)())){const n=`The Snap "${e}" requires platform version "${t}" which is greater than the current platform version "${(0,m.getPlatformVersion)()}".`;if(r(N,this).rejectInvalidPlatformVersion)throw new Error(n);(0,m.logWarning)(n)}}function Oe(e){return(0,p.getMaxRequestTimeCaveat)(e)??this.maxRequestTime}async function Ie(e,t,n){return this.messagingSystem.call("SnapInterfaceController:createInterface",e,t,undefined,n)}function je(e,t){(0,f.assert)(this.messagingSystem.call("SnapInterfaceController:getInterface",e,t))}async function Re(e,t,n,s){switch(t){case m.HandlerType.OnTransaction:case m.HandlerType.OnSignature:case m.HandlerType.OnHomePage:case m.HandlerType.OnSettingsPage:{const t=s;if(t&&(0,f.hasProperty)(t,"content")){const{content:n,...s}=t;return{...s,id:await c(Z,this,Ie).call(this,e,n)}}return s}case m.HandlerType.OnAssetsLookup:return c(Z,this,xe).call(this,e,n,s);case m.HandlerType.OnAssetsConversion:return c(Z,this,Ne).call(this,n,s);case m.HandlerType.OnAssetsMarketData:return c(Z,this,De).call(this,n,s);default:return s}}function xe(e,{params:t},{assets:n}){const s=this.messagingSystem.call("PermissionController:getPermissions",e);(0,f.assert)(s);const a=s[p.SnapEndowments.Assets],i=(0,p.getChainIdsCaveat)(a);(0,f.assert)(i);const{assets:r}=t;return{assets:Object.keys(n).reduce((e,t)=>{const s=t;return i.some(e=>s.startsWith(e))&&r.includes(s)&&(e[s]=n[s]),e},{})}}function Ne({params:e},{conversionRates:t}){const{conversions:n}=e;return{conversionRates:n.reduce((e,n)=>{var s;const a=null===(s=t[n.from])||void 0===s?void 0:s[n.to];var i;a&&(e[i=n.from]??(e[i]={}),e[n.from][n.to]=a);return e},{})}}function De({params:e},{marketData:t}){const{assets:n}=e;return{marketData:n.reduce((e,n)=>{var s;const a=null===(s=t[n.asset])||void 0===s?void 0:s[n.unit];var i;a&&(e[i=n.asset]??(e[i]={}),e[n.asset][n.unit]=a);return e},{})}}function Le(e,t,n){if(t===m.HandlerType.OnUserInput){(0,f.assert)(n.params&&(0,f.hasProperty)(n.params,"id"));const t=n.params.id,{context:s}=this.messagingSystem.call("SnapInterfaceController:getInterface",e,t);return{...n,params:{...n.params,context:s}}}return n}async function Fe(e,t,n){switch(t){case m.HandlerType.OnTransaction:(0,f.assertStruct)(n,m.OnTransactionResponseStruct),n&&(0,f.hasProperty)(n,"id")&&c(Z,this,je).call(this,e,n.id);break;case m.HandlerType.OnSignature:(0,f.assertStruct)(n,m.OnSignatureResponseStruct),n&&(0,f.hasProperty)(n,"id")&&c(Z,this,je).call(this,e,n.id);break;case m.HandlerType.OnHomePage:(0,f.assertStruct)(n,m.OnHomePageResponseStruct),n&&(0,f.hasProperty)(n,"id")&&c(Z,this,je).call(this,e,n.id);break;case m.HandlerType.OnSettingsPage:(0,f.assertStruct)(n,m.OnSettingsPageResponseStruct),n&&(0,f.hasProperty)(n,"id")&&c(Z,this,je).call(this,e,n.id);break;case m.HandlerType.OnNameLookup:(0,f.assertStruct)(n,m.OnNameLookupResponseStruct);break;case m.HandlerType.OnAssetsLookup:(0,f.assertStruct)(n,h.OnAssetsLookupResponseStruct);break;case m.HandlerType.OnAssetsConversion:(0,f.assertStruct)(n,m.OnAssetsConversionResponseStruct);break;case m.HandlerType.OnAssetHistoricalPrice:(0,f.assertStruct)(n,m.OnAssetHistoricalPriceResponseStruct);break;case m.HandlerType.OnAssetsMarketData:(0,f.assertStruct)(n,m.OnAssetsMarketDataResponseStruct)}}function Ue(e,t,n){const s=c(Z,this,We).call(this,e);s.pendingInboundRequests.push({requestId:t,timer:n}),s.lastRequest=null}function $e(e,t,n,s,a){const i=c(Z,this,We).call(this,e);i.pendingInboundRequests=i.pendingInboundRequests.filter(e=>e.requestId!==t),0===i.pendingInboundRequests.length&&(i.lastRequest=Date.now());const o=this.get(e);if((0,A.isTrackableHandler)(n)&&(null==o||!o.preinstalled))try{r(J,this).call(this,e,n,a,s)}catch(e){(0,m.logError)(`Error when calling MetaMetrics hook for snap "${null==o?void 0:o.id}": ${(0,h.getErrorMessage)(e)}`)}}function Be(e){return r(V,this).get(e)}function He(e){(0,f.assert)(r(V,this).get(e)===undefined,new Error(`Snap "${e}" rollback snapshot already exists.`)),r(V,this).set(e,{statePatches:[],permissions:{},newVersion:""});const t=r(V,this).get(e);return(0,f.assert)(t!==undefined,new Error(`Snapshot creation failed for ${e}.`)),t}async function Ge(e){var t,n;const s=c(Z,this,Be).call(this,e);if(!s)throw new Error("A snapshot does not exist for this snap.");await this.stopSnap(e,m.SnapStatusEvents.Stop),(null===(t=this.get(e))||void 0===t?void 0:t.status)!==m.SnapStatus.Stopped&&c(Z,this,ue).call(this,e,m.SnapStatusEvents.Stop);const{statePatches:a,permissions:i}=s;null!=a&&a.length&&this.applyPatches(a),(null===(n=this.get(e))||void 0===n?void 0:n.status)!==m.SnapStatus.Stopped&&this.update(t=>{t.snaps[e].status=m.SnapStatus.Stopped}),c(Z,this,Xe).call(this,{snapId:e,unusedPermissions:i.granted,newPermissions:i.revoked,requestData:i.requestData});const o=this.getTruncatedExpect(e);this.messagingSystem.publish("SnapController:snapRolledback",o,s.newVersion),r(V,this).delete(e)}async function qe(e){for(const t of e)await c(Z,this,Ge).call(this,t)}function Ve(e){return r(q,this).get(e)}function We(e){const t=c(Z,this,Ve).call(this,e);return(0,f.assert)(t!==undefined,new Error(`Snap "${e}" runtime data not found`)),t}function Ye(e){if(r(q,this).has(e))return;const t=this.get(e),n=(0,g.interpret)(r(Y,this));n.start({context:{snapId:e},value:(null==t?void 0:t.status)??r(Y,this).config.initial}),(0,E.forceStrict)(n),r(q,this).set(e,{lastRequest:null,startPromise:null,stopPromise:null,installPromise:null,encryptionKey:null,encryptionSalt:null,activeReferences:0,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:n,stateMutex:new y.Mutex,getStateMutex:new y.Mutex})}function Ke(e,t){const n=this.messagingSystem.call("PermissionController:getPermissions",e)??{},s=(0,A.permissionsDiff)(t,n),a=(0,A.permissionsDiff)(n,t);return{newPermissions:s,unusedPermissions:a,approvedPermissions:(0,A.permissionsDiff)(n,a)}}function ze(e,t){var n,s;const a=this.messagingSystem.call("PermissionController:getPermissions",t),i=null==a||null===(n=a[p.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);return Boolean(null==i||null===(s=i.value)||void 0===s?void 0:s[e])}function Je(e,t,n){const s=Object.keys(t).filter(t=>c(Z,this,ze).call(this,e,t)).reduce((e,n)=>(e[n]=t[n],e),{}),a=(0,A.setDiff)(n,s),i=(0,A.setDiff)(s,n);return{newConnections:a,unusedConnections:i,approvedConnections:(0,A.setDiff)(s,i)}}function Ze(e,t){if(r(N,this).useCaip25Permission&&Object.keys(t).includes(p.SnapEndowments.EthereumProvider)){const n=this.messagingSystem.call("SelectedNetworkController:getNetworkClientIdForDomain",e),{configuration:s}=this.messagingSystem.call("NetworkController:getNetworkClientById",n),a=(0,f.hexToNumber)(s.chainId);return{...t,"endowment:caip25":{caveats:[{type:"authorizedScopes",value:{requiredScopes:{},optionalScopes:{[`eip155:${a}`]:{accounts:[]}},sessionProperties:{},isMultichainOrigin:!1}}]}}}return t}function Xe({snapId:e,unusedPermissions:t={},newPermissions:n={},requestData:s}){const a=Object.keys(t);if((0,f.isNonEmptyArray)(a)&&this.messagingSystem.call("PermissionController:revokePermissions",{[e]:a}),(0,f.isNonEmptyArray)(Object.keys(n))){const t=c(Z,this,Ze).call(this,e,n);this.messagingSystem.call("PermissionController:grantPermissions",{approvedPermissions:t,subject:{origin:e},requestData:s})}}function Qe(e,t){const n=this.getExpect(e);return!(0,f.satisfiesVersionRange)(n.version,t)&&!(0,f.gtRange)(n.version,t)}function et(e,t){const n=this.getRunnableSnaps();for(const{id:s}of n){this.messagingSystem.call("PermissionController:hasPermission",s,p.SnapEndowments.LifecycleHooks)&&c(Z,this,tt).call(this,e,s,t).catch(e=>{(0,m.logError)(`Error calling lifecycle hook "${t}" for Snap "${s}": ${(0,h.getErrorMessage)(e)}`)})}}async function tt(e,t,n){const s=p.handlerEndowments[n];(0,f.assert)(s,"Lifecycle hook must have an endowment.");this.messagingSystem.call("PermissionController:hasPermission",t,s)&&await this.handleRequest({snapId:t,handler:n,origin:e,request:{jsonrpc:"2.0",method:n}})}function nt(){for(const e of r(q,this).values())e.encryptionKey=null,e.encryptionSalt=null,e.state=undefined}n.SnapController=Q}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/SnapController.cjs"}],[2461,{"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.Timer=void 0;const a=e("@metamask/utils");n.Timer=class{constructor(e){s(this,"state",void 0),(0,a.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,a.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}get remaining(){return this.state.remaining}cancel(){(0,a.assert)("paused"===this.status||"running"===this.status,new Error("Tried to cancel a not running Timer")),this.onFinish(!1)}finish(){(0,a.assert)("finished"!==this.status,new Error("Tried to finish a finished Timer.")),this.onFinish(!0)}pause(){(0,a.assert)("running"===this.state.value,new Error("Tried to pause a not running Timer"));const{callback:e,start:t,timeout:n,remaining:s}=this.state;n!==undefined&&clearTimeout(n),this.state={value:"paused",callback:e,remaining:s-(Date.now()-t)}}start(e){(0,a.assert)("stopped"===this.state.value,new Error("Tried to start an already running Timer"));const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,a.assert)("paused"===this.state.value,new Error("Tried to resume not paused Timer"));const{remaining:e,callback:t}=this.state,n=Date.now();let s;e!==Number.POSITIVE_INFINITY&&(s=setTimeout(()=>this.onFinish(!0),e)),this.state={value:"running",callback:t,remaining:e,start:n,timeout:s}}onFinish(e){(0,a.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t,remaining:n}=this.state;this.state={value:"finished",remaining:"running"===this.state.value?n-(Date.now()-this.state.start):n},e&&t()}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/Timer.cjs"}],[2462,{"@metamask/snaps-rpc-methods":2507,"@metamask/snaps-utils":2677},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CLIENT_ONLY_HANDLERS=n.METAMASK_ORIGIN=n.STATE_DEBOUNCE_TIMEOUT=n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS=n.ALLOWED_PERMISSIONS=void 0;const s=e("@metamask/snaps-rpc-methods"),a=e("@metamask/snaps-utils");n.ALLOWED_PERMISSIONS=Object.freeze(["snap_dialog","snap_manageState","snap_notify","snap_getLocale",s.SnapEndowments.Cronjob,s.SnapEndowments.HomePage,s.SnapEndowments.LifecycleHooks,s.SnapEndowments.EthereumProvider,s.SnapEndowments.TransactionInsight,s.SnapEndowments.SignatureInsight]),n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS={algorithm:"PBKDF2",params:{iterations:1e4}},n.STATE_DEBOUNCE_TIMEOUT=500,n.METAMASK_ORIGIN="metamask",n.CLIENT_ONLY_HANDLERS=Object.freeze([a.HandlerType.OnClientRequest,a.HandlerType.OnSignature,a.HandlerType.OnTransaction,a.HandlerType.OnCronjob,a.HandlerType.OnNameLookup,a.HandlerType.OnHomePage,a.HandlerType.OnSettingsPage,a.HandlerType.OnUserInput,a.HandlerType.OnAssetsLookup,a.HandlerType.OnAssetsConversion,a.HandlerType.OnAssetHistoricalPrice,a.HandlerType.OnAssetsMarketData,a.HandlerType.OnWebSocketEvent])}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/constants.cjs"}],[2463,{"./SnapController.cjs":2460,"./constants.cjs":2462,"./location/index.cjs":2465,"./registry/index.cjs":2469,"./selectors.cjs":2472},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},a=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./constants.cjs"),n),a(e("./location/index.cjs"),n),a(e("./SnapController.cjs"),n),a(e("./selectors.cjs"),n),a(e("./registry/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/index.cjs"}],[2464,{"@metamask/snaps-utils":2677,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpLocation=void 0;const a=e("@metamask/snaps-utils"),i=e("@metamask/utils");n.HttpLocation=class{constructor(e,t={}){s(this,"cache",new Map),s(this,"validatedManifest",void 0),s(this,"url",void 0),s(this,"fetchFn",void 0),s(this,"fetchOptions",void 0),(0,i.assertStruct)(e.toString(),a.HttpSnapIdStruct,"Invalid Snap Id: "),this.fetchFn=t.fetch??globalThis.fetch.bind(undefined),this.fetchOptions=t.fetchOptions,this.url=e}async manifest(){if(this.validatedManifest)return this.validatedManifest.clone();const e=new URL(a.NpmSnapFileNames.Manifest,this.url).toString(),t=await this.fetchFn(e,this.fetchOptions);if(!t.ok)throw new Error(`Failed to fetch "${e}". Status code: ${t.status}.`);const n=await t.text(),s=(0,a.parseJson)(n),i=new a.VirtualFile({value:n,result:(0,a.createSnapManifest)(s),path:a.NpmSnapFileNames.Manifest,data:{canonicalPath:e}});return this.validatedManifest=i,this.manifest()}async fetch(e){const t=(0,a.normalizeRelative)(e),n=this.cache.get(t);if(n!==undefined)return n.clone();const s=this.toCanonical(t).toString(),r=await this.fetchFn(s,this.fetchOptions);if(!r.ok)throw new Error(`Failed to fetch "${s}". Status code: ${r.status}.`);const o=await r.arrayBuffer(),c=new a.VirtualFile({value:new Uint8Array(o),path:t,data:{canonicalPath:s}});return(0,i.assert)(!this.cache.has(t),"Corrupted cache, multiple files with same path."),this.cache.set(t,c),this.fetch(t)}get root(){return new URL(this.url)}toCanonical(e){return(0,i.assert)(!e.startsWith("/"),"Tried to parse absolute path."),new URL(e,this.url)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/http.cjs"}],[2465,{"./http.cjs":2464,"./local.cjs":2466,"./location.cjs":2467,"./npm.cjs":2468},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},a=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./location.cjs"),n),a(e("./npm.cjs"),n),a(e("./local.cjs"),n),a(e("./http.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/index.cjs"}],[2466,{"./http.cjs":2464,"@metamask/snaps-utils":2677,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function a(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.LocalLocation=void 0;const r=e("@metamask/snaps-utils"),o=e("@metamask/utils"),c=e("./http.cjs");var l=new WeakMap;function u(e){return(0,o.assert)(e.data.canonicalPath!==undefined),e.data.canonicalPath=`local:${e.data.canonicalPath}`,e}n.LocalLocation=class{constructor(e,t={}){var n,a,u;s(this,l,void 0),(0,o.assertStruct)(e.toString(),r.LocalSnapIdStruct,"Invalid Snap Id"),(0,o.assert)(t.fetchOptions===undefined,"Currently adding fetch options to local: is unsupported."),n=l,a=this,u=new c.HttpLocation(new URL(e.toString().slice(r.SnapIdPrefixes.local.length)),{...t,fetchOptions:{cache:"no-cache"}}),n.set(i(n,a),u)}async manifest(){return u(await a(l,this).manifest())}async fetch(e){return u(await a(l,this).fetch(e))}get shouldAlwaysReload(){return!0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/local.cjs"}],[2467,{"./http.cjs":2464,"./local.cjs":2466,"./npm.cjs":2468,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detectSnapLocation=void 0;const s=e("@metamask/utils"),a=e("./http.cjs"),i=e("./local.cjs"),r=e("./npm.cjs");n.detectSnapLocation=function(e,t){const n=(null==t?void 0:t.allowHttp)??!1,o=(null==t?void 0:t.allowLocal)??!1,c=new URL(e);switch(c.protocol){case"npm:":return new r.NpmLocation(c,t);case"local:":return(0,s.assert)(o,new TypeError("Fetching local snaps is disabled.")),new i.LocalLocation(c,t);case"http:":case"https:":return(0,s.assert)(n,new TypeError("Fetching snaps through http/https is disabled.")),new a.HttpLocation(c,t);default:throw new TypeError(`Unrecognized "${c.protocol}" snap location protocol.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/location.cjs"}],[2468,{"@metamask/snaps-utils":2677,"@metamask/utils":2799,"concat-stream":2476,"get-npm-tarball-url":4154,"readable-stream":4977,"readable-web-to-node-stream":4978,"tar-stream":2480},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){a(e,t),t.set(e,n)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n){return e.set(c(e,t),n),n}function o(e,t){return e.get(c(e,t))}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getNpmCanonicalBasePath=n.fetchNpmMetadata=n.NpmLocation=n.TARBALL_SIZE_SAFETY_LIMIT=n.BaseNpmLocation=n.DEFAULT_NPM_REGISTRY=void 0;const u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=l(e("concat-stream")),h=l(e("get-npm-tarball-url")),m=e("readable-stream"),f=e("readable-web-to-node-stream"),g=e("tar-stream");n.DEFAULT_NPM_REGISTRY=new URL("https://registry.npmjs.org");var y=new WeakMap,v=new WeakMap,b=new WeakSet;class S{constructor(e,t={}){var r,o;a(r=this,o=b),o.add(r),i(this,"meta",void 0),s(this,y,void 0),s(this,v,void 0);const c=t.allowCustomRegistries??!1,l=t.fetch??globalThis.fetch.bind(undefined),p=t.versionRange??u.DEFAULT_REQUESTED_SNAP_VERSION,h=t.resolveVersion??(async e=>e);let m;(0,d.assertStruct)(e.toString(),u.NpmSnapIdStruct,"Invalid Snap Id: "),""===e.host&&""===e.port&&""===e.username&&""===e.password?m=n.DEFAULT_NPM_REGISTRY:(m="https://",e.username&&(m+=e.username,e.password&&(m+=`:${e.password}`),m+="@"),m+=e.host,m=new URL(m),(0,d.assert)(c,new TypeError(`Custom NPM registries are disabled, tried to use "${m.toString()}".`))),(0,d.assert)("/"===m.pathname&&""===m.search&&""===m.hash),(0,d.assert)(""!==e.pathname&&"/"!==e.pathname,new TypeError("The package name in NPM location is empty."));let f=e.pathname;f.startsWith("/")&&(f=f.slice(1)),this.meta={requestedRange:p,registry:m,packageName:f,fetch:l,resolveVersion:h}}async manifest(){if(o(y,this))return o(y,this).clone();const e=await this.fetch("snap.manifest.json"),t=(0,u.parseJson)(e.toString());return e.result=(0,u.createSnapManifest)(t),r(y,this,e),this.manifest()}async fetch(e){const t=(0,u.normalizeRelative)(e);o(v,this)||(await c(b,this,w).call(this),(0,d.assert)(o(v,this)!==undefined));const n=o(v,this).get(t);return(0,d.assert)(n!==undefined,new TypeError(`File "${e}" not found in package.`)),n.clone()}get packageName(){return this.meta.packageName}get version(){return(0,d.assert)(this.meta.version!==undefined,"Tried to access version without first fetching NPM package."),this.meta.version}get registry(){return this.meta.registry}get versionRange(){return this.meta.requestedRange}}async function w(){(0,d.assert)(o(v,this)===undefined);const e=await this.meta.resolveVersion(this.meta.requestedRange),{tarballURL:t,targetVersion:n}=await async function(e,t,n,s){var a;if(k(n)&&(0,d.isValidSemVerVersion)(t))return{tarballURL:(0,h.default)(e,t),targetVersion:t};const i=await T(e,n,s),r=Object.keys((null==i?void 0:i.versions)??{}).map(e=>((0,d.assertIsSemVerVersion)(e),e)),o=(0,u.getTargetVersion)(r,t);if(null===o)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}".`);const c=null==i||null===(a=i.versions)||void 0===a||null===(a=a[o])||void 0===a||null===(a=a.dist)||void 0===a?void 0:a.tarball;return{tarballURL:c,targetVersion:o}}(this.meta.packageName,e,this.meta.registry,this.meta.fetch);if(!(0,u.isValidUrl)(t)||!t.toString().endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in NPM metadata for package "${this.meta.packageName}".`);const s=new URL(t);s.hostname=this.meta.registry.hostname,s.protocol=this.meta.registry.protocol;const a=await this.fetchNpmTarball(s);r(v,this,a),this.meta.version=n}n.BaseNpmLocation=S,n.TARBALL_SIZE_SAFETY_LIMIT=262144e3;async function T(e,t,n){const s=await n(new URL(e,t).toString(),{headers:{accept:k(t)?"application/vnd.npm.install-v1+json; q=1.0, application/json; q=0.8, */*":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch NPM registry entry. Status code: ${s.status}.`);const a=await s.json();if(!(0,d.isObject)(a))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);return a}function _(e,t){let n="npm://";return""!==e.username&&(n+=e.username,""!==e.password&&(n+=`:${e.password}`),n+="@"),`${n}${e.host}/${t}/`}function k(e){return e.toString()===n.DEFAULT_NPM_REGISTRY.toString()}n.NpmLocation=class extends S{async fetchNpmTarball(e){const t=await this.meta.fetch(e.toString());(0,d.assert)(404!==t.status,`"${this.meta.packageName}" was not found in the NPM registry`),(0,d.assert)(t.ok&&t.body,`Failed to fetch tarball for package "${this.meta.packageName}"`);const s=t.headers.get("content-length");(0,d.assert)(s,"Snap tarball has invalid content-length");const a=parseInt(s,10);return(0,d.assert)(a<=n.TARBALL_SIZE_SAFETY_LIMIT,"Snap tarball exceeds size limit"),new Promise((e,s)=>{const a=new Map,i=function(e,t){(0,d.assert)(e.endsWith("/"),"Base needs to end with '/' for relative paths to be added as children instead of siblings."),(0,d.assert)(e.startsWith("npm:"),'Protocol mismatch, expected "npm:".');const s=(0,g.extract)();let a=0;return s.on("entry",(i,r,o)=>{const{name:c,type:l}=i;if("file"===l){const i=c.replace(E,"");return r.pipe((0,p.default)({encoding:"uint8array"},r=>{try{a+=r.byteLength,(0,d.assert)(a<n.TARBALL_SIZE_SAFETY_LIMIT,`Snap tarball exceeds limit of ${n.TARBALL_SIZE_SAFETY_LIMIT} bytes.`);const s=new u.VirtualFile({value:r,path:i,data:{canonicalPath:new URL(i,e).toString()}});return(0,d.assert)(!t.has(i),"Malformed tarball, multiple files with the same path."),t.set(i,s),o()}catch(e){return s.destroy(e)}}))}return r.on("end",()=>o()),r.resume()}),s}(_(this.meta.registry,this.meta.packageName),a),r=t.body,o=new DecompressionStream("gzip"),c=r.pipeThrough(o);(0,m.pipeline)(function(e){if("function"!=typeof e.getReader)return e;return new f.ReadableWebToNodeStream(e)}(c),i,t=>{t?s(t):e(a)})})}},n.fetchNpmMetadata=T,n.getNpmCanonicalBasePath=_;const E=/^package\//u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/npm.cjs"}],[2469,{"./json.cjs":2470,"./registry.cjs":2471},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},a=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./registry.cjs"),n),a(e("./json.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/index.cjs"}],[247,{"../../../../../shared/constants/permissions":5437,"../../../controllers/permissions":170,"@metamask/chain-agnostic-permission":1281,"@metamask/controller-utils":1301,"@metamask/permission-controller":2260,lodash:4534},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.requestPermissionsHandler=void 0;var s=e("lodash"),a=e("@metamask/controller-utils"),i=e("@metamask/permission-controller"),r=e("@metamask/chain-agnostic-permission"),o=e("../../../../../shared/constants/permissions"),c=e("../../../controllers/permissions");n.requestPermissionsHandler={methodNames:[i.MethodNames.RequestPermissions],implementation:async function(e,t,n,l,{getAccounts:u,requestPermissionsForOrigin:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p}){const{params:h}=e;if(!Array.isArray(h)||!(0,a.isPlainObject)(h[0]))return l((0,i.invalidParams)({data:{request:e}}));let[m]=h;delete m[r.Caip25EndowmentPermissionName];const f=(0,s.pick)(m,[o.RestrictedMethods.eth_accounts,c.PermissionNames.permittedChains]);delete m[o.RestrictedMethods.eth_accounts],delete m[c.PermissionNames.permittedChains];const g=Object.keys(f).length>0;if(g){const e=p(f);m={...m,...e}}let y={};const[v]=await d(m);if(y={...v},g){var b;const e=y[r.Caip25EndowmentPermissionName];if(!e)throw new Error(`could not find ${r.Caip25EndowmentPermissionName} permission.`);const t=null===(b=e.caveats)||void 0===b||null===(b=b.find(({type:e})=>e===r.Caip25CaveatType))||void 0===b?void 0:b.value;if(!t)throw new Error(`could not find ${r.Caip25CaveatType} in granted ${r.Caip25EndowmentPermissionName} permission.`);delete y[r.Caip25EndowmentPermissionName];const n=u(origin);y[o.RestrictedMethods.eth_accounts]={...e,parentCapability:o.RestrictedMethods.eth_accounts,caveats:[{type:o.CaveatTypes.restrictReturnedAccounts,value:n}]};const s=(0,r.getPermittedEthChainIds)(t);s.length>0&&(y[c.PermissionNames.permittedChains]={...e,parentCapability:c.PermissionNames.permittedChains,caveats:[{type:o.CaveatTypes.restrictNetworkSwitching,value:s}]})}return t.result=Object.values(y).filter(e=>e!==undefined),l()},hookNames:{getAccounts:!0,requestPermissionsForOrigin:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-requestPermissions.ts"}],[2470,{"./registry.cjs":2471,"@metamask/base-controller":1222,"@metamask/snaps-registry":2486,"@metamask/snaps-utils":2677,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){a(e,t),t.set(e,n)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function r(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.JsonSnapsRegistry=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-registry"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("./registry.cjs"),h={database:null,lastUpdated:null,databaseUnavailable:!1};var m=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakSet;class w extends c.BaseController{constructor({messenger:e,state:t,url:n={registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:i="0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6",fetchFunction:c=globalThis.fetch.bind(undefined),recentFetchThreshold:l=(0,d.inMilliseconds)(5,d.Duration.Minute),refetchOnAllowlistMiss:u=!0}){var p,w;super({messenger:e,metadata:{database:{persist:!0,anonymous:!1},lastUpdated:{persist:!0,anonymous:!1},databaseUnavailable:{persist:!0,anonymous:!1}},name:"SnapsRegistry",state:{...h,...t}}),a(p=this,w=S),w.add(p),s(this,m,void 0),s(this,f,void 0),s(this,g,void 0),s(this,y,void 0),s(this,v,void 0),s(this,b,void 0),r(m,this,n),r(f,this,i),r(g,this,c),r(y,this,l),r(v,this,u),r(b,this,null),this.messagingSystem.registerActionHandler("SnapsRegistry:get",async(...e)=>o(S,this,A).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:getMetadata",(...e)=>o(S,this,M).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:resolveVersion",async(...e)=>o(S,this,C).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:update",async()=>o(S,this,_).call(this))}}function T(){return this.state.lastUpdated&&Date.now()-this.state.lastUpdated<i(y,this)}async function _(){i(b,this)?await i(b,this):(null===i(b,this)&&r(b,this,o(S,this,k).call(this)),await i(b,this),r(b,this,null))}async function k(){if(!o(S,this,T).call(this))try{const[e,t]=await Promise.all([o(S,this,I).call(this,i(m,this).registry),o(S,this,I).call(this,i(m,this).signature)]);o(S,this,O).call(this,e,t),this.update(t=>{t.database=JSON.parse(e),t.lastUpdated=Date.now(),t.databaseUnavailable=!1})}catch{this.update(e=>{e.databaseUnavailable=!0})}}async function E(){return null===this.state.database&&await o(S,this,_).call(this),this.state.database}async function P(e,t,n=!1){var s;const a=await o(S,this,E).call(this),r=null==a?void 0:a.blockedSnaps.find(n=>"id"in n?n.id===e&&(0,d.satisfiesVersionRange)(t.version,n.versionRange):n.checksum===t.checksum);if(r)return{status:p.SnapsRegistryStatus.Blocked,reason:r.reason};const c=null==a?void 0:a.verifiedSnaps[e],l=null==c||null===(s=c.versions)||void 0===s?void 0:s[t.version];return l&&l.checksum===t.checksum?{status:p.SnapsRegistryStatus.Verified}:i(v,this)&&!n?(await o(S,this,_).call(this),o(S,this,P).call(this,e,t,!0)):{status:this.state.databaseUnavailable?p.SnapsRegistryStatus.Unavailable:p.SnapsRegistryStatus.Unverified}}async function A(e){return Object.entries(e).reduce(async(e,[t,n])=>{const s=await o(S,this,P).call(this,t,n),a=await e;return a[t]=s,a},Promise.resolve({}))}async function C(e,t,n=!1){var s;const a=await o(S,this,E).call(this),r=(null==a||null===(s=a.verifiedSnaps[e])||void 0===s?void 0:s.versions)??null;if(!r&&i(v,this)&&!n)return await o(S,this,_).call(this),o(S,this,C).call(this,e,t,!0);if(!r)return t;const c=(0,u.getTargetVersion)(Object.keys(r),t);return c||!i(v,this)||n?c?((0,d.assertIsSemVerRange)(c),c):t:(await o(S,this,_).call(this),o(S,this,C).call(this,e,t,!0))}function M(e){var t;return(null===(t=this.state)||void 0===t||null===(t=t.database)||void 0===t||null===(t=t.verifiedSnaps[e])||void 0===t?void 0:t.metadata)??null}function O(e,t){(0,d.assert)(i(f,this),"No public key provided.");const n=(0,l.verify)({registry:e,signature:JSON.parse(t),publicKey:i(f,this)});(0,d.assert)(n,"Invalid registry signature.")}async function I(e){const t=await i(g,this).call(this,e);if(!t.ok)throw new Error(`Failed to fetch ${e}.`);return await t.text()}n.JsonSnapsRegistry=w}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/json.cjs"}],[2471,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryStatus=void 0,function(e){e[e.Unverified=0]="Unverified",e[e.Blocked=1]="Blocked",e[e.Verified=2]="Verified",e[e.Unavailable=3]="Unavailable"}(s||(n.SnapsRegistryStatus=s={}))}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/registry.cjs"}],[2472,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRunnableSnaps=void 0;n.getRunnableSnaps=e=>e.filter(e=>e.enabled&&!e.blocked)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/selectors.cjs"}],[2473,{"./snaps/Timer.cjs":2461,"@metamask/snaps-sdk":2563,"@metamask/snaps-utils":2677,"fast-deep-equal":4101},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.isLocalSnapId=n.isTrackableHandler=n.throttleTracking=n.TRACKABLE_HANDLERS=n.debouncePersistState=n.fetchSnap=n.getSnapFiles=n.withTimeout=n.hasTimedOut=n.delayWithTimer=n.delay=n.permissionsDiff=n.setDiff=void 0;const a=e("@metamask/snaps-sdk"),i=e("@metamask/snaps-utils"),r=s(e("fast-deep-equal")),o=e("./snaps/Timer.cjs");function c(e,t){let n;const s=new Promise((s,a)=>{e.start(()=>{t===undefined?s():s(t)}),n=a});return s.cancel=()=>{"finished"!==e.status&&(e.cancel(),n(new Error("The delay has been canceled.")))},s}async function l(e,t){return t&&0!==t.length?await Promise.all(t.map(async t=>e.fetch(t))):[]}n.setDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>(n in t||(e[n]=s),e),{})},n.permissionsDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>{const a=n in t;return(!a||a&&!(0,r.default)(s.caveats??[],t[n].caveats??[]))&&(e[n]=s),e},{})},n.delay=function(e,t){return c(new o.Timer(e),t)},n.delayWithTimer=c,n.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),n.withTimeout=async function(e,t){const s=c("number"==typeof t?new o.Timer(t):t,n.hasTimedOut);try{return await Promise.race([e,s])}finally{s.cancel()}},n.getSnapFiles=l,n.fetchSnap=async function(e,t){try{const e=await t.manifest(),n=await t.fetch(e.result.source.location.npm.filePath);(0,a.assert)(n.size<i.MAX_FILE_SIZE,"Snap source code must be smaller than 64 MB.");const{iconPath:s}=e.result.source.location.npm,r=s?await t.fetch(s):undefined,o=await l(t,e.result.source.files);(0,i.validateAuxiliaryFiles)(o),await Promise.all(o.map(async e=>{e.data.base64=await(0,i.encodeBase64)(e)}));const c=await l(t,e.result.source.locales),u={manifest:e,sourceCode:n,svgIcon:r,auxiliaryFiles:o,localizationFiles:(0,i.getValidatedLocalizationFiles)(c)};return await(0,i.validateFetchedSnap)(u),u}catch(t){throw new Error(`Failed to fetch snap "${e}": ${(0,a.getErrorMessage)(t)}.`)}},n.debouncePersistState=function(e,t=1e3){const n=new Map;return(s,a,i)=>{const r=`${s}-${i}`;n.has(r)&&clearTimeout(n.get(r)),n.set(r,setTimeout(()=>{e(s,a,i),n.delete(r)},t))}},n.TRACKABLE_HANDLERS=Object.freeze([i.HandlerType.OnHomePage,i.HandlerType.OnInstall,i.HandlerType.OnNameLookup,i.HandlerType.OnRpcRequest,i.HandlerType.OnSignature,i.HandlerType.OnTransaction,i.HandlerType.OnUpdate]),n.throttleTracking=function(e,t=6e4){const n=new Map,s=new Map;return(a,i,r,o)=>{const c=`${a}${i}${r}${o}`,l=Date.now(),u=n.get(c)??0,d=[a,i,r,o];if(l-u>=t)return n.set(c,l),void e(...d);const p=s.get(c);null!=p&&p.timer&&clearTimeout(p.timer),n.set(c,l),s.set(c,{args:d,timer:setTimeout(()=>{e(...d),s.delete(c)},t)})}},n.isTrackableHandler=function(e){return n.TRACKABLE_HANDLERS.includes(e)},n.isLocalSnapId=function(e){return e.startsWith("local:")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/utils.cjs"}],[2474,{"../snaps/index.cjs":2463,"@metamask/rpc-errors":2384,"@metamask/snaps-utils":2677,"@metamask/utils":2799,nanoid:4718},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){a(e,t),t.set(e,n)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketService=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("nanoid"),h=e("../snaps/index.cjs"),m="WebSocketService";var f=new WeakMap,g=new WeakMap,y=new WeakSet;function v(e,t){const n=r(g,this).get(t);return(0,d.assert)(n&&n.snapId===e,`Socket with ID "${t}" not found.`),n}function b(e,t,n){return c(y,this,E).call(this,e).some(e=>e.url===t&&(0,u.isEqual)(e.protocols,n))}function S(e,t){r(f,this).call("SnapController:handleRequest",{origin:h.METAMASK_ORIGIN,snapId:e,handler:u.HandlerType.OnWebSocketEvent,request:{method:"",params:{event:t}}}).catch(t=>{(0,u.logError)(`An error occurred while handling a WebSocket message for Snap "${e}":`,t)})}async function w(e,t,n=[]){(0,d.assert)(!c(y,this,b).call(this,e,t,n),`An open WebSocket connection to ${t} already exists.`);const s=new URL(t),{origin:a}=s,i=(0,p.nanoid)(),o=new WebSocket(t,n);o.binaryType="arraybuffer";const{promise:u,resolve:h,reject:m}=(0,d.createDeferredPromise)();o.addEventListener("open",()=>{h(),c(y,this,S).call(this,e,{type:"open",id:i,origin:a})}),o.addEventListener("close",t=>{r(g,this).delete(i),c(y,this,S).call(this,e,{type:"close",id:i,origin:a,code:t.code,reason:t.reason,wasClean:t.wasClean??null})});const f=()=>{m(l.rpcErrors.resourceUnavailable("An error occurred while opening the WebSocket."))};return o.addEventListener("error",f),o.addEventListener("message",t=>{const n="string"==typeof t.data?{type:"text",message:t.data}:{type:"binary",message:Array.from(new Uint8Array(t.data))};c(y,this,S).call(this,e,{type:"message",id:i,origin:a,data:n})}),r(g,this).set(i,{id:i,snapId:e,url:t,protocols:n,socket:o,openPromise:u}),await u,o.removeEventListener("error",f),i}function T(e,t){const{socket:n}=c(y,this,v).call(this,e,t);n.close()}function _(e){for(const t of c(y,this,E).call(this,e))c(y,this,T).call(this,e,t.id)}async function k(e,t,n){const{socket:s,openPromise:a}=c(y,this,v).call(this,e,t);await a;const i=Array.isArray(n)?new Uint8Array(n):n;s.send(i)}function E(e){return[...r(g,this).values()].filter(t=>t.snapId===e).map(e=>({id:e.id,url:e.url,protocols:e.protocols}))}n.WebSocketService=class{constructor({messenger:e}){var t,n;a(t=this,n=y),n.add(t),i(this,"name",m),i(this,"state",null),s(this,f,void 0),s(this,g,void 0),o(f,this,e),o(g,this,new Map),r(f,this).registerActionHandler(`${m}:open`,async(...e)=>c(y,this,w).call(this,...e)),r(f,this).registerActionHandler(`${m}:close`,(...e)=>c(y,this,T).call(this,...e)),r(f,this).registerActionHandler(`${m}:sendMessage`,async(...e)=>c(y,this,k).call(this,...e)),r(f,this).registerActionHandler(`${m}:getAll`,(...e)=>c(y,this,E).call(this,...e)),r(f,this).subscribe("SnapController:snapUpdated",e=>{c(y,this,_).call(this,e.id)}),r(f,this).subscribe("SnapController:snapUninstalled",e=>{c(y,this,_).call(this,e.id)}),r(f,this).subscribe("SnapController:snapInstalled",e=>{c(y,this,_).call(this,e.id)})}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/WebSocketService.cjs"}],[2475,{"./WebSocketService.cjs":2474},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},a=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./WebSocketService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/index.cjs"}],[2476,{buffer:3760,"buffer-from":3766,inherits:4328,"readable-stream":4977,typedarray:5324},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=e("readable-stream").Writable,a=e("inherits"),i=e("buffer-from");if("undefined"==typeof Uint8Array)var r=e("typedarray").Uint8Array;else r=Uint8Array;function o(e,t){if(!(this instanceof o))return new o(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var n=e.encoding,a=!1;n?"u8"!==(n=String(n).toLowerCase())&&"uint8"!==n||(n="uint8array"):a=!0,s.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=a,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}t.exports=o,a(o,s),o.prototype._write=function(e,t,n){this.body.push(e),n()},o.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return n.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},o.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var a=e[s];"string"==typeof a||n.isBuffer(a)?t.push(a):c(a)?t.push(i(a)):t.push(i(String(a)))}t=n.isBuffer(e[0])?(t=n.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var a=e[s];n.isBuffer(a)?t.push(a):c(a)?t.push(i(a)):t.push(i(String(a)))}return n.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=i(e[n])),t+=e[n].length;for(var s=new r(t),a=(n=0,0);n<e.length;n++)for(var o=e[n],c=0;c<o.length;c++)s[a++]=o[c];return s}(this.body):this.body):[]};Array.isArray;function c(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snaps-controllers>concat-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/concat-stream/index.js"}],[2477,{fs:3712},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const s={S_IFMT:61440,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960};try{t.exports=e("fs").constants||s}catch{t.exports=s}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/constants.js"}],[2478,{"./headers":2479,b4a:3637,"fast-fifo":4103,streamx:5301},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const{Writable:s,Readable:a,getStreamError:i}=e("streamx"),r=e("fast-fifo"),o=e("b4a"),c=e("./headers"),l=o.alloc(0);class u{constructor(){this.buffered=0,this.shifted=0,this.queue=new r,this._offset=0}push(e){this.buffered+=e.byteLength,this.queue.push(e)}shiftFirst(e){return 0===this._buffered?null:this._next(e)}shift(e){if(e>this.buffered)return null;if(0===e)return l;let t=this._next(e);if(e===t.byteLength)return t;const n=[t];for(;(e-=t.byteLength)>0;)t=this._next(e),n.push(t);return o.concat(n)}_next(e){const t=this.queue.peek(),n=t.byteLength-this._offset;if(e>=n){const e=this._offset?t.subarray(this._offset,t.byteLength):t;return this.queue.shift(),this._offset=0,this.buffered-=n,this.shifted+=n,e}return this.buffered-=e,this.shifted+=e,t.subarray(this._offset,this._offset+=e)}}class d extends a{constructor(e,t,n){super(),this.header=t,this.offset=n,this._parent=e}_read(e){0===this.header.size&&this.push(null),this._parent._stream===this&&this._parent._update(),e(null)}_predestroy(){this._parent.destroy(i(this))}_detach(){this._parent._stream===this&&(this._parent._stream=null,this._parent._missing=m(this.header.size),this._parent._update())}_destroy(e){this._detach(),e(null)}}class p extends s{constructor(e){super(e),e||(e={}),this._buffer=new u,this._offset=0,this._header=null,this._stream=null,this._missing=0,this._longHeader=!1,this._callback=h,this._locked=!1,this._finished=!1,this._pax=null,this._paxGlobal=null,this._gnuLongPath=null,this._gnuLongLinkPath=null,this._filenameEncoding=e.filenameEncoding||"utf-8",this._allowUnknownFormat=!!e.allowUnknownFormat,this._unlockBound=this._unlock.bind(this)}_unlock(e){if(this._locked=!1,e)return this.destroy(e),void this._continueWrite(e);this._update()}_consumeHeader(){if(this._locked)return!1;this._offset=this._buffer.shifted;try{this._header=c.decode(this._buffer.shift(512),this._filenameEncoding,this._allowUnknownFormat)}catch(e){return this._continueWrite(e),!1}if(!this._header)return!0;switch(this._header.type){case"gnu-long-path":case"gnu-long-link-path":case"pax-global-header":case"pax-header":return this._longHeader=!0,this._missing=this._header.size,!0}return this._locked=!0,this._applyLongHeaders(),0===this._header.size||"directory"===this._header.type?(this.emit("entry",this._header,this._createStream(),this._unlockBound),!0):(this._stream=this._createStream(),this._missing=this._header.size,this.emit("entry",this._header,this._stream,this._unlockBound),!0)}_applyLongHeaders(){this._gnuLongPath&&(this._header.name=this._gnuLongPath,this._gnuLongPath=null),this._gnuLongLinkPath&&(this._header.linkname=this._gnuLongLinkPath,this._gnuLongLinkPath=null),this._pax&&(this._pax.path&&(this._header.name=this._pax.path),this._pax.linkpath&&(this._header.linkname=this._pax.linkpath),this._pax.size&&(this._header.size=parseInt(this._pax.size,10)),this._header.pax=this._pax,this._pax=null)}_decodeLongHeader(e){switch(this._header.type){case"gnu-long-path":this._gnuLongPath=c.decodeLongPath(e,this._filenameEncoding);break;case"gnu-long-link-path":this._gnuLongLinkPath=c.decodeLongPath(e,this._filenameEncoding);break;case"pax-global-header":this._paxGlobal=c.decodePax(e);break;case"pax-header":this._pax=null===this._paxGlobal?c.decodePax(e):Object.assign({},this._paxGlobal,c.decodePax(e))}}_consumeLongHeader(){this._longHeader=!1,this._missing=m(this._header.size);const e=this._buffer.shift(this._header.size);try{this._decodeLongHeader(e)}catch(e){return this._continueWrite(e),!1}return!0}_consumeStream(){const e=this._buffer.shiftFirst(this._missing);if(null===e)return!1;this._missing-=e.byteLength;const t=this._stream.push(e);return 0===this._missing?(this._stream.push(null),t&&this._stream._detach(),t&&!1===this._locked):t}_createStream(){return new d(this,this._header,this._offset)}_update(){for(;this._buffer.buffered>0&&!this.destroying;){if(this._missing>0){if(null!==this._stream){if(!1===this._consumeStream())return;continue}if(!0===this._longHeader){if(this._missing>this._buffer.buffered)break;if(!1===this._consumeLongHeader())return!1;continue}const e=this._buffer.shiftFirst(this._missing);null!==e&&(this._missing-=e.byteLength);continue}if(this._buffer.buffered<512)break;if(null!==this._stream||!1===this._consumeHeader())return}this._continueWrite(null)}_continueWrite(e){const t=this._callback;this._callback=h,t(e)}_write(e,t){this._callback=t,this._buffer.push(e),this._update()}_final(e){this._finished=0===this._missing&&0===this._buffer.buffered,e(this._finished?null:new Error("Unexpected end of data"))}_predestroy(){this._continueWrite(null)}_destroy(e){this._stream&&this._stream.destroy(i(this)),e(null)}[Symbol.asyncIterator](){let e=null,t=null,n=null,s=null,a=null;const i=this;return this.on("entry",function(e,i,r){a=r,i.on("error",h),t?(t({value:i,done:!1}),t=n=null):s=i}),this.on("error",t=>{e=t}),this.on("close",function(){if(r(e),!t)return;e?n(e):t({value:undefined,done:!0});t=n=null}),{[Symbol.asyncIterator](){return this},next:()=>new Promise(o),return:()=>c(null),throw:e=>c(e)};function r(e){if(!a)return;const t=a;a=null,t(e)}function o(a,o){return e?o(e):s?(a({value:s,done:!1}),void(s=null)):(t=a,n=o,r(null),void(i._finished&&t&&(t({value:undefined,done:!0}),t=n=null)))}function c(e){return i.destroy(e),r(e),new Promise((t,n)=>{if(i.destroyed)return t({value:undefined,done:!0});i.once("close",function(){e?n(e):t({value:undefined,done:!0})})})}}}function h(){}function m(e){return(e&=511)&&512-e}t.exports=function(e){return new p(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/extract.js"}],[2479,{b4a:3637},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const s=e("b4a"),a="0".charCodeAt(0),i=s.from([117,115,116,97,114,0]),r=s.from([a,a]),o=s.from([117,115,116,97,114,32]),c=s.from([32,0]),l=257,u=263;function d(e,t,n,s){for(;n<s;n++)if(e[n]===t)return n;return s}function p(e){let t=256;for(let n=0;n<148;n++)t+=e[n];for(let n=156;n<512;n++)t+=e[n];return t}function h(e,t){return(e=e.toString(8)).length>t?"7777777777777777777".slice(0,t)+" ":"0000000000000000000".slice(0,t-e.length)+e+" "}function m(e,t,n){if(128&(e=e.subarray(t,t+n))[t=0])return function(e){let t;if(128===e[0])t=!0;else{if(255!==e[0])return null;t=!1}const n=[];let s;for(s=e.length-1;s>0;s--){const a=e[s];t?n.push(a):n.push(255-a)}let a=0;const i=n.length;for(s=0;s<i;s++)a+=n[s]*Math.pow(256,s);return t?a:-1*a}(e);{for(;t<e.length&&32===e[t];)t++;const n=(a=d(e,32,t,e.length),i=e.length,r=e.length,"number"!=typeof a?r:(a=~~a)>=i?i:a>=0||(a+=i)>=0?a:0);for(;t<n&&0===e[t];)t++;return n===t?0:parseInt(s.toString(e.subarray(t,n)),8)}var a,i,r}function f(e,t,n,a){return s.toString(e.subarray(t,d(e,0,t,t+n)),a)}function g(e){const t=s.byteLength(e);let n=Math.floor(Math.log(t)/Math.log(10))+1;return t+n>=Math.pow(10,n)&&n++,t+n+e}n.decodeLongPath=function(e,t){return f(e,0,e.length,t)},n.encodePax=function(e){let t="";e.name&&(t+=g(" path="+e.name+"\n")),e.linkname&&(t+=g(" linkpath="+e.linkname+"\n"));const n=e.pax;if(n)for(const e in n)t+=g(" "+e+"="+n[e]+"\n");return s.from(t)},n.decodePax=function(e){const t={};for(;e.length;){let n=0;for(;n<e.length&&32!==e[n];)n++;const a=parseInt(s.toString(e.subarray(0,n)),10);if(!a)return t;const i=s.toString(e.subarray(n+1,a-1)),r=i.indexOf("=");if(-1===r)return t;t[i.slice(0,r)]=i.slice(r+1),e=e.subarray(a)}return t},n.encode=function(e){const t=s.alloc(512);let n=e.name,o="";if(5===e.typeflag&&"/"!==n[n.length-1]&&(n+="/"),s.byteLength(n)!==n.length)return null;for(;s.byteLength(n)>100;){const e=n.indexOf("/");if(-1===e)return null;o+=o?"/"+n.slice(0,e):n.slice(0,e),n=n.slice(e+1)}return s.byteLength(n)>100||s.byteLength(o)>155||e.linkname&&s.byteLength(e.linkname)>100?null:(s.write(t,n),s.write(t,h(4095&e.mode,6),100),s.write(t,h(e.uid,6),108),s.write(t,h(e.gid,6),116),function(e,t,n){e.toString(8).length>11?function(e,t,n){t[n]=128;for(let s=11;s>0;s--)t[n+s]=255&e,e=Math.floor(e/256)}(e,t,n):s.write(t,h(e,11),n)}(e.size,t,124),s.write(t,h(e.mtime.getTime()/1e3|0,11),136),t[156]=a+function(e){switch(e){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}return 0}(e.type),e.linkname&&s.write(t,e.linkname,157),s.copy(i,t,l),s.copy(r,t,263),e.uname&&s.write(t,e.uname,265),e.gname&&s.write(t,e.gname,297),s.write(t,h(e.devmajor||0,6),329),s.write(t,h(e.devminor||0,6),337),o&&s.write(t,o,345),s.write(t,h(p(t),6),148),t)},n.decode=function(e,t,n){let r=0===e[156]?0:e[156]-a,d=f(e,0,100,t);const h=m(e,100,8),g=m(e,108,8),y=m(e,116,8),v=m(e,124,12),b=m(e,136,12),S=function(e){switch(e){case 0:return"file";case 1:return"link";case 2:return"symlink";case 3:return"character-device";case 4:return"block-device";case 5:return"directory";case 6:return"fifo";case 7:return"contiguous-file";case 72:return"pax-header";case 55:return"pax-global-header";case 27:return"gnu-long-link-path";case 28:case 30:return"gnu-long-path"}return null}(r),w=0===e[157]?null:f(e,157,100,t),T=f(e,265,32),_=f(e,297,32),k=m(e,329,8),E=m(e,337,8),P=p(e);if(256===P)return null;if(P!==m(e,148,8))throw new Error("Invalid tar header. Maybe the tar is corrupted or it needs to be gunzipped?");if(function(e){return s.equals(i,e.subarray(l,263))}(e))e[345]&&(d=f(e,345,155,t)+"/"+d);else if(function(e){return s.equals(o,e.subarray(l,263))&&s.equals(c,e.subarray(u,265))}(e));else if(!n)throw new Error("Invalid tar header: unknown format.");return 0===r&&d&&"/"===d[d.length-1]&&(r=5),{name:d,mode:h,uid:g,gid:y,size:v,mtime:new Date(1e3*b),type:S,linkname:w,uname:T,gname:_,devmajor:k,devminor:E,pax:null}}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/headers.js"}],[248,{"../../../../../shared/constants/permissions":5437,"../../../controllers/permissions":170,"@metamask/chain-agnostic-permission":1281,"@metamask/permission-controller":2260,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.revokePermissionsHandler=void 0;var s=e("@metamask/permission-controller"),a=e("@metamask/utils"),i=e("@metamask/chain-agnostic-permission"),r=e("../../../../../shared/constants/permissions"),o=e("../../../controllers/permissions");n.revokePermissionsHandler={methodNames:[s.MethodNames.RevokePermissions],implementation:function(e,t,n,c,{revokePermissionsForOrigin:l,rejectApprovalRequestsForOrigin:u}){const{params:d}=e,p=null==d?void 0:d[0];if(!p)return c((0,s.invalidParams)({data:{request:e}}));const h=Object.keys(p).filter(e=>e!==i.Caip25EndowmentPermissionName);if(!(0,a.isNonEmptyArray)(h))return c((0,s.invalidParams)({data:{request:e}}));const m=[r.RestrictedMethods.eth_accounts,o.PermissionNames.permittedChains],f=h.filter(e=>!m.includes(e));f.length!==h.length&&f.push(i.Caip25EndowmentPermissionName);return l(f),u(),t.result=null,c()},hookNames:{revokePermissionsForOrigin:!0,rejectApprovalRequestsForOrigin:!0,updateCaveat:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-revokePermissions.ts"}],[2480,{"./extract":2478,"./pack":2481},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){n.extract=e("./extract"),n.pack=e("./pack")}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/index.js"}],[2481,{"./constants":2477,"./headers":2479,b4a:3637,streamx:5301},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const{Readable:s,Writable:a,getStreamError:i}=e("streamx"),r=e("b4a"),o=e("./constants"),c=e("./headers"),l=r.alloc(1024);class u extends a{constructor(e,t,n){super({mapWritable:m,eagerOpen:!0}),this.written=0,this.header=t,this._callback=n,this._linkname=null,this._isLinkname="symlink"===t.type&&!t.linkname,this._isVoid="file"!==t.type&&"contiguous-file"!==t.type,this._finished=!1,this._pack=e,this._openCallback=null,null===this._pack._stream?this._pack._stream=this:this._pack._pending.push(this)}_open(e){this._openCallback=e,this._pack._stream===this&&this._continueOpen()}_continuePack(e){if(null===this._callback)return;const t=this._callback;this._callback=null,t(e)}_continueOpen(){null===this._pack._stream&&(this._pack._stream=this);const e=this._openCallback;if(this._openCallback=null,null!==e){if(this._pack.destroying)return e(new Error("pack stream destroyed"));if(this._pack._finalized)return e(new Error("pack stream is already finalized"));this._pack._stream=this,this._isLinkname||this._pack._encode(this.header),this._isVoid&&(this._finish(),this._continuePack(null)),e(null)}}_write(e,t){return this._isLinkname?(this._linkname=this._linkname?r.concat([this._linkname,e]):e,t(null)):this._isVoid?e.byteLength>0?t(new Error("No body allowed for this entry")):t():(this.written+=e.byteLength,this._pack.push(e)?t():void(this._pack._drain=t))}_finish(){this._finished||(this._finished=!0,this._isLinkname&&(this.header.linkname=this._linkname?r.toString(this._linkname,"utf-8"):"",this._pack._encode(this.header)),h(this._pack,this.header.size),this._pack._done(this))}_final(e){if(this.written!==this.header.size)return e(new Error("Size mismatch"));this._finish(),e(null)}_getError(){return i(this)||new Error("tar entry destroyed")}_predestroy(){this._pack.destroy(this._getError())}_destroy(e){this._pack._done(this),this._continuePack(this._finished?null:this._getError()),e()}}class d extends s{constructor(e){super(e),this._drain=p,this._finalized=!1,this._finalizing=!1,this._pending=[],this._stream=null}entry(e,t,n){if(this._finalized||this.destroying)throw new Error("already finalized or destroyed");"function"==typeof t&&(n=t,t=null),n||(n=p),e.size&&"symlink"!==e.type||(e.size=0),e.type||(e.type=function(e){switch(e&o.S_IFMT){case o.S_IFBLK:return"block-device";case o.S_IFCHR:return"character-device";case o.S_IFDIR:return"directory";case o.S_IFIFO:return"fifo";case o.S_IFLNK:return"symlink"}return"file"}(e.mode)),e.mode||(e.mode="directory"===e.type?493:420),e.uid||(e.uid=0),e.gid||(e.gid=0),e.mtime||(e.mtime=new Date),"string"==typeof t&&(t=r.from(t));const s=new u(this,e,n);return r.isBuffer(t)?(e.size=t.byteLength,s.write(t),s.end(),s):(s._isVoid,s)}finalize(){this._stream||this._pending.length>0?this._finalizing=!0:this._finalized||(this._finalized=!0,this.push(l),this.push(null))}_done(e){e===this._stream&&(this._stream=null,this._finalizing&&this.finalize(),this._pending.length&&this._pending.shift()._continueOpen())}_encode(e){if(!e.pax){const t=c.encode(e);if(t)return void this.push(t)}this._encodePax(e)}_encodePax(e){const t=c.encodePax({name:e.name,linkname:e.linkname,pax:e.pax}),n={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.byteLength,mtime:e.mtime,type:"pax-header",linkname:e.linkname&&"PaxHeader",uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};this.push(c.encode(n)),this.push(t),h(this,t.byteLength),n.size=e.size,n.type=e.type,this.push(c.encode(n))}_doDrain(){const e=this._drain;this._drain=p,e()}_predestroy(){const e=i(this);for(this._stream&&this._stream.destroy(e);this._pending.length;){const t=this._pending.shift();t.destroy(e),t._continueOpen()}this._doDrain()}_read(e){this._doDrain(),e()}}function p(){}function h(e,t){(t&=511)&&e.push(l.subarray(0,512-t))}function m(e){return r.isBuffer(e)?e:r.from(e)}t.exports=function(e){return new d(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/pack.js"}],[2486,{"./verify":2487,"@metamask/superstruct":2705,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryDatabaseStruct=n.BlockedSnapStruct=n.BlockReasonStruct=n.VerifiedSnapStruct=n.ImagePathStruct=n.AdditionalSourceCodeStruct=n.SupportStruct=n.AuditStruct=n.AuthorStruct=void 0;const i=e("@metamask/superstruct"),r=e("@metamask/utils"),o=(0,i.refine)((0,i.string)(),"Npm ID",e=>e.startsWith("npm:")),c=(0,i.object)({checksum:r.ChecksumStruct});n.AuthorStruct=(0,i.object)({name:(0,i.string)(),website:(0,i.string)()}),n.AuditStruct=(0,i.object)({auditor:(0,i.string)(),report:(0,i.string)()}),n.SupportStruct=(0,i.object)({knowledgeBase:(0,i.optional)((0,i.string)()),faq:(0,i.optional)((0,i.string)()),contact:(0,i.optional)((0,i.string)()),keyRecovery:(0,i.optional)((0,i.string)())}),n.AdditionalSourceCodeStruct=(0,i.object)({name:(0,i.string)(),url:(0,i.string)()}),n.ImagePathStruct=(0,i.pattern)((0,i.string)(),/\.\/images\/.*\/\d+\.(?:png|jpe?g)$/u),n.VerifiedSnapStruct=(0,i.object)({id:o,metadata:(0,i.object)({name:(0,i.string)(),type:(0,i.optional)((0,i.enums)(["account"])),author:(0,i.optional)(n.AuthorStruct),website:(0,i.optional)((0,i.string)()),onboard:(0,i.optional)((0,i.boolean)()),summary:(0,i.optional)((0,i.string)()),description:(0,i.optional)((0,i.string)()),audits:(0,i.optional)((0,i.array)(n.AuditStruct)),category:(0,i.optional)((0,i.enums)(["interoperability","notifications","transaction insights","account management","name resolution"])),tags:(0,i.optional)((0,i.array)((0,i.string)())),support:(0,i.optional)(n.SupportStruct),sourceCode:(0,i.optional)((0,i.string)()),hidden:(0,i.optional)((0,i.boolean)()),privateCode:(0,i.optional)((0,i.boolean)()),privacyPolicy:(0,i.optional)((0,i.string)()),termsOfUse:(0,i.optional)((0,i.string)()),additionalSourceCode:(0,i.optional)((0,i.array)(n.AdditionalSourceCodeStruct)),screenshots:(0,i.optional)((0,i.size)((0,i.array)(n.ImagePathStruct),3,3))}),versions:(0,i.record)(r.VersionStruct,c)}),n.BlockReasonStruct=(0,i.object)({explanation:(0,i.optional)((0,i.string)()),url:(0,i.optional)((0,i.string)())}),n.BlockedSnapStruct=(0,i.union)([(0,i.object)({id:o,versionRange:r.VersionRangeStruct,reason:(0,i.optional)(n.BlockReasonStruct)}),(0,i.object)({checksum:r.ChecksumStruct,reason:(0,i.optional)(n.BlockReasonStruct)})]),n.SnapsRegistryDatabaseStruct=(0,i.object)({verifiedSnaps:(0,i.record)(o,n.VerifiedSnapStruct),blockedSnaps:(0,i.array)(n.BlockedSnapStruct)}),a(e("./verify"),n)}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/index.js"}],[2487,{"@metamask/superstruct":2705,"@metamask/utils":2799,"@noble/curves/secp256k1":2840,"@noble/hashes/sha256":2852},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.verify=n.SignatureStruct=void 0;const s=e("@metamask/superstruct"),a=e("@metamask/utils"),i=e("@noble/curves/secp256k1"),r=e("@noble/hashes/sha256");n.SignatureStruct=(0,s.object)({signature:a.StrictHexStruct,curve:(0,s.literal)("secp256k1"),format:(0,s.literal)("DER")}),n.verify=function({registry:e,signature:t,publicKey:s}){(0,a.assertStruct)(t,n.SignatureStruct,"Invalid signature object");const o=(0,a.hexToBytes)(s);return i.secp256k1.verify((0,a.remove0x)(t.signature),(0,r.sha256)((0,a.stringToBytes)(e)),o)}}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/verify.js"}],[249,{"../../../../../shared/constants/app":5415,"@metamask/controller-utils":1301,"@metamask/rpc-errors":2384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/rpc-errors"),a=e("@metamask/controller-utils"),i=e("../../../../../shared/constants/app");const r={methodNames:[i.MESSAGE_TYPE.WATCH_ASSET,i.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,n,i,{handleWatchAssetRequest:r}){try{const{params:{options:n,type:o},origin:c,networkClientId:l}=e,{tokenId:u}=n;return[a.ERC721,a.ERC1155].includes(o)&&u!==undefined&&"string"!=typeof u?i(s.rpcErrors.invalidParams({message:`Expected parameter 'tokenId' to be type 'string'. Received type '${typeof u}'`})):(await r({asset:n,type:o,origin:c??"",networkClientId:l??""}),t.result=!0,i())}catch(e){return i(e)}},hookNames:{handleWatchAssetRequest:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/watch-asset.ts"}],[25,{"@metamask/name-controller":2156},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NameControllerInit=void 0;var s=e("@metamask/name-controller");n.NameControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n,getController:a})=>{const i=a("EnsController"),r=a("SnapsNameProvider"),o=()=>t.call("PreferencesController:getState").useExternalNameSources;return{controller:new s.NameController({messenger:e,state:n.NameController,providers:[new s.ENSNameProvider({reverseLookup:i.reverseResolveAddress.bind(i)}),new s.EtherscanNameProvider({isEnabled:o}),new s.TokenNameProvider({isEnabled:o}),new s.LensNameProvider({isEnabled:o}),r]})}}}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/name-controller-init.ts"}],[250,{"./createMethodMiddleware":235,"./createUnsupportedMethodMiddleware":236},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var s=e("./createMethodMiddleware");Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===s[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}}))});var a=e("./createUnsupportedMethodMiddleware");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===a[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}}))})}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/index.js"}],[251,{"./operation-safener":228,loglevel:4542,"webextension-polyfill":5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRequestSafeReload=function(e){const t=new i.OperationSafener({op:async t=>{try{await e.set(t)}catch(e){a.default.error("MetaMask - Persistence failed",e),null==o||o.captureException(e)}},wait:1e3});return{update:async(...e)=>t.execute(...e),requestSafeReload:async()=>{await t.evacuate(),s.default.runtime.reload()}}};var s=r(e("webextension-polyfill")),a=r(e("loglevel")),i=e("./operation-safener");function r(e){return e&&e.__esModule?e:{default:e}}const{sentry:o}=global}}},{package:"$root$",file:"app/scripts/lib/safe-reload.ts"}],[252,{"../util":290,"@segment/loosely-validate-event":2877,buffer:3760,"is-retry-allowed":4346,lodash:4534,"remove-trailing-slash":4987,timers:3762},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t,s){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=l(e("remove-trailing-slash")),i=l(e("@segment/loosely-validate-event")),r=e("lodash"),o=l(e("is-retry-allowed")),c=e("../util");function l(e){return e&&e.__esModule?e:{default:e}}const u=()=>({});n.default=class{constructor(e,t={}){this.writeKey=e,this.host=(0,a.default)(t.host||"https://api.segment.io"),this.flushInterval=t.flushInterval||1e4,this.flushAt=t.flushAt||Math.max(t.flushAt,1)||20,this.queue=[],this.path="/v1/batch",this.maxQueueSize=460800,this.flushed=!1,this.retryCount=3,Object.defineProperty(this,"enable",{configurable:!1,writable:!1,enumerable:!0,value:!0})}_validate(e,t){(0,i.default)(e,t)}_message(e,t,n){return this._validate(t,e),this.enqueue(e,t,n),this}identify(e,t){return this._message("identify",e,t)}track(e,t){return this._message("track",e,t)}page(e,t){return this._message("page",e,t)}enqueue(e,t,n=u){if(!this.enable)return void s(n);const a={...t,type:e};if(a.context={...a.context,library:{name:"analytics-node"}},a.timestamp||(a.timestamp=new Date),a.messageId||(a.messageId=(0,c.generateRandomId)()),a.anonymousId&&!(0,r.isString)(a.anonymousId)&&(a.anonymousId=JSON.stringify(a.anonymousId)),a.userId&&!(0,r.isString)(a.userId)&&(a.userId=JSON.stringify(a.userId)),this.queue.push({message:a,callback:n}),!this.flushed)return this.flushed=!0,void this.flush();const i=this.queue.length>=this.flushAt,o=this.queue.reduce((e,t)=>e+JSON.stringify(t).length,0)>=this.maxQueueSize;(i||o)&&this.flush(),this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))}flush(e=u){if(!this.enable)return s(e),Promise.resolve();if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.queue.length)return s(e),Promise.resolve();const n=this.queue.splice(0,this.flushAt),a=n.map(e=>e.callback),i={batch:n.map(e=>e.message),timestamp:new Date,sentAt:new Date},r={Authorization:`Basic ${t.from(this.writeKey,"utf8").toString("base64")}`};return this._sendRequest(`${this.host}${this.path}`,{method:"POST",body:JSON.stringify(i),headers:r},t=>{s(()=>{a.forEach(e=>e(t,i)),e(t,i)})},0)}_retryRequest(e,t,n,s){const a=100*Math.pow(2,s);setTimeout(()=>{this._sendRequest(e,t,n,s+1)},a)}async _sendRequest(e,t,n,s){return fetch(e,t).then(async a=>{if(a.ok)n();else if(this._isErrorRetryable({response:a})&&s<=this.retryCount)this._retryRequest(e,t,n,s);else{const e=new Error(a.statusText);n(e)}}).catch(a=>{this._isErrorRetryable(a)&&s<=this.retryCount?this._retryRequest(e,t,n,s):n(a)})}_isErrorRetryable(e){return!!function(e){return!e.response&&Boolean(e.code)&&"ECONNABORTED"!==e.code&&(0,o.default)(e)}(e)||!!e.response&&(e.response.status>=500&&e.response.status<=599||429===e.response.status)}}}).call(this)}).call(this,e("buffer").Buffer,e("timers").setImmediate)}}},{package:"$root$",file:"app/scripts/lib/segment/analytics.js"}],[253,{"../../../../shared/constants/time":5449,"./analytics":252},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.segment=n.createSegmentMock=void 0;var s,a=e("../../../../shared/constants/time"),i=(s=e("./analytics"))&&s.__esModule?s:{default:s};const r="XdGJ17zKf3NjBPCDQ2UDjJjkx6FYBMGP",o=undefined,c=5*a.SECOND,l=(e=o)=>{const t={queue:[],flush(){t.queue.forEach(([e,t])=>{t()}),t.queue=[]},track(n,s=()=>undefined){t.queue.push([n,s]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};n.createSegmentMock=l;n.segment=r?new i.default(r,{host:null,flushAt:o,flushInterval:c}):l(o)}}},{package:"$root$",file:"app/scripts/lib/segment/index.js"}],[255,{"../../../../shared/lib/trace":5517},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.addPersonalMessage=async function({signatureParams:e,signatureController:t}){return a(e,t,"newUnsignedPersonalMessage")},n.addTypedMessage=async function({signatureParams:e,signatureController:t}){return a(e,t,"newUnsignedTypedMessage")};var s=e("../../../../shared/lib/trace");async function a(e,t,n){const[,a]=e,{id:i}=a,r=null==i?void 0:i.toString();(0,s.endTrace)({name:s.TraceName.Middleware,id:r});const o=await t[n](...e);return(0,s.endTrace)({name:s.TraceName.Signature,id:r}),o}}}},{package:"$root$",file:"app/scripts/lib/signature/util.ts"}],[256,{"../../../../shared/constants/app":5415,"../../../../shared/constants/smartTransactions":5443,"../../../../shared/modules/conversion.utils":5529,"../../../../shared/modules/selectors":5545,"../../../../shared/modules/transaction.utils":5553,"@metamask/smart-transactions-controller/dist/types":2427,"@metamask/transaction-controller":2754,loglevel:4542},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSmartTransactionCommonParams=function(e,t){const n=function(e){return{metamask:e}}(e),s=(0,u.getIsSmartTransaction)(n,t),a=(0,u.getFeatureFlagsByChainId)(n,t),i=(0,u.isHardwareWallet)(n);return{isSmartTransaction:s,featureFlags:a,isHardwareWalletAccount:i}},n.submitSmartTransactionHook=n.submitBatchSmartTransactionHook=void 0;var s,a=e("@metamask/smart-transactions-controller/dist/types"),i=e("@metamask/transaction-controller"),r=(s=e("loglevel"))&&s.__esModule?s:{default:s},o=e("../../../../shared/constants/app"),c=e("../../../../shared/constants/smartTransactions"),l=e("../../../../shared/modules/conversion.utils"),u=e("../../../../shared/modules/selectors"),d=e("../../../../shared/modules/transaction.utils");function p(e,t,n){h(e,t),t.set(e,n)}function h(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function m(e,t){return e.get(g(e,t))}function f(e,t,n){return e.set(g(e,t),n),n}function g(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var y=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,w=new WeakMap,T=new WeakMap,_=new WeakMap,k=new WeakMap,E=new WeakMap,P=new WeakMap,A=new WeakMap,C=new WeakMap,M=new WeakMap,O=new WeakMap,I=new WeakSet;class j{constructor(e){!function(e,t){h(e,t),t.add(e)}(this,I),p(this,y,void 0),p(this,v,void 0),p(this,b,void 0),p(this,S,void 0),p(this,w,void 0),p(this,T,void 0),p(this,_,void 0),p(this,k,void 0),p(this,E,void 0),p(this,P,void 0),p(this,A,void 0),p(this,C,void 0),p(this,M,void 0),p(this,O,void 0);const{transactionMeta:t,signedTransactionInHex:n,smartTransactionsController:s,transactionController:a,isSmartTransaction:r,controllerMessenger:c,featureFlags:l,transactions:u}=e;f(v,this,""),f(y,this,!1),f(P,this,t),f(A,this,n),f(k,this,s),f(E,this,a),f(_,this,r),f(S,this,c),f(w,this,l),f(T,this,t.origin!==o.ORIGIN_METAMASK),f(b,this,t.chainId),f(M,this,t.txParams),f(C,this,u),f(O,this,Boolean(t.type!==i.TransactionType.bridge||m(C,this)&&m(C,this).length>0))}async submit(){const e=!!m(P,this).type&&[i.TransactionType.swapAndSend,i.TransactionType.swapApproval,i.TransactionType.bridgeApproval].includes(m(P,this).type),t={transactionHash:undefined};if(!m(_,this)||e||(0,d.isLegacyTransaction)(m(P,this)))return t;let n;m(O,this)&&await g(I,this,N).call(this);try{n=await m(k,this).getFees({...m(M,this),chainId:m(b,this)},undefined,{networkClientId:m(P,this).networkClientId})}catch(e){return r.default.error("Error in smart transaction publish hook, falling back to regular transaction submission",e),g(I,this,L).call(this),t}try{var s;const e=await g(I,this,H).call(this,{getFeesResponse:n}),t=null==e?void 0:e.uuid;if(!t)throw new Error("No smart transaction UUID");await g(I,this,D).call(this,t);let a;if(a=(null===(s=m(w,this))||void 0===s||null===(s=s.smartTransactions)||void 0===s?void 0:s.extensionReturnTxHashAsap)&&null!=e&&e.txHash?e.txHash:await g(I,this,B).call(this,{uuid:t}),null===a)throw new Error("Transaction does not have a transaction hash, there was a problem");return{transactionHash:a}}catch(e){throw r.default.error("Error in smart transaction publish hook",e),g(I,this,L).call(this),e}}async submitBatch(){if(!m(_,this))throw new Error("submitBatch: Smart Transaction is required for batch submissions");m(O,this)&&await g(I,this,N).call(this);try{const e=await g(I,this,H).call(this),t=null==e?void 0:e.uuid;if(!t)throw new Error("submitBatch: No smart transaction UUID");await g(I,this,D).call(this,t);if(null===await g(I,this,B).call(this,{uuid:t}))throw new Error("submitBatch: Transaction does not have a transaction hash, there was a problem");let n;return n=null!=e&&e.txHashes?{results:e.txHashes.map(e=>({transactionHash:e}))}:{results:[]},n}catch(e){throw r.default.error("submitBatch: Error in smart transaction publish batch hook",e),g(I,this,L).call(this),e}}}async function R(e){try{await m(S,this).call("ApprovalController:endFlow",{id:e})}catch(e){}}async function x(e){try{await g(I,this,R).call(this,e),await m(S,this).call("ApprovalController:acceptRequest",e),V._=""}catch(e){r.default.error("Error ending existing approval flow",e)}}async function N(){V._&&await g(I,this,x).call(this,V._);const{id:e}=await m(S,this).call("ApprovalController:startFlow");f(v,this,e),V._=e}async function D(e){m(O,this)&&(g(I,this,F).call(this,{uuid:e}),g(I,this,$).call(this,{uuid:e}))}function L(){m(O,this)&&!m(y,this)&&(f(y,this,!0),g(I,this,R).call(this,m(v,this)),V._===m(v,this)&&(V._=""))}function F({uuid:e}){const t=()=>{g(I,this,L).call(this)};m(S,this).call("ApprovalController:addRequest",{id:m(v,this),origin:origin,type:o.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage,requestState:{smartTransaction:{status:a.SmartTransactionStatuses.PENDING,creationTime:Date.now(),uuid:e},isDapp:m(T,this),txId:m(P,this).id}},!0).then(t,t)}async function U({smartTransaction:e}){return await m(S,this).call("ApprovalController:updateRequestState",{id:m(v,this),requestState:{smartTransaction:e,isDapp:m(T,this),txId:m(P,this).id}})}async function $({uuid:e}){m(S,this).subscribe("SmartTransactionsController:smartTransaction",async t=>{if(t.uuid===e){const{status:e}=t;if(!e||e===a.SmartTransactionStatuses.PENDING)return;m(y,this)||await g(I,this,U).call(this,{smartTransaction:t})}})}function B({uuid:e}){return new Promise(t=>{m(S,this).subscribe("SmartTransactionsController:smartTransaction",async n=>{if(n.uuid===e){const{status:e,statusMetadata:s}=n;if(!e||e===a.SmartTransactionStatuses.PENDING)return;r.default.debug("Smart Transaction: ",n),null!=s&&s.minedHash?(r.default.debug("Smart Transaction - Received tx hash: ",null==s?void 0:s.minedHash),t(s.minedHash)):t(null)}})})}async function H({getFeesResponse:e}={}){let t=[];if(m(C,this)&&Array.isArray(m(C,this))&&m(C,this).length>0)t=m(C,this).filter(e=>null==e?void 0:e.signedTx).map(e=>e.signedTx);else if(m(A,this))t=[m(A,this)];else if(e){var n;t=await g(I,this,q).call(this,(null===(n=e.tradeTxFees)||void 0===n?void 0:n.fees)??[],!1)}return await m(k,this).submitSignedTransactions({signedTransactions:t,signedCanceledTransactions:[],txParams:m(M,this),transactionMeta:m(P,this),networkClientId:m(P,this).networkClientId})}function G(e,t){if(!m(M,this))throw new Error("Transaction params are required");const n={...m(M,this),maxFeePerGas:`0x${(0,l.decimalToHex)(e.maxFeePerGas)}`,maxPriorityFeePerGas:`0x${(0,l.decimalToHex)(e.maxPriorityFeePerGas)}`,gas:t?`0x${(0,l.decimalToHex)(c.CANCEL_GAS_LIMIT_DEC)}`:m(M,this).gas};return t&&(n.to=n.from,n.data="0x"),n}async function q(e,t){if(!m(M,this)||!m(b,this))throw new Error("Transaction params and chainId are required");const n=e.map(e=>g(I,this,G).call(this,e,t)).map(e=>({...e,chainId:e.chainId||m(b,this)}));return await m(E,this).approveTransactionsWithSameNonce(n,{hasNonce:!0})}var V={_:""};n.submitSmartTransactionHook=e=>new j(e).submit();n.submitBatchSmartTransactionHook=e=>new j(e).submitBatch()}}},{package:"$root$",file:"app/scripts/lib/smart-transaction/smart-transactions.ts"}],[257,{"./snap-keyring":260,"./utils":261},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getAccountsBySnapId",{enumerable:!0,get:function(){return a.getAccountsBySnapId}}),Object.defineProperty(n,"snapKeyringBuilder",{enumerable:!0,get:function(){return s.snapKeyringBuilder}});var s=e("./snap-keyring"),a=e("./utils")}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/index.ts"}],[258,{"@metamask/keyring-api":1994,"@metamask/permission-controller":2260},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isProtocolAllowed=u,n.keyringSnapPermissionsBuilder=function(e,t){return()=>{if("metamask"===t)return r;if(i.includes(t))return c;const n=e.getSubjectMetadata(t);return(null==n?void 0:n.subjectType)===a.SubjectType.Website&&u(t)?o:[]}};var s=e("@metamask/keyring-api"),a=e("@metamask/permission-controller");const i=["https://app.metamask.io"],r=[s.KeyringRpcMethod.ListAccounts,s.KeyringRpcMethod.GetAccount,s.KeyringRpcMethod.FilterAccountChains,s.KeyringRpcMethod.DeleteAccount,s.KeyringRpcMethod.ListRequests,s.KeyringRpcMethod.GetRequest,s.KeyringRpcMethod.SubmitRequest,s.KeyringRpcMethod.RejectRequest],o=[s.KeyringRpcMethod.ListAccounts,s.KeyringRpcMethod.GetAccount,s.KeyringRpcMethod.CreateAccount,s.KeyringRpcMethod.FilterAccountChains,s.KeyringRpcMethod.UpdateAccount,s.KeyringRpcMethod.DeleteAccount,s.KeyringRpcMethod.ExportAccount,s.KeyringRpcMethod.ListRequests,s.KeyringRpcMethod.GetRequest,s.KeyringRpcMethod.ApproveRequest,s.KeyringRpcMethod.RejectRequest],c=[s.KeyringRpcMethod.ListAccounts,s.KeyringRpcMethod.GetAccount,s.KeyringRpcMethod.GetAccountBalances,s.KeyringRpcMethod.SubmitRequest],l=["https:"];function u(e){try{const t=new URL(e);return l.includes(t.protocol)}catch(e){return!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/keyring-snaps-permissions.ts"}],[259,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapAndHardwareInfoForMetrics=async function(e,t,n,s){var a,i,r;if(!s)return{};const o=s.call("AccountsController:getSelectedAccount"),c=o.address;let l;var u;null!==(a=o.metadata.snap)&&void 0!==a&&a.id&&(l=s.call("SnapController:get",null===(u=o.metadata.snap)||void 0===u?void 0:u.id));return{account_type:await e(c),device_model:await t(c),account_hardware_type:await n(c),account_snap_type:null===(i=l)||void 0===i?void 0:i.id,account_snap_version:null===(r=l)||void 0===r?void 0:r.version}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/metrics.ts"}],[26,{"../../lib/ppom/indexed-db-backend":229,"../../lib/ppom/ppom":232,"../init-utils":34,"@metamask/ppom-validator":2288},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PPOMControllerInit=void 0;var s=e("@metamask/ppom-validator"),a=e("../../lib/ppom/indexed-db-backend"),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var s={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var r=a?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(s,i,r):s[i]=e[i]}return s.default=e,n&&n.set(e,s),s}(e("../../lib/ppom/ppom")),r=e("../init-utils");function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}n.PPOMControllerInit=e=>{const{controllerMessenger:t,initMessenger:n,getController:o,persistedState:c}=e,{provider:l}=n.call("NetworkController:getSelectedNetworkClient")??{};return{controller:new s.PPOMController({messenger:t,storageBackend:new a.IndexedDBPPOMStorage("PPOMDB",1),provider:l,ppomProvider:{PPOM:i.PPOM,ppomInit:()=>i.default("./ppom_bg.wasm")},state:c.PPOMController,chainId:(0,r.getGlobalChainId)(n),securityAlertsEnabled:o("PreferencesController").state.securityAlertsEnabled,onPreferencesChange:n.subscribe.bind(n,"PreferencesController:stateChange"),cdnBaseUrl:"static.cx.metamask.io/api/v1/confirmations/ppom",blockaidPublicKey:"066ad3e8af5583385e312c156d238055215d5f25247c1e91055afa756cb98a88"})}}}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/ppom-controller-init.ts"}],[260,{"../../../../shared/constants/app":5415,"../../../../shared/constants/metametrics":5430,"../../../../shared/lib/accounts":5456,"../../../../shared/lib/accounts/snaps":5458,"../../../../shared/lib/snaps/snaps":5512,"../../../../shared/lib/translate":5522,"../../../../ui/components/component-library/icon":6096,"./utils/isBlockedUrl":262,"./utils/showResult":263,"@metamask/eth-snap-keyring":1864,"@metamask/snaps-utils":2677,"webextension-polyfill":5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showAccountCreationDialog=w,n.showAccountNameSuggestionDialog=T,n.snapKeyringBuilder=function(e,t){const n=()=>new a.SnapKeyring({messenger:e,callbacks:new C(e,t)});return n.state=null,n.type=a.SnapKeyring.type,n};var s,a=e("@metamask/eth-snap-keyring"),i=(s=e("webextension-polyfill"))&&s.__esModule?s:{default:s},r=e("@metamask/snaps-utils"),o=e("../../../../shared/constants/metametrics"),c=e("../../../../shared/constants/app"),l=e("../../../../shared/lib/translate"),u=e("../../../../ui/components/component-library/icon"),d=e("../../../../shared/lib/accounts"),p=e("../../../../shared/lib/snaps/snaps"),h=e("../../../../shared/lib/accounts/snaps"),m=e("./utils/isBlockedUrl"),f=e("./utils/showResult");function g(e,t,n){y(e,t),t.set(e,n)}function y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function v(e,t){return e.get(S(e,t))}function b(e,t,n){return e.set(S(e,t),n),n}function S(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}async function w(e,t){try{return Boolean(await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation},!0))}catch(e){throw new Error(`Error occurred while showing account creation dialog.\n${e}`)}}async function T(e,t,n){try{return await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showNameSnapAccount,requestData:{snapSuggestedAccountName:n}},!0)}catch(e){throw new Error(`Error occurred while showing name account dialog.\n${e}`)}}var _=new WeakMap,k=new WeakMap,E=new WeakMap,P=new WeakMap,A=new WeakSet;class C{constructor(e,{trackEvent:t,persistKeyringHelper:n,removeAccountHelper:s}){!function(e,t){y(e,t),t.add(e)}(this,A),g(this,_,void 0),g(this,k,void 0),g(this,E,void 0),g(this,P,void 0),b(_,this,e),b(k,this,t),b(E,this,n),b(P,this,s)}async addressExists(e){return(await v(_,this).call("KeyringController:getAccounts")).includes(e.toLowerCase())}async redirectUser(e,t,n){if(t.length>0||n.length>0){const s=await(0,m.isBlockedUrl)(t,async()=>await v(_,this).call("PhishingController:maybeUpdateState"),e=>v(_,this).call("PhishingController:testOrigin",e)),a=await v(_,this).call("ApprovalController:addRequest",{origin:e,requestData:{url:t,message:n,isBlockedUrl:s},type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect},!0);Boolean(a)&&t.length>0?i.default.tabs.create({url:t}):console.log("User refused snap account redirection to:",t)}else console.log("Error occurred when redirecting snap account. url or message must be defined")}async saveState(){await v(E,this).call(this)}async addAccount(e,t,n,s,i="",{displayConfirmation:o,displayAccountNameSuggestion:c,setSelectedAccount:l}=(0,a.getDefaultInternalOptions)()){(0,r.assertIsValidSnapId)(t);const u=(0,p.isSnapPreinstalled)(t)&&!o,d=(0,p.isSnapPreinstalled)(t)&&!c,h=(0,p.isSnapPreinstalled)(t)&&!l,m=u&&d,{accountName:f}=await S(A,this,j).call(this,{snapId:t,skipConfirmationDialog:u,skipAccountNameSuggestionDialog:d,skipApprovalFlow:m,accountNameSuggestion:i,handleUserInput:n});S(A,this,R).call(this,{address:e,snapId:t,skipConfirmationDialog:u,skipSetSelectedAccountStep:h,skipApprovalFlow:m,accountName:f,onceSaved:s,defaultAccountNameChosen:Boolean(i)&&f===i})}async removeAccount(e,t,n){(0,r.assertIsValidSnapId)(t);const s=(0,h.getSnapName)(t,v(_,this)),{id:a}=v(_,this).call("ApprovalController:startFlow"),i="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-remove-an-account-from-your-metamask-wallet/",d=e=>{v(k,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:s}})};let p=!1;try{if(p=Boolean(await v(_,this).call("ApprovalController:addRequest",{origin:t,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval,requestData:{publicAddress:e}},!0)),!p)throw await n(p),new Error("User denied account removal");try{await v(P,this).call(this,e),await n(p),await v(E,this).call(this),d(o.MetaMetricsEventName.RemoveSnapAccountSuccessViewed),await(0,f.showError)(v(_,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemoved")},{message:(0,l.t)("snapAccountRemovedDescription"),learnMoreLink:i}),d(o.MetaMetricsEventName.RemoveSnapAccountSuccessClicked)}catch(e){const n=e.message;throw await(0,f.showError)(v(_,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemovalFailed")},{message:(0,l.t)("snapAccountRemovalFailedDescription",s),learnMoreLink:i,error:n}),d(o.MetaMetricsEventName.AccountRemoveFailed),new Error(`Error occurred while removing snap account: ${n}`)}}finally{p&&d(o.MetaMetricsEventName.AccountRemoved),v(_,this).call("ApprovalController:endFlow",{id:a})}}}async function M(e){const{id:t}=v(_,this).call("ApprovalController:startFlow");try{return await e(t)}finally{v(_,this).call("ApprovalController:endFlow",{id:t})}}async function O(e,t){const{success:n,name:s}=await T(e,v(_,this),t);return{success:n,accountName:s}}async function I(e){const t=await v(_,this).call("AccountsController:listMultichainAccounts");return{success:!0,accountName:(0,d.getUniqueAccountName)(t,e)}}async function j({snapId:e,skipConfirmationDialog:t,skipAccountNameSuggestionDialog:n,skipApprovalFlow:s,handleUserInput:a,accountNameSuggestion:i}){if(s){const{success:e,accountName:t}=await S(A,this,I).call(this,i);if(await a(e),!e)throw new Error("User denied account creation");return{accountName:t}}return await S(A,this,M).call(this,async s=>{{const n=t||await w(e,v(_,this));if(!n)throw await a(n),new Error("User denied account creation")}{const{success:t,accountName:s}=n?await S(A,this,I).call(this,i):await S(A,this,O).call(this,e,i);if(await a(t),!t)throw new Error("User denied account creation");return{accountName:s}}})}async function R({address:e,snapId:t,skipConfirmationDialog:n,skipSetSelectedAccountStep:s,skipApprovalFlow:a,accountName:i,onceSaved:r,defaultAccountNameChosen:c}){const d="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-add-accounts-in-your-wallet/",p=(0,h.getSnapName)(t,v(_,this)),m=e=>{v(k,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:p,...e===o.MetaMetricsEventName.AccountAdded&&{is_suggested_name:c}}})},g=async()=>{try{const a=await r;s||v(_,this).call("AccountsController:setSelectedAccount",a),i&&v(_,this).call("AccountsController:setAccountName",a,i),n||(m(o.MetaMetricsEventName.AddSnapAccountSuccessViewed),await(0,f.showSuccess)(v(_,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreated")},{message:(0,l.t)("snapAccountCreatedDescription"),address:e,learnMoreLink:d}),m(o.MetaMetricsEventName.AddSnapAccountSuccessClicked)),m(o.MetaMetricsEventName.AccountAdded)}catch(e){const n=e.message;await(0,f.showError)(v(_,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreationFailed")},{message:(0,l.t)("snapAccountCreationFailedDescription",p),learnMoreLink:d,error:n}),console.error("Error occurred while creating snap account:",n)}};a?await g():await S(A,this,M).call(this,g)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/snap-keyring.ts"}],[261,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAccountsBySnapId=void 0;n.getAccountsBySnapId=async(e,t)=>{const n=await e();return await n.getAccountsBySnapId(t)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils.ts"}],[262,{"../keyring-snaps-permissions":258},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isBlockedUrl=void 0;var s=e("../keyring-snaps-permissions");n.isBlockedUrl=async(e,t,n)=>{try{return!(0,s.isProtocolAllowed)(e)||(await t(),n(e).result)}catch(e){return console.error("Invalid URL passed into snap-keyring:",e),!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/isBlockedUrl.ts"}],[263,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showSuccess=n.showError=void 0;const s=e=>({name:"SnapAuthorshipHeader",key:"snapHeader",properties:{snapId:e}});n.showError=(e,t,n,a)=>e.call("ApprovalController:showError",{header:[s(t)],title:n.title,icon:n.icon,error:{key:"snapAccountErrorMessage",name:"SnapAccountErrorMessage",properties:a}});n.showSuccess=(e,t,n,a)=>e.call("ApprovalController:showSuccess",{header:[s(t)],title:n.title,icon:n.icon,message:{key:"snapAccountSuccessMessage",name:"SnapAccountSuccessMessage",properties:a}})}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/showResult.ts"}],[264,{loglevel:4542},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.tryPostMessage=function(e,t,n){const s={data:{method:t,params:n}};try{return e.postMessage(s),!0}catch(e){return a.default.error("MetaMask - Failed to message to port",e,s),!1}};var s,a=(s=e("loglevel"))&&s.__esModule?s:{default:s}}}},{package:"$root$",file:"app/scripts/lib/start-up-errors/start-up-errors.ts"}],[265,{"../../../../shared/constants/start-up-errors":5445,"../../../../shared/constants/state-corruption":5446,"../start-up-errors/start-up-errors":264,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CorruptionHandler=void 0,n.hasVault=c;var s=e("@metamask/utils"),a=e("../../../../shared/constants/state-corruption"),i=e("../start-up-errors/start-up-errors"),r=e("../../../../shared/constants/start-up-errors");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){if((0,s.isObject)(e)&&(0,s.hasProperty)(e,"KeyringController")){const t=e.KeyringController;if((0,s.isObject)(t)&&(0,s.hasProperty)(t,"vault"))return Boolean(t.vault)}return!1}n.CorruptionHandler=class{constructor(){o(this,"connectedPorts",new Set)}async handleStateCorruptionError({port:e,error:t,database:n,repairCallback:o}){const{connectedPorts:l}=this,u=await async function(e,t){let n=(0,s.isObject)(e)&&(0,s.hasProperty)(e,"backup")&&null!==e.backup?e.backup:null;if(!n)try{n=await t.getBackup()??null}catch{n=null}return n}(t,n),d=function(e){if((0,s.isObject)(e)&&(0,s.hasProperty)(e,"PreferencesController")){const t=e.PreferencesController;if((0,s.isObject)(t)&&(0,s.hasProperty)(t,"currentLocale")&&"string"==typeof t.currentLocale)return t.currentLocale}return null}(u),p=Boolean(c(u));return(0,i.tryPostMessage)(e,a.METHOD_DISPLAY_STATE_CORRUPTION_ERROR,{error:{message:t.message,name:t.name,stack:t.stack},currentLocale:d,hasBackup:p})?new Promise((t,n)=>{l.add(e),e.onDisconnect.addListener(function(){l.delete(e),t()}),e.onMessage.addListener(async function e(s){var c;if((null==s||null===(c=s.data)||void 0===c?void 0:c.method)===a.METHOD_REPAIR_DATABASE){l.forEach(t=>t.onMessage.removeListener(e));try{await async function(e){return await navigator.locks.request("repairDatabase",{ifAvailable:!0},async function(t){return null!==t&&(await e(),!0)})}(async function(){try{await o(u)}finally{l.forEach(e=>{(0,i.tryPostMessage)(e,r.RELOAD_WINDOW)})}}),t()}catch(e){n(e)}}})}):Promise.resolve()}}}}},{package:"$root$",file:"app/scripts/lib/state-corruption/state-corruption-recovery.ts"}],[266,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitizeUIState=function(e){const t={...e};for(const e of s)delete t[e];return function(e){const t=e.snaps;if(!t)return;e.snaps=Object.values(t).reduce((e,t)=>(e[t.id]=function(e){const t={...e};return delete t.sourceCode,delete t.auxiliaryFiles,t}(t),e),{})}(t),function(e){const t=e.srpSessionData;if(!t)return;e.srpSessionData=Object.entries(t).reduce((e,[t,n])=>{const s={...n.token};return delete s.accessToken,e[t]={...n,token:s},e},{})}(t),function(e){const t=["vault","vaultEncryptionKey","vaultEncryptionSalt","encryptedSeedlessEncryptionKey","encryptedKeyringEncryptionKey","accessToken","metadataAccessToken","refreshToken","revokeToken"];for(const n of t)delete e[n];const n=e.nodeAuthTokens;n&&(e.nodeAuthTokens=n.map(e=>{const t={...e};return delete t.authToken,t}));const s=e.socialBackupsMetadata;s&&(e.socialBackupsMetadata=s.map(e=>{const t={...e};return delete t.hash,t}))}(t),t};const s=["snapStates","unencryptedSnapStates","phishingLists","whitelist","whitelistPaths","hotlistLastFetched","stalelistLastFetched","c2DomainBlocklistLastFetched","vault","encryptionKey","encryptionSalt"]}}},{package:"$root$",file:"app/scripts/lib/state-utils.ts"}],[27,{"../../../../shared/lib/trace":5517,"../../../../shared/modules/selectors":5545,"../../../../shared/modules/shield":5550,"../../lib/smart-transaction/smart-transactions":256,"../../lib/transaction/hooks/delegation-7702-publish":280,"../../lib/transaction/hooks/enforce-simulation-hook":281,"../../lib/transaction/metrics":282,"../../lib/transaction/sentinel-api":283,"../../lib/transaction/util":285,"@metamask/smart-transactions-controller/dist/types":2427,"@metamask/transaction-controller":2754,_process:4772},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionControllerInit=void 0,n.publishBatchHook=f,n.publishHook=m;var s=e("@metamask/smart-transactions-controller/dist/types"),a=e("@metamask/transaction-controller"),i=e("../../../../shared/lib/trace"),r=e("../../../../shared/modules/selectors"),o=e("../../../../shared/modules/shield"),c=e("../../lib/smart-transaction/smart-transactions"),l=e("../../lib/transaction/hooks/delegation-7702-publish"),u=e("../../lib/transaction/hooks/enforce-simulation-hook"),d=e("../../lib/transaction/metrics"),p=e("../../lib/transaction/sentinel-api"),h=e("../../lib/transaction/util");async function m({flatState:e,initMessenger:t,signedTx:n,smartTransactionsController:s,transactionController:a,transactionMeta:i}){const{isSmartTransaction:r,featureFlags:o,isHardwareWalletAccount:u}=(0,c.getSmartTransactionCommonParams)(e,i.chainId),d=await(0,p.isSendBundleSupported)(i.chainId);if(!r||!d){const e=new l.Delegation7702PublishHook({isAtomicBatchSupported:a.isAtomicBatchSupported.bind(a),messenger:t}).getHook(),s=await e(i,n);if(null!=s&&s.transactionHash)return s}if(r&&(d||i.selectedGasFeeToken===undefined)){const e=await(0,c.submitSmartTransactionHook)({transactionMeta:i,signedTransactionInHex:n,transactionController:a,smartTransactionsController:s,controllerMessenger:t,isSmartTransaction:r,isHardwareWallet:u,featureFlags:o});if(null!=e&&e.transactionHash)return e}return{transactionHash:undefined}}function f({transactionController:e,smartTransactionsController:t,hookControllerMessenger:n,flatState:s,transactions:a}){const i=a[a.length-1],r=(0,h.getTransactionById)(i.id??"",e);if(!r)throw new Error(`publishBatchSmartTransactionHook: Could not find transaction with id ${i.id}`);const{isSmartTransaction:o,featureFlags:l,isHardwareWalletAccount:u}=(0,c.getSmartTransactionCommonParams)(s,r.chainId);return o?(0,c.submitBatchSmartTransactionHook)({transactions:a,transactionController:e,smartTransactionsController:t,controllerMessenger:n,isSmartTransaction:o,isHardwareWallet:u,featureFlags:l,transactionMeta:r}):undefined}n.TransactionControllerInit=e=>{var n;const{controllerMessenger:c,initMessenger:l,getFlatState:p,getPermittedAccounts:h,getTransactionMetricsRequest:g,updateAccountBalanceForTransactionNetwork:y,persistedState:v}=e,{gasFeeController:b,keyringController:S,networkController:w,onboardingController:T,preferencesController:_,smartTransactionsController:k}=function(e){return{gasFeeController:()=>e.getController("GasFeeController"),keyringController:()=>e.getController("KeyringController"),networkController:()=>e.getController("NetworkController"),onboardingController:()=>e.getController("OnboardingController"),preferencesController:()=>e.getController("PreferencesController"),smartTransactionsController:()=>e.getController("SmartTransactionsController"),institutionalSnapController:()=>e.getController("InstitutionalSnapController")}}(e),E=new a.TransactionController({getCurrentNetworkEIP1559Compatibility:()=>l.call("NetworkController:getEIP1559Compatibility"),getCurrentAccountEIP1559Compatibility:async()=>!0,getExternalPendingTransactions:e=>function(e,t){return e.getTransactions({addressFrom:t,status:s.SmartTransactionStatuses.PENDING})}(k(),e),getGasFeeEstimates:(...e)=>b().fetchGasFeeEstimates(...e),getNetworkClientRegistry:(...e)=>w().getNetworkClientRegistry(...e),getNetworkState:()=>w().state,getPermittedAccounts:h,getSavedGasFees:e=>_().state.advancedGasFee[e],getSimulationConfig:async e=>(0,o.getShieldGatewayConfig)(()=>l.call("AuthenticationController:getBearerToken"),e),incomingTransactions:{client:`extension-${null===(n=t.env.METAMASK_VERSION)||void 0===n?void 0:n.replace(/\./gu,"-")}`,includeTokenTransfers:!1,isEnabled:()=>_().state.useExternalServices&&T().state.completedOnboarding,updateTransactions:!0},isAutomaticGasFeeUpdateEnabled:({type:e})=>{const t=[a.TransactionType.swap,a.TransactionType.swapApproval,a.TransactionType.bridge,a.TransactionType.bridgeApproval];return!e||!t.includes(e)},isEIP7702GasFeeTokensEnabled:async e=>{const{chainId:t}=e,n={metamask:p()};return!(0,r.getIsSmartTransaction)(n,t)},isFirstTimeInteractionEnabled:()=>_().state.securityAlertsEnabled,isSimulationEnabled:()=>_().state.useTransactionSimulations,messenger:c,pendingTransactions:{isResubmitEnabled:()=>!1},publicKeyEIP7702:"0x3c7a1cCCe462e96D186B8ca9a1BCB2010C3dABa3",testGasFeeFlows:Boolean(!1),trace:i.trace,hooks:{afterSimulate:new u.EnforceSimulationHook({messenger:l}).getAfterSimulateHook(),beforePublish:e=>l.call("InstitutionalSnapController:publishHook",e),beforeSign:new u.EnforceSimulationHook({messenger:l}).getBeforeSignHook(),beforeCheckPendingTransactions:e=>l.call("InstitutionalSnapController:beforeCheckPendingTransactionHook",e),publish:(e,t)=>m({flatState:p(),initMessenger:l,signedTx:t,smartTransactionsController:k(),transactionController:E,transactionMeta:e}),publishBatch:async e=>await f({transactionController:E,smartTransactionsController:k(),hookControllerMessenger:l,flatState:p(),transactions:e.transactions})},sign:(...e)=>S().signTransaction(...e),state:v.TransactionController});!function(e,t,n){const s=t();e.subscribe("TransactionController:unapprovedTransactionAdded",n),e.subscribe("TransactionController:transactionConfirmed",n),e.subscribe("TransactionController:postTransactionBalanceUpdated",d.handlePostTransactionBalanceUpdate.bind(null,s)),e.subscribe("TransactionController:unapprovedTransactionAdded",e=>(0,d.handleTransactionAdded)(s,{transactionMeta:e})),e.subscribe("TransactionController:transactionApproved",d.handleTransactionApproved.bind(null,s)),e.subscribe("TransactionController:transactionDropped",d.handleTransactionDropped.bind(null,s)),e.subscribe("TransactionController:transactionConfirmed",d.handleTransactionConfirmed.bind(null,s)),e.subscribe("TransactionController:transactionFailed",d.handleTransactionFailed.bind(null,s)),e.subscribe("TransactionController:transactionNewSwap",({transactionMeta:t})=>e.call("SwapsController:setTradeTxId",t.id)),e.subscribe("TransactionController:transactionNewSwapApproval",({transactionMeta:t})=>e.call("SwapsController:setApproveTxId",t.id)),e.subscribe("TransactionController:transactionRejected",d.handleTransactionRejected.bind(null,s)),e.subscribe("TransactionController:transactionSubmitted",d.handleTransactionSubmitted.bind(null,s))}(l,g,y);const P=function(e){return{abortTransactionSigning:e.abortTransactionSigning.bind(e),getLayer1GasFee:e.getLayer1GasFee.bind(e),getTransactions:e.getTransactions.bind(e),isAtomicBatchSupported:e.isAtomicBatchSupported.bind(e),startIncomingTransactionPolling:e.startIncomingTransactionPolling.bind(e),stopIncomingTransactionPolling:e.stopIncomingTransactionPolling.bind(e),updateAtomicBatchData:e.updateAtomicBatchData.bind(e),updateBatchTransactions:e.updateBatchTransactions.bind(e),updateEditableParams:e.updateEditableParams.bind(e),updatePreviousGasParams:e.updatePreviousGasParams.bind(e),updateSelectedGasFeeToken:e.updateSelectedGasFeeToken.bind(e),updateTransactionGasFees:e.updateTransactionGasFees.bind(e),updateTransactionSendFlowHistory:e.updateTransactionSendFlowHistory.bind(e)}}(E);return{controller:E,api:P,memStateKey:"TxController"}}}).call(this)}).call(this,e("_process"))}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/transaction-controller-init.ts"}],[272,{"../../../../../shared/lib/delegation":5495,"../../../../../shared/lib/delegation/delegation":5492,"@metamask/transaction-controller":2754,"@metamask/utils":2799,"bignumber.js":3648},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.enforceSimulations=async function({messenger:e,transactionMeta:t,useRealSignature:n=!1}){c("Enforcing simulations",{transactionMeta:t,useRealSignature:n});const{chainId:i,simulationData:d={tokenBalanceChanges:[]},txParams:p}=t,h=p.from,m=(0,a.hexToNumber)(i),f=(0,r.getDeleGatorEnvironment)(m),g=f.DelegationManager,y=function(e,t){const n=e.call("AppStateController:getState"),s=n.enforcedSimulationsSlippage;return n.enforcedSimulationsSlippageForTransactions[t]??s}(e,t.id),v=function({accountAddress:e,environment:t,simulationData:n,slippage:a}){const i=function(e,t,n,a){const i=(0,r.createCaveatBuilder)(t),{nativeBalanceChange:o,tokenBalanceChanges:l=[]}=n;if(o){const{difference:t,isDecrease:n}=o,s=u(t,a,n);c("Caveat - Native Balance Change",{enforceDecrease:n,recipient:e,delta:BigInt(t),slippage:a,deltaWithSlippage:s}),i.addCaveat("nativeBalanceChange",n,e,s)}for(const t of l){const{difference:n,isDecrease:r,address:o,standard:l,id:d}=t,p=BigInt(n),h=u(n,a,r),m=d?BigInt(d):0n;switch(c("Caveat - Token Balance Change",{enforceDecrease:r,token:o,recipient:e,delta:p,slippage:a,deltaWithSlippage:h}),l){case s.SimulationTokenStandard.erc20:i.addCaveat("erc20BalanceChange",r,o,e,h);break;case s.SimulationTokenStandard.erc721:i.addCaveat("erc721BalanceChange",r,o,e,p);break;case s.SimulationTokenStandard.erc1155:i.addCaveat("erc1155BalanceChange",r,o,e,m,p);break;default:c("Unsupported token standard",l)}}return i.build()}(e,t,n,a);c("Caveats",i);const o=(0,r.createDelegation)({from:e,to:e,caveats:i});return o}({accountAddress:h,environment:f,simulationData:d,slippage:y});c("Delegation",v);let b=l;n&&(c("Signing delegation"),b=await e.call("DelegationController:signDelegation",{chainId:i,delegation:v}));c("Delegation signature",b);const S=function({transaction:e,delegation:t}){const n=[[t]],s=[r.SINGLE_DEFAULT_MODE],a=[[{target:e.to,callData:e.data??"0x",value:e.value?BigInt(e.value):0n}]];return(0,o.encodeRedeemDelegations)({delegations:n,modes:s,executions:a})}({transaction:p,delegation:{...v,signature:b}});return c("Data",S),{updateTransaction:e=>{e.txParams.data=S,e.txParams.to=g,e.txParams.value="0x0"}}};var s=e("@metamask/transaction-controller"),a=e("@metamask/utils"),i=e("bignumber.js"),r=e("../../../../../shared/lib/delegation"),o=e("../../../../../shared/lib/delegation/delegation");const c=(0,a.createProjectLogger)("enforced-simulations"),l="0x2261a7810ed3e9cde160895909e138e2f68adb2da86fcf98ea0840701df107721fb369ab9b52550ea98832c09f8185284aca4c94bd345e867a4f4461868dd7751b";function u(e,t,n){const s=new i.BigNumber(e),a=(100+(n?t:-t))/100;return BigInt(s.mul(a).toFixed(0))}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/enforced-simulations.ts"}],[273,{"./enforced-simulations":272,"@metamask/transaction-controller":2754,"@metamask/utils":2799,lodash:4534},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.applyTransactionContainers=c,n.applyTransactionContainersExisting=async function({containerTypes:e,transactionId:t,messenger:n,updateEditableParams:s}){const i=(await n.call("TransactionController:getState")).transactions.find(e=>e.id===t);if(!i)throw new Error(`Transaction with ID ${t} not found.`);const{updateTransaction:r}=await c({isApproved:!1,messenger:n,transactionMeta:i,types:e}),o=(0,a.cloneDeep)(i);r(o),s(t,{containerTypes:e,data:o.txParams.data,gas:o.txParams.gas,to:o.txParams.to,value:o.txParams.value})};var s=e("@metamask/transaction-controller"),a=e("lodash"),i=e("@metamask/utils"),r=e("./enforced-simulations");const o=(0,i.createProjectLogger)("transaction-containers");async function c({isApproved:e,messenger:t,transactionMeta:n,types:i}){const{txParamsOriginal:c}=n,l=(0,a.cloneDeep)(n);if(c&&(l.txParams=(0,a.cloneDeep)(c)),i.includes(s.TransactionContainerType.EnforcedSimulations)){const{updateTransaction:n}=await(0,r.enforceSimulations)({messenger:t,transactionMeta:l,useRealSignature:e});n(l)}let u;if(!e){const{gas:e}=await t.call("TransactionController:estimateGas",l.txParams,l.networkClientId,{ignoreDelegationSignatures:!0});o("Estimated gas",e),u=e}return{updateTransaction:e=>{e.containerTypes=i,e.txParams=(0,a.cloneDeep)(l.txParams),u&&(e.txParams.gas=u)}}}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/util.ts"}],[274,{"../../../../../shared/lib/four-byte":5499,"@ethersproject/abi":631,"@metamask/utils":2799,"ethereumjs-util":4019},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionDataWithFourByte=async function(e){const t=e.slice(0,10),n=await(0,r.getMethodFrom4Byte)(t);if(!n)return undefined;const i=n.split("(")[0],d=function(e){let t=e.slice(e.indexOf("(")+1,-1);const n=[];for(;t.includes("(");){const e=u(t);if(!e)break;n.push(e.value),t=`${t.slice(0,e.start)}${n.length-1}#${t.slice(e.end+1)}`}return l(t,n)}(n);o("Generated inputs",d);const p=(0,s.addHexPrefix)(e.slice(10)),h=a.Interface.getAbiCoder().decode(d,p),m=d.map((e,t)=>c(e,t,h));return{name:i,params:m}};var s=e("ethereumjs-util"),a=e("@ethersproject/abi"),i=e("@metamask/utils"),r=e("../../../../../shared/lib/four-byte");const o=(0,i.createProjectLogger)("four-byte");function c(e,t,n){var s;const a=n[t],{type:i,name:r}=e;let o=null===(s=e.components)||void 0===s?void 0:s.map((e,t)=>c(e,t,a));if(i.endsWith("[]")){const t=i.slice(0,-2);o=a.map((n,s)=>{const i=`Item ${s+1}`;return c({...e,name:i,type:t},s,a)})}return{name:r,type:i,value:a,children:o}}function l(e,t){return e.split(",").map(e=>{const n=e.split("#"),s=n.length>1?parseInt(n[0],10):undefined;return{type:s===undefined?e:`tuple${n[1]??""}`,components:s===undefined?undefined:l(t[s],t)}})}function u(e){let t=-1;for(let n=0;n<e.length;n++)if("("===e[n])t=n;else if(")"===e[n]&&-1!==t)return{start:t,end:n,value:e.slice(t+1,n)};return undefined}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/four-byte.ts"}],[275,{"ethereumjs-util":4019},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getContractProxyAddress=async function(e,t){const n=(await Promise.all(a.map(n=>t.request({method:"eth_getStorageAt",params:[e,n,"latest"]})))).find(e=>(0,s.stripHexPrefix)(e)!==i);return n&&(0,s.addHexPrefix)(n.slice(26))};var s=e("ethereumjs-util");const a=["0x7050c9e0f4ca769c69bd3a8ef740bc37934f8e2c036e5a723fd8ee048ed3f8c3","0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc"],i="0".padEnd(64,"0")}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/proxy.ts"}],[276,{"@ethersproject/abi":631,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionDataWithSourcify=async function(e,t,n){var o,c;const l=await async function(e,t){var n;const s=await async function(e,t){const n=parseInt(t,16),s=await fetch(`https://sourcify.dev/server/files/any/${n}/${e}`);if(!s.ok)throw new Error("Failed to fetch Sourcify files");return s.json()}(e,t),a=null===(n=s.files)||void 0===n?void 0:n.find(e=>e.name.includes("metadata.json"));if(!a)throw new Error("Metadata not found");return JSON.parse(a.content)}(t,n);a("Retrieved Sourcify metadata",{contractAddress:t,chainId:n,metadata:l});const{abi:u}=l.output,d=new s.Interface(u),p=e.slice(0,10);let h;try{h=d.getFunction(p)}catch(e){}if(!h)return a("Failed to find function in ABI",p,u),undefined;const{name:m,inputs:f}=h,g=r(m,f),y=null===(o=l.output.userdoc)||void 0===o?void 0:o.methods[g],v=null===(c=l.output.devdoc)||void 0===c?void 0:c.methods[g],b=(null==y?void 0:y.notice)??(null==v?void 0:v.details);a("Extracted NatSpec",{signature:g,userDoc:y,devDoc:v});const S=d.decodeFunctionData(p,e),w=f.map((e,t)=>i(e,t,S,y,v));return{name:m,description:b,params:w}};var s=e("@ethersproject/abi");const a=(0,e("@metamask/utils").createProjectLogger)("sourcify");function i(e,t,n,s,a){var r,o;const{name:c,type:l,components:u}=e,d=(null==s||null===(r=s.params)||void 0===r?void 0:r[c])??(null==a||null===(o=a.params)||void 0===o?void 0:o[c]),p=n[t];let h=null==u?void 0:u.map((e,t)=>i(e,t,p,{},{}));if(l.endsWith("[]")){const t=l.slice(0,-2);h=p.map((n,s)=>{const a=`Item ${s+1}`;return i({...e,name:a,type:t},s,p,{},{})})}return{name:c,description:d,type:l,value:p,children:h}}function r(e,t){return`${e??""}(${t.map(e=>{var t;return null!==(t=e.components)&&void 0!==t&&t.length?`${r(undefined,e.components)}${e.type.endsWith("[]")?"[]":""}`:e.type}).join(",")})`}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/sourcify.ts"}],[277,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNISWAP_ROUTER_COMMANDS=void 0;n.UNISWAP_ROUTER_COMMANDS={0:{name:"V3_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},1:{name:"V3_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},2:{name:"PERMIT2_TRANSFER_FROM",params:[{type:"address",description:"The token to fetch from Permit2",name:"token"},{type:"address",description:"The recipient of the tokens fetched",name:"recipient"},{type:"uint256",description:"The amount of token to fetch",name:"amount"}]},3:{name:"PERMIT2_PERMIT_BATCH",params:[{type:"bytes",description:"A PermitBatch struct outlining all of the Permit2 permits to execute.",name:"batch"},{type:"bytes",description:"The signature to provide to Permit2",name:"data"}]},4:{name:"SWEEP",params:[{type:"address",description:"The ERC20 token to sweep (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amountMin"}]},5:{name:"TRANSFER",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The amount to transfer",name:"value"}]},6:{name:"PAY_PORTION",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"In basis points, the percentage of the contract’s balance to transfer",name:"bips"}]},8:{name:"V2_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},9:{name:"V2_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},10:{name:"PERMIT2_PERMIT",params:[{type:"bytes",description:"A PermitSingle struct outlining the Permit2 permit to execute",name:"permitSingle"},{type:"bytes",description:"The signature to provide to Permit2",name:"signature"}]},11:{name:"WRAP_ETH",params:[{type:"address",description:"The recipient of the WETH",name:"recipient"},{type:"uint256",description:"The amount of ETH to wrap",name:"amountMin"}]},12:{name:"UNWRAP_WETH",params:[{type:"address",description:"The recipient of the ETH",name:"recipient"},{type:"uint256",description:"The minimum required ETH to receive from the unwrapping",name:"amountMin"}]},13:{name:"PERMIT2_TRANSFER_FROM_BATCH",params:[{type:"bytes",description:"An array of AllowanceTransferDetails structs that each describe a Permit2 transfer to perform",name:"batchDetails"}]},16:{name:"SEAPORT",params:[{type:"uint256",description:"The ETH value to forward to the Seaport contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Seaport contract",name:"data"}]},17:{name:"LOOKS_RARE_721",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},18:{name:"NFTX",params:[{type:"uint256",description:"The ETH value to forward to the NFTX contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFTX contract",name:"data"}]},19:{name:"CRYPTOPUNKS",params:[{type:"uint256",description:"The PunkID to purchase",name:"punkId"},{type:"address",description:"The recipient for the cryptopunk",name:"recipient"},{type:"uint256",description:"The ETH value to forward to the Cryptopunks contract",name:"value"}]},20:{name:"LOOKS_RARE_1155",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},21:{name:"OWNER_CHECK_721",params:[{type:"address",description:"The required owner of the ERC721",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},22:{name:"OWNER_CHECK_1155",params:[{type:"address",description:"The required owner of the ERC1155",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The minimum required amount of the ERC1155",name:"minBalance"}]},23:{name:"SWEEP_ERC721",params:[{type:"address",description:"The ERC721 token address to transfer",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The token ID to transfer",name:"id"}]},24:{name:"X2Y2_721",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},25:{name:"SUDOSWAP",params:[{type:"uint256",description:"The ETH value to forward to the Sudoswap contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Sudoswap contract",name:"data"}]},26:{name:"NFT20",params:[{type:"uint256",description:"The ETH value to forward to the NFT20 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFT20 contract",name:"data"}]},27:{name:"X2Y2_1155",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},28:{name:"FOUNDATION",params:[{type:"uint256",description:"The ETH value to forward to the Foundation contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Foundation contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},29:{name:"SWEEP_ERC1155",params:[{type:"address",description:"The ERC1155 token address to sweep",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The token ID to sweep",name:"id"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amount"}]}}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap-commands.ts"}],[2776,{"./constants.cjs":2777,"./helpers/Bundler.cjs":2778,"./helpers/PendingUserOperationTracker.cjs":2779,"./helpers/SnapSmartContractAccount.cjs":2780,"./logger.cjs":2782,"./types.cjs":2783,"./utils/gas-fees.cjs":2785,"./utils/gas.cjs":2786,"./utils/transaction.cjs":2787,"./utils/validation.cjs":2788,"@metamask/base-controller":1222,"@metamask/controller-utils":1301,"@metamask/eth-query":1831,"@metamask/rpc-errors":2384,"@metamask/transaction-controller":2754,"@metamask/utils":2799,events:4072,lodash:4534,uuid:5366},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,i,r,o,c,l,u,d,p,h,m,f,g,y,v,b,S,w,T,_,k,E,P,A=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},C=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},M=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.UserOperationController=void 0;const O=e("@metamask/base-controller"),I=e("@metamask/controller-utils"),j=M(e("@metamask/eth-query")),R=e("@metamask/rpc-errors"),x=e("@metamask/transaction-controller"),N=e("@metamask/utils"),D=M(e("events")),L=e("lodash"),F=e("uuid"),U=e("./constants.cjs"),$=e("./helpers/Bundler.cjs"),B=e("./helpers/PendingUserOperationTracker.cjs"),H=e("./helpers/SnapSmartContractAccount.cjs"),G=e("./logger.cjs"),q=e("./types.cjs"),V=e("./utils/gas.cjs"),W=e("./utils/gas-fees.cjs"),Y=e("./utils/transaction.cjs"),K=e("./utils/validation.cjs"),z={userOperations:{persist:!0,anonymous:!1}};class J extends O.BaseController{constructor({entrypoint:e,getGasFeeEstimates:t,messenger:n,state:o}){super({name:"UserOperationController",metadata:z,messenger:n,state:{userOperations:{},...o}}),s.add(this),a.set(this,void 0),i.set(this,void 0),r.set(this,void 0),this.hub=new D.default,A(this,a,e,"f"),A(this,i,t,"f"),A(this,r,new B.PendingUserOperationTracker({getUserOperations:()=>(0,L.cloneDeep)(Object.values(this.state.userOperations)),messenger:n}),"f"),C(this,s,"m",w).call(this)}async addUserOperation(e,t){return(0,K.validateAddUserOperationRequest)(e),(0,K.validateAddUserOperationOptions)(t),await C(this,s,"m",o).call(this,e,t)}async addUserOperationFromTransaction(e,t){(0,K.validateAddUserOperationOptions)(t);const{data:n,from:a,maxFeePerGas:i,maxPriorityFeePerGas:r,to:c,value:l}=e,u={data:""===n?undefined:n,from:a,maxFeePerGas:i,maxPriorityFeePerGas:r,to:c,value:l};return(0,K.validateAddUserOperationRequest)(u),await C(this,s,"m",o).call(this,u,{...t,transaction:e})}startPollingByNetworkClientId(e){return C(this,r,"f").startPolling({networkClientId:e})}}n.UserOperationController=J,a=new WeakMap,i=new WeakMap,r=new WeakMap,s=new WeakSet,o=async function(e,t){(0,G.projectLogger)("Adding user operation",{request:e,options:t});const{networkClientId:n,origin:a,smartContractAccount:i,swaps:r,transaction:o}=t,{chainId:d,provider:p}=await C(this,s,"m",k).call(this,n),h=await C(this,s,"m",u).call(this,d,a,o,r),m=i??new H.SnapSmartContractAccount(this.messagingSystem),f={chainId:d,metadata:h,options:{...t,smartContractAccount:m},provider:p,request:e,transaction:o},{id:y}=h;let v=!1;const b=(async()=>{try{return await C(this,s,"m",c).call(this,f)}catch(e){if(C(this,s,"m",g).call(this,h,e),v)throw e;return undefined}})(),S=async()=>(v=!0,await b);return{id:y,hash:S,transactionHash:async()=>{await S();const{transactionHash:e}=await C(this,s,"m",l).call(this,h);return e}}},c=async function(e){const{metadata:t,options:n}=e,{requireApproval:a,smartContractAccount:i}=n;let r;try{return await C(this,s,"m",d).call(this,e),await C(this,s,"m",p).call(this,t,i),this.hub.emit("user-operation-added",t),!1!==a&&(r=await C(this,s,"m",h).call(this,e)),await C(this,s,"m",m).call(this,t,i),await C(this,s,"m",f).call(this,t),r?.success(),t.hash}catch(e){throw r?.error(e),e}},l=async function(e){const{id:t,hash:n}=e;return(0,G.projectLogger)("Waiting for confirmation",t,n),new Promise((e,n)=>{this.hub.once(`${t}:confirmed`,t=>{e(t)}),this.hub.once(`${t}:failed`,(e,t)=>{n(t)})})},u=async function(e,t,n,a){const i={actualGasCost:null,actualGasUsed:null,baseFeePerGas:null,bundlerUrl:null,chainId:e,error:null,hash:null,id:(0,F.v1)(),origin:t,status:q.UserOperationStatus.Unapproved,swapsMetadata:a?{approvalTxId:a.approvalTxId??null,destinationTokenAddress:a.destinationTokenAddress??null,destinationTokenAmount:a.destinationTokenAmount??null,destinationTokenDecimals:a.destinationTokenDecimals??null,destinationTokenSymbol:a.destinationTokenSymbol??null,estimatedBaseFee:a.estimatedBaseFee??null,sourceTokenAddress:a.sourceTokenAddress??null,sourceTokenAmount:a.sourceTokenAmount??null,sourceTokenDecimals:a.sourceTokenDecimals??null,sourceTokenSymbol:a.sourceTokenSymbol??null,swapAndSendRecipient:a.swapAndSendRecipient??null,swapMetaData:a.swapMetaData??null,swapTokenValue:a.swapTokenValue??null}:null,time:Date.now(),transactionHash:null,transactionParams:n??null,transactionType:null,userFeeLevel:null,userOperation:C(this,s,"m",y).call(this,n)};return C(this,s,"m",v).call(this,i),(0,G.projectLogger)("Added user operation",i.id),i},d=async function(e){const{chainId:t,metadata:n,options:r,provider:o,request:c,transaction:l}=e,{data:u,from:d,to:p,value:h}=c,{id:m,transactionParams:f,userOperation:g}=n,{smartContractAccount:y}=r;(0,G.projectLogger)("Preparing user operation",{id:m});const b=await C(this,s,"m",_).call(this,l,o,r);n.transactionType=b??null,(0,G.projectLogger)("Determined transaction type",b),await(0,W.updateGasFees)({getGasFeeEstimates:C(this,i,"f"),metadata:n,originalRequest:c,provider:o,transaction:f??undefined});const S=await y.prepareUserOperation({chainId:t,data:u,from:d,to:p,value:h});(0,K.validatePrepareUserOperationResponse)(S);const{bundler:w,callData:T,dummyPaymasterAndData:k,dummySignature:E,initCode:P,nonce:A,sender:M}=S;g.callData=T,g.initCode=P??U.EMPTY_BYTES,g.nonce=A,g.paymasterAndData=k??U.EMPTY_BYTES,g.sender=M,g.signature=E??U.EMPTY_BYTES,n.bundlerUrl=w,await(0,V.updateGas)(n,S,C(this,a,"f")),C(this,s,"m",v).call(this,n)},p=async function(e,t){const{id:n,userOperation:a,chainId:i}=e;(0,G.projectLogger)("Requesting paymaster data",{id:n});const r=await t.updateUserOperation({userOperation:a,chainId:i});(0,K.validateUpdateUserOperationResponse)(r),a.paymasterAndData=r.paymasterAndData??U.EMPTY_BYTES,r.callGasLimit&&(a.callGasLimit=r.callGasLimit),r.preVerificationGas&&(a.preVerificationGas=r.preVerificationGas),r.verificationGasLimit&&(a.verificationGasLimit=r.verificationGasLimit),C(this,s,"m",v).call(this,e)},h=async function(e){(0,G.projectLogger)("Requesting approval");const{metadata:t}=e,{resultCallbacks:n,value:a}=await C(this,s,"m",T).call(this,t),i=a?.txMeta;return i&&await C(this,s,"m",E).call(this,e,i),t.status=q.UserOperationStatus.Approved,C(this,s,"m",v).call(this,t),n},m=async function(e,t){const{id:n,chainId:a,userOperation:i}=e;(0,G.projectLogger)("Signing user operation",n,i);const r=await t.signUserOperation({userOperation:i,chainId:a});(0,K.validateSignUserOperationResponse)(r);const{signature:o}=r;i.signature=o,(0,G.projectLogger)("Signed user operation",o),e.status=q.UserOperationStatus.Signed,C(this,s,"m",v).call(this,e)},f=async function(e){const{userOperation:t}=e;(0,G.projectLogger)("Submitting user operation",t);const n=new $.Bundler(e.bundlerUrl),i=await n.sendUserOperation(t,C(this,a,"f"));e.hash=i,e.status=q.UserOperationStatus.Submitted,C(this,s,"m",v).call(this,e)},g=function(e,t){const{id:n}=e,a=t;(0,G.projectLogger)("User operation failed",n,t),e.error={name:a.name,message:a.message,stack:a.stack,code:a.code,rpc:a.value},e.status=q.UserOperationStatus.Failed,C(this,s,"m",v).call(this,e),String(a.code)===String(R.errorCodes.provider.userRejectedRequest)&&C(this,s,"m",b).call(this,n)},y=function(e){return{callData:U.EMPTY_BYTES,callGasLimit:U.EMPTY_BYTES,initCode:U.EMPTY_BYTES,maxFeePerGas:e?.maxFeePerGas??U.EMPTY_BYTES,maxPriorityFeePerGas:e?.maxPriorityFeePerGas??U.EMPTY_BYTES,nonce:U.EMPTY_BYTES,paymasterAndData:U.EMPTY_BYTES,preVerificationGas:U.EMPTY_BYTES,sender:U.ADDRESS_ZERO,signature:U.EMPTY_BYTES,verificationGasLimit:U.EMPTY_BYTES}},v=function(e){const{id:t}=e;this.update(n=>{n.userOperations[t]=(0,L.cloneDeep)(e)}),C(this,s,"m",S).call(this,e)},b=function(e){this.update(t=>{delete t.userOperations[e]})},S=function(e){if(!e.transactionParams)return;const t=(0,Y.getTransactionMetadata)(e);this.hub.emit("transaction-updated",t)},w=function(){C(this,r,"f").hub.on("user-operation-confirmed",e=>{(0,G.projectLogger)("In listener..."),this.hub.emit("user-operation-confirmed",e),this.hub.emit(`${e.id}:confirmed`,e)}),C(this,r,"f").hub.on("user-operation-failed",(e,t)=>{this.hub.emit("user-operation-failed",e,t),this.hub.emit(`${e.id}:failed`,e,t)}),C(this,r,"f").hub.on("user-operation-updated",e=>{C(this,s,"m",v).call(this,e)})},T=async function(e){const{id:t,origin:n}=e,s=I.ApprovalType.Transaction,a={txId:t};return await this.messagingSystem.call("ApprovalController:addRequest",{id:t,origin:n,type:s,requestData:a,expectsResult:!0},!0)},_=async function(e,t,n){if(!e)return undefined;if(n.type)return n.type;const s=new j.default(t),a=(0,x.determineTransactionType)(e,s);return(await a).type},k=async function(e){const{provider:t,configuration:n}=this.messagingSystem.call("NetworkController:getNetworkClientById",e),{chainId:s}=n;return{provider:t,chainId:s}},E=async function(e,t){(0,G.projectLogger)("Found updated transaction in approval",{updatedTransaction:t});const{metadata:n,request:a}=e,{userOperation:i}=n,r=i.paymasterAndData!==U.EMPTY_BYTES,o=(0,N.add0x)(t.txParams.maxFeePerGas),c=(0,N.add0x)(t.txParams.maxPriorityFeePerGas);let l=!1;const u=i.maxFeePerGas,d=i.maxPriorityFeePerGas,p=u!==o||d!==c,h=r&&o===U.VALUE_ZERO&&c===U.VALUE_ZERO;p&&!h&&((0,G.projectLogger)("Gas fees updated during approval",{previousMaxFeePerGas:u,previousMaxPriorityFeePerGas:d,updatedMaxFeePerGas:o,updatedMaxPriorityFeePerGas:c}),i.maxFeePerGas=o,i.maxPriorityFeePerGas=c,l=r);const m=a.data??U.EMPTY_BYTES,f=t.txParams.data??U.EMPTY_BYTES;m!==f&&((0,G.projectLogger)("Data updated during approval",{previousData:m,updatedData:f}),l=!0);const g=a.value??U.VALUE_ZERO,y=t.txParams.value??U.VALUE_ZERO;if(g!==y&&((0,G.projectLogger)("Value updated during approval",{previousValue:g,updatedValue:y}),l=!0),l){const t={...a,data:f,maxFeePerGas:o,maxPriorityFeePerGas:c,value:y};await C(this,s,"m",P).call(this,{...e,request:t})}},P=async function(e){(0,G.projectLogger)("Regenerating user operation as parameters were updated during approval");const{options:{smartContractAccount:t},metadata:n}=e;await C(this,s,"m",d).call(this,e),await C(this,s,"m",p).call(this,n,t),(0,G.projectLogger)("Regenerated user operation",n.userOperation)}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/UserOperationController.cjs"}],[2777,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.VALUE_ZERO=n.ADDRESS_ZERO=n.EMPTY_BYTES=void 0,n.EMPTY_BYTES="0x",n.ADDRESS_ZERO="0x0000000000000000000000000000000000000000",n.VALUE_ZERO="0x0"}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/constants.cjs"}],[2778,{"../logger.cjs":2782},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,i,r=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.Bundler=void 0;const c=e("../logger.cjs"),l=(0,c.createModuleLogger)(c.projectLogger,"bundler");n.Bundler=class{constructor(e){s.add(this),a.set(this,void 0),r(this,a,e,"f")}async estimateUserOperationGas(e,t){l("Estimating gas",{url:o(this,a,"f"),userOperation:e,entrypoint:t});const n=await o(this,s,"m",i).call(this,"eth_estimateUserOperationGas",[e,t]);return l("Estimated gas",{response:n}),n}async getUserOperationReceipt(e){return l("Getting user operation receipt",{url:o(this,a,"f"),hash:e}),await o(this,s,"m",i).call(this,"eth_getUserOperationReceipt",[e])}async sendUserOperation(e,t){l("Sending user operation",{url:o(this,a,"f"),userOperation:e,entrypoint:t});const n=await o(this,s,"m",i).call(this,"eth_sendUserOperation",[e,t]);return l("Sent user operation",n),n}},a=new WeakMap,s=new WeakSet,i=async function(e,t){const n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:e,params:t})},s=await fetch(o(this,a,"f"),n),i=await s.json();if(i.error){const e=new Error(i.error.message||i.error);throw e.code=i.error.code,e}return i.result}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/Bundler.cjs"}],[2779,{"../logger.cjs":2782,"../types.cjs":2783,"./Bundler.cjs":2778,"@metamask/controller-utils":1301,"@metamask/eth-query":1831,"@metamask/polling-controller":2280,"@metamask/utils":2799,events:4072},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a,i,r,o,c,l,u,d,p,h,m=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},f=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PendingUserOperationTracker=void 0;const y=e("@metamask/controller-utils"),v=g(e("@metamask/eth-query")),b=e("@metamask/polling-controller"),S=e("@metamask/utils"),w=g(e("events")),T=e("../logger.cjs"),_=e("../types.cjs"),k=e("./Bundler.cjs"),E=(0,S.createModuleLogger)(T.projectLogger,"pending-user-operations");class P extends((0,b.BlockTrackerPollingControllerOnly)()){constructor({getUserOperations:e,messenger:t}){super(),s.add(this),a.set(this,void 0),i.set(this,void 0),this.hub=new w.default,m(this,a,e,"f"),m(this,i,t,"f")}async _executePoll({networkClientId:e}){try{const{blockTracker:t,configuration:n,provider:a}=this._getNetworkClientById(e);E("Polling",{blockNumber:t.getCurrentBlock(),chainId:n.chainId}),await f(this,s,"m",r).call(this,n.chainId,a)}catch(e){E("Failed to check user operations",e)}}_getNetworkClientById(e){return f(this,i,"f").call("NetworkController:getNetworkClientById",e)}}n.PendingUserOperationTracker=P,a=new WeakMap,i=new WeakMap,s=new WeakSet,r=async function(e,t){const n=f(this,s,"m",u).call(this).filter(t=>t.chainId===e);n.length?(E("Found pending user operations to check",{count:n.length,ids:n.map(e=>e.id)}),await Promise.all(n.map(e=>f(this,s,"m",o).call(this,e,t)))):E("No pending user operations to check")},o=async function(e,t){const{bundlerUrl:n,hash:a,id:i}=e;if(a&&n)try{const r=await f(this,s,"m",p).call(this,a,n),o=r?.success;if(r&&!o)return void f(this,s,"m",l).call(this,e,r);if(o)return void await f(this,s,"m",c).call(this,e,r,t);E("No receipt found for user operation",{id:i,hash:a})}catch(e){E("Failed to check user operation",i,e)}else E("Skipping user operation as missing hash or bundler",i)},c=async function(e,t,n){const{id:a}=e,{actualGasCost:i,actualGasUsed:r,receipt:{blockHash:o,transactionHash:c}}=t;E("User operation confirmed",a,c);const{baseFeePerGas:l}=await(0,y.query)(new v.default(n),"getBlockByHash",[o,!1]);e.actualGasCost=f(this,s,"m",h).call(this,i),e.actualGasUsed=f(this,s,"m",h).call(this,r),e.baseFeePerGas=l,e.status=_.UserOperationStatus.Confirmed,e.transactionHash=c,f(this,s,"m",d).call(this,e),this.hub.emit("user-operation-confirmed",e)},l=function(e,t){const{id:n}=e;E("User operation failed",n),e.status=_.UserOperationStatus.Failed,f(this,s,"m",d).call(this,e),this.hub.emit("user-operation-failed",e,new Error("User operation receipt has failed status"))},u=function(){return f(this,a,"f").call(this).filter(e=>e.status===_.UserOperationStatus.Submitted)},d=function(e){this.hub.emit("user-operation-updated",e)},p=async function(e,t){return new k.Bundler(t).getUserOperationReceipt(e)},h=function(e){return"number"==typeof e?(0,y.toHex)(e):e}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/PendingUserOperationTracker.cjs"}],[278,{"../../../../../shared/constants/network":5433,"./uniswap-commands":277,"@ethersproject/abi":631,"ethereumjs-util":4019},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES=void 0,n.decodeUniswapRouterTransactionData=function({transactionData:e,contractAddress:t,chainId:n}){const i=l[n];if(null==i||!i.map(e=>e.toLowerCase()).includes(t.toLowerCase()))return undefined;const d=new s.Interface(u);let p;try{p=d.parseTransaction({data:e})}catch(e){return undefined}const h=p.args.commands,m=p.args.inputs;return h.slice(2).match(/.{1,2}/gu).map((e,t)=>function(e,t){const n=parseInt(e,16),i=31&n,l=r.UNISWAP_ROUTER_COMMANDS[String(i)];if(!l)return undefined;const u=l.params.map(e=>e.type),d=s.Interface.getAbiCoder().decode(u,t),{name:p}=l,h=l.params.map((e,t)=>{const{name:n,type:s,description:i}=e,r=d[t];return{name:n,type:s,value:"path"===n?function(e){const t=[];let n=(0,a.stripHexPrefix)(e),s={},i=!0;for(;n.length;){if(i){const e=(0,a.addHexPrefix)(n.slice(0,o));s.firstAddress?(s.secondAddress=e,t.push(s),s={firstAddress:e}):s.firstAddress=e,n=n.slice(o)}else s.tickSpacing=parseInt(n.slice(0,c),16),n=n.slice(c);i=!i}return t}(r):r,description:i}});return{name:p,params:h}}(e,m[t])).filter(e=>e!==undefined)};var s=e("@ethersproject/abi"),a=e("ethereumjs-util"),i=e("../../../../../shared/constants/network"),r=e("./uniswap-commands");const o=40,c=6,l=n.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES={[i.CHAIN_IDS.ARBITRUM]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x5E325eDA8064b456f4781070C0738d849c824258"],[i.CHAIN_IDS.AVALANCHE]:["0x82635AF6146972cD6601161c4472ffe97237D292","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[i.CHAIN_IDS.BASE]:["0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[i.CHAIN_IDS.BSC]:["0x5Dc88340E1c5c6366864Ee415d6034cadd1A9897","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[i.CHAIN_IDS.MAINNET]:["0xEf1c6E67703c7BD7107eed8303Fbe6EC2554BF6B","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[i.CHAIN_IDS.OPTIMISM]:["0xb555edF5dcF85f42cEeF1f3630a52A108E55A654","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8"],[i.CHAIN_IDS.POLYGON]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0x643770E279d5D0733F21d6DC03A8efbABf3255B4","0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2"],[i.CHAIN_IDS.SEPOLIA]:["0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"]},u=[{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"},{name:"deadline",type:"uint256"}],name:"execute",type:"function"},{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"}],name:"execute",type:"function"}]}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap.ts"}],[2780,{"../constants.cjs":2777,"../utils/chain-id.cjs":2784},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,a=this&&this.__classPrivateFieldSet||function(e,t,n,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,n):a?a.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapSmartContractAccount=void 0;const r=e("../constants.cjs"),o=e("../utils/chain-id.cjs");n.SnapSmartContractAccount=class{constructor(e){s.set(this,void 0),a(this,s,e,"f")}async prepareUserOperation(e){const{chainId:t,data:n,from:a,to:c,value:l}=e,u=n??r.EMPTY_BYTES,d=c??r.ADDRESS_ZERO,p=l??r.VALUE_ZERO,h=await i(this,s,"f").call("KeyringController:prepareUserOperation",a,[{data:u,to:d,value:p}],{chainId:(0,o.toEip155ChainId)(t)}),{bundlerUrl:m,callData:f,dummyPaymasterAndData:g,dummySignature:y,gasLimits:v,initCode:b,nonce:S}=h;return{bundler:m,callData:f,dummyPaymasterAndData:g,dummySignature:y,gas:v,initCode:b,nonce:S,sender:a}}async updateUserOperation(e){const{userOperation:t,chainId:n}=e,{sender:a}=t,{paymasterAndData:c,verificationGasLimit:l,preVerificationGas:u,callGasLimit:d}=await i(this,s,"f").call("KeyringController:patchUserOperation",a,t,{chainId:(0,o.toEip155ChainId)(n)});return{paymasterAndData:c===r.EMPTY_BYTES?undefined:c,verificationGasLimit:l,preVerificationGas:u,callGasLimit:d}}async signUserOperation(e){const{userOperation:t,chainId:n}=e,{sender:a}=t;return{signature:await i(this,s,"f").call("KeyringController:signUserOperation",a,t,{chainId:(0,o.toEip155ChainId)(n)})}}},s=new WeakMap}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/SnapSmartContractAccount.cjs"}],[2781,{"./UserOperationController.cjs":2776,"./types.cjs":2783},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./UserOperationController.cjs"),n),a(e("./types.cjs"),n)}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/index.cjs"}],[2782,{"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const s=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return s.createModuleLogger}}),n.projectLogger=(0,s.createProjectLogger)("user-operation-controller")}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/logger.cjs"}],[2783,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.UserOperationStatus=void 0,function(e){e.Unapproved="unapproved",e.Approved="approved",e.Signed="signed",e.Submitted="submitted",e.Failed="failed",e.Confirmed="confirmed"}(s||(n.UserOperationStatus=s={}))}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/types.cjs"}],[2784,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toEip155ChainId=void 0,n.toEip155ChainId=function(e){const t=Number(e);return Number.isInteger(t)?t.toString():e}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/chain-id.cjs"}],[2785,{"../constants.cjs":2777,"../logger.cjs":2782,"@metamask/controller-utils":1301,"@metamask/eth-query":1831,"@metamask/gas-fee-controller":1919,"@metamask/transaction-controller":2754,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateGasFees=void 0;const a=e("@metamask/controller-utils"),i=s(e("@metamask/eth-query")),r=e("@metamask/gas-fee-controller"),o=e("@metamask/transaction-controller"),c=e("@metamask/utils"),l=e("../constants.cjs"),u=e("../logger.cjs"),d=(0,u.createModuleLogger)(u.projectLogger,"gas-fees");function p(e){return(0,a.toHex)((0,a.gweiDecToWEIBN)(e))}function h(e){return!e||e===l.EMPTY_BYTES}n.updateGasFees=async function(e){const{metadata:t,originalRequest:n,transaction:s}=e,{userOperation:l}=t;let u;const m=async()=>(u||(u=await async function(e){const{getGasFeeEstimates:t,provider:n}=e;try{const{gasFeeEstimates:e,gasEstimateType:n}=await t();if(n===r.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:n}={}}=e;if(t&&n){const e={maxFeePerGas:p(n),maxPriorityFeePerGas:p(t)};return d("Using medium values from fee market estimate",e),e}}if(n===r.GAS_ESTIMATE_TYPES.LEGACY){const t=p(e.medium);return d("Using medium value from legacy estimate",t),{maxFeePerGas:t}}if(n===r.GAS_ESTIMATE_TYPES.ETH_GASPRICE){const t=p(e.gasPrice);return d("Using gasPrice from estimate",t),{maxFeePerGas:t}}}catch(e){d("Failed to get estimate",e)}const s=await(0,a.query)(new i.default(n),"gasPrice");if(!s)return{};const o=(0,c.add0x)(s.toString(16));return d("Using gasPrice from network as fallback",o),{maxFeePerGas:o}}(e)),u);l.maxFeePerGas=await async function(e,t,n){const{maxFeePerGas:s,maxPriorityFeePerGas:a}=e,{gasPrice:i}=n??{};if(!h(s))return d("Using maxFeePerGas from request",s),s;if(h(a)&&i)return d("Setting maxFeePerGas to transaction gasPrice",i),i;const{maxFeePerGas:r}=await t();if(!r)throw new Error("Failed to get gas fee estimate for maxFeePerGas");return d("Using maxFeePerGas from estimate",r),r}(n,m,s),l.maxPriorityFeePerGas=await async function(e,t,n,s){const{maxFeePerGas:a,maxPriorityFeePerGas:i}=e,{gasPrice:r}=s??{},{maxFeePerGas:o}=n;if(!h(i))return d("Using maxPriorityFeePerGas from request",i),i;if(h(a)&&r)return d("Setting maxPriorityFeePerGas to transaction gasPrice",r),r;const{maxPriorityFeePerGas:c}=await t();if(c)return d("Using maxPriorityFeePerGas from estimate",c),c;return d("Setting maxPriorityFeePerGas to maxFeePerGas",o),o}(n,m,l,s),t.userFeeLevel=function(e,t,n,s){const{origin:i}=e,{maxFeePerGas:r,maxPriorityFeePerGas:c}=t,{maxFeePerGas:l,maxPriorityFeePerGas:u}=n||{};if(h(r)&&h(c)&&s?.gasPrice)return i===a.ORIGIN_METAMASK?o.UserFeeLevel.CUSTOM:o.UserFeeLevel.DAPP_SUGGESTED;if(h(r)&&h(c)&&l&&u)return o.UserFeeLevel.MEDIUM;if(i===a.ORIGIN_METAMASK)return o.UserFeeLevel.CUSTOM;return o.UserFeeLevel.DAPP_SUGGESTED}(t,n,u,s)}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/gas-fees.cjs"}],[2786,{"../constants.cjs":2777,"../helpers/Bundler.cjs":2778,"../logger.cjs":2782,"@metamask/controller-utils":1301,"@metamask/utils":2799,"bn.js":3699},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateGas=void 0;const a=e("@metamask/controller-utils"),i=e("@metamask/utils"),r=s(e("bn.js")),o=e("../constants.cjs"),c=e("../helpers/Bundler.cjs"),l=e("../logger.cjs"),u=(0,l.createModuleLogger)(l.projectLogger,"gas");function d(e){const t=("string"==typeof e?(0,a.hexToBN)(e):new r.default(e)).muln(1.5);return(0,i.add0x)(t.toString(16))}n.updateGas=async function(e,t,n){const{userOperation:s}=e;if(t.gas)return s.callGasLimit=t.gas.callGasLimit,s.preVerificationGas=t.gas.preVerificationGas,s.verificationGasLimit=t.gas.verificationGasLimit,void u("Using gas values from smart contract account",{callGasLimit:s.callGasLimit,preVerificationGas:s.preVerificationGas,verificationGasLimit:s.verificationGasLimit});const a={...s,maxFeePerGas:o.VALUE_ZERO,maxPriorityFeePerGas:o.VALUE_ZERO,callGasLimit:o.VALUE_ZERO,preVerificationGas:o.VALUE_ZERO,verificationGasLimit:"0xF4240"},i=new c.Bundler(e.bundlerUrl),r=await i.estimateUserOperationGas(a,n);s.callGasLimit=d(r.callGasLimit),s.preVerificationGas=d(r.preVerificationGas),s.verificationGasLimit=d(r.verificationGasLimit??r.verificationGas),u("Using buffered gas values from bundler estimate",{callGasLimit:s.callGasLimit,preVerificationGas:s.preVerificationGas,verificationGasLimit:s.verificationGasLimit,multiplier:1.5,estimate:r})}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/gas.cjs"}],[2787,{"../constants.cjs":2777,"../types.cjs":2783,"@metamask/transaction-controller":2754,"@metamask/utils":2799,"bn.js":3699},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionMetadata=void 0;const a=e("@metamask/transaction-controller"),i=e("@metamask/utils"),r=s(e("bn.js")),o=e("../constants.cjs"),c=e("../types.cjs");n.getTransactionMetadata=function(e){const{actualGasCost:t,actualGasUsed:n,baseFeePerGas:s,chainId:l,error:u,origin:d,transactionHash:p,id:h,swapsMetadata:m,time:f,transactionParams:g,transactionType:y,userFeeLevel:v,userOperation:b}=e;if(!g)return undefined;const S=t&&n?(0,i.add0x)(new r.default((0,i.remove0x)(t),16).div(new r.default((0,i.remove0x)(n),16)).toString(16)):undefined,w=u?{name:u.name,message:u.message,stack:u.stack,code:u.code,rpc:u.rpc}:undefined,T={[c.UserOperationStatus.Unapproved]:a.TransactionStatus.unapproved,[c.UserOperationStatus.Approved]:a.TransactionStatus.approved,[c.UserOperationStatus.Signed]:a.TransactionStatus.signed,[c.UserOperationStatus.Submitted]:a.TransactionStatus.submitted,[c.UserOperationStatus.Confirmed]:a.TransactionStatus.confirmed,[c.UserOperationStatus.Failed]:a.TransactionStatus.failed}[e.status],_=function(...e){const t=new r.default(0);for(const n of e)n&&t.iadd(new r.default((0,i.remove0x)(n),16));return(0,i.add0x)(t.toString(16))}(b.preVerificationGas,b.verificationGasLimit,b.callGasLimit),k=b.paymasterAndData!==o.EMPTY_BYTES,E=k?o.VALUE_ZERO:b.maxFeePerGas,P=k?o.VALUE_ZERO:b.maxPriorityFeePerGas,A=b.nonce===o.EMPTY_BYTES?undefined:b.nonce,C={...g,from:b.sender,gas:_,nonce:A,maxFeePerGas:E,maxPriorityFeePerGas:P};delete C.gasPrice;const M={approvalTxId:m?.approvalTxId??undefined,destinationTokenAddress:m?.destinationTokenAddress??undefined,destinationTokenAmount:m?.destinationTokenAmount??undefined,destinationTokenDecimals:m?.destinationTokenDecimals??undefined,destinationTokenSymbol:m?.destinationTokenSymbol??undefined,estimatedBaseFee:m?.estimatedBaseFee??undefined,sourceTokenAddress:m?.sourceTokenAddress??undefined,sourceTokenAmount:m?.sourceTokenAmount??undefined,sourceTokenDecimals:m?.sourceTokenDecimals??undefined,sourceTokenSymbol:m?.sourceTokenSymbol??undefined,swapAndSendRecipient:m?.swapAndSendRecipient??undefined,swapMetaData:m?.swapMetaData??undefined,swapTokenValue:m?.swapTokenValue??undefined},O=k?a.UserFeeLevel.CUSTOM:v;return{baseFeePerGas:s??undefined,chainId:l,error:w,hash:p??undefined,id:h,isUserOperation:!0,networkClientId:"user-operation",origin:d,status:T,time:f,txParams:C,txReceipt:{effectiveGasPrice:S??undefined,gasUsed:n??undefined},type:y??undefined,userFeeLevel:O,...M}}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/transaction.cjs"}],[2788,{"../constants.cjs":2777,"@metamask/superstruct":2705,"@metamask/transaction-controller":2754,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateSignUserOperationResponse=n.validateUpdateUserOperationResponse=n.validatePrepareUserOperationResponse=n.validateAddUserOperationOptions=n.validateAddUserOperationRequest=void 0;const s=e("@metamask/superstruct"),a=e("@metamask/transaction-controller"),i=e("@metamask/utils"),r=e("../constants.cjs");function o(e,t,n){try{(0,s.assert)(e,t,n)}catch(e){const t=e.failures().map(e=>e.path.length?`${e.path.join(".")} - ${e.message}`:e.message).join("\n");throw new Error(`${n}\n${t}`)}}function c(){return(0,s.define)("Hexadecimal String",e=>(0,i.isStrictHexString)(e))}function l(){return(0,s.define)("Hexadecimal String or 0x",e=>(0,i.isStrictHexString)(e)||e===r.EMPTY_BYTES)}n.validateAddUserOperationRequest=function(e){const t=c(),n=l();o(e,(0,s.object)({data:(0,s.optional)(n),from:t,maxFeePerGas:(0,s.optional)(t),maxPriorityFeePerGas:(0,s.optional)(t),to:(0,s.optional)(t),value:(0,s.optional)(t)}),"Invalid request to add user operation")},n.validateAddUserOperationOptions=function(e){o(e,(0,s.object)({networkClientId:(0,s.string)(),origin:(0,s.string)(),requireApproval:(0,s.optional)((0,s.boolean)()),smartContractAccount:(0,s.optional)((0,s.object)({prepareUserOperation:(0,s.func)(),updateUserOperation:(0,s.func)(),signUserOperation:(0,s.func)()})),swaps:(0,s.optional)((0,s.object)({approvalTxId:(0,s.optional)((0,s.string)()),destinationTokenAddress:(0,s.optional)((0,s.string)()),destinationTokenDecimals:(0,s.optional)((0,s.number)()),destinationTokenSymbol:(0,s.optional)((0,s.string)()),estimatedBaseFee:(0,s.optional)((0,s.string)()),sourceTokenSymbol:(0,s.optional)((0,s.string)()),swapMetaData:(0,s.optional)((0,s.object)()),swapTokenValue:(0,s.optional)((0,s.string)()),destinationTokenAmount:(0,s.optional)((0,s.string)()),sourceTokenAddress:(0,s.optional)((0,s.string)()),sourceTokenAmount:(0,s.optional)((0,s.string)()),sourceTokenDecimals:(0,s.optional)((0,s.number)()),swapAndSendRecipient:(0,s.optional)((0,s.string)())})),type:(0,s.optional)((0,s.enums)(Object.values(a.TransactionType)))}),"Invalid options to add user operation")},n.validatePrepareUserOperationResponse=function(e){const t=c(),n=l();o(e,(0,s.refine)((0,s.object)({bundler:(0,s.string)(),callData:t,dummyPaymasterAndData:(0,s.optional)(n),dummySignature:(0,s.optional)(n),gas:(0,s.optional)((0,s.object)({callGasLimit:t,preVerificationGas:t,verificationGasLimit:t})),initCode:(0,s.optional)(n),nonce:t,sender:t}),"ValidPrepareUserOperationResponse",({gas:e,dummySignature:t})=>!!(e||t&&t!==r.EMPTY_BYTES)||"Must specify dummySignature if not specifying gas"),"Invalid response when preparing user operation")},n.validateUpdateUserOperationResponse=function(e){o(e,(0,s.optional)((0,s.object)({paymasterAndData:(0,s.optional)(l()),callGasLimit:(0,s.optional)(l()),preVerificationGas:(0,s.optional)(l()),verificationGasLimit:(0,s.optional)(l())})),"Invalid response when updating user operation")},n.validateSignUserOperationResponse=function(e){const t=c();o(e,(0,s.object)({signature:t}),"Invalid response when signing user operation")}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/validation.cjs"}],[279,{"../../../../../shared/types/transaction-decode":5557,"./four-byte":274,"./proxy":275,"./sourcify":276,"./uniswap":278,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionData=async function({transactionData:e,contractAddress:t,chainId:n,provider:s}){l("Decoding transaction data",{transactionData:e,contractAddress:t,chainId:n});const d=(0,i.decodeUniswapRouterTransactionData)({transactionData:e,contractAddress:t,chainId:n});if(d)return l("Decoded with Uniswap commands",d),{data:u(d),source:a.DecodedTransactionDataSource.Uniswap};const p=await(0,o.getContractProxyAddress)(t,s);p&&l("Retrieved proxy implementation address",p);const h=p??t,m=(0,r.decodeTransactionDataWithSourcify)(e,h,n),f=(0,c.decodeTransactionDataWithFourByte)(e),[g,y]=await Promise.allSettled([m,f]);if("fulfilled"===g.status&&g.value)return l("Decoded data with Sourcify",g.value),{data:u([g.value]),source:a.DecodedTransactionDataSource.Sourcify};if(l("Failed to decode data with Sourcify",g),"fulfilled"===y.status&&y.value)return l("Decoded data with 4Byte",y.value),{data:u([y.value]),source:a.DecodedTransactionDataSource.FourByte};return l("Failed to decode data with 4Byte",y),undefined};var s=e("@metamask/utils"),a=e("../../../../../shared/types/transaction-decode"),i=e("./uniswap"),r=e("./sourcify"),o=e("./proxy"),c=e("./four-byte");const l=(0,s.createProjectLogger)("transaction-decode");function u(e){return e.map(e=>function(e){return{...e,params:e.params.map(e=>d(e))}}(e))}function d(e){var t;return{...e,value:p(e.value),children:null===(t=e.children)||void 0===t?void 0:t.map(e=>d(e))}}function p(e){const t=e._hex;return t?BigInt(t).toString():e}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/util.ts"}],[28,{"@metamask/assets-controllers":1157},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CurrencyRateControllerInit=void 0;var s=e("@metamask/assets-controllers");n.CurrencyRateControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n})=>{const a=new s.CurrencyRateController({state:n.CurrencyController,messenger:e,includeUsdRate:!0,useExternalServices:()=>t.call("PreferencesController:getState").useExternalServices}),i=a.fetchMultiExchangeRate.bind(a);return a.fetchMultiExchangeRate=(...e)=>{const{useCurrencyRateCheck:n}=t.call("PreferencesController:getState");return n?i(...e):{conversionRate:null,usdConversionRate:null}},{memStateKey:"CurrencyController",persistedStateKey:"CurrencyController",controller:a}}}}},{package:"$root$",file:"app/scripts/controller-init/currency-rate-controller-init.ts"}],[280,{"../../../../../shared/lib/delegation":5495,"../../../../../shared/lib/delegation/caveatBuilder/exactExecutionBuilder":5486,"../../../../../shared/lib/delegation/caveatBuilder/limitedCallsBuilder":5488,"../../../../../shared/lib/delegation/caveatBuilder/specificActionERC20TransferBatchBuilder":5491,"../../../../../shared/lib/delegation/delegation":5492,"../transaction-relay":284,"@ethersproject/abi":631,"@metamask/metamask-eth-abis":2064,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Delegation7702PublishHook=void 0;var s=e("@ethersproject/abi"),a=e("@metamask/metamask-eth-abis"),i=e("@metamask/utils"),r=e("../../../../../shared/lib/delegation"),o=e("../../../../../shared/lib/delegation/caveatBuilder/exactExecutionBuilder"),c=e("../../../../../shared/lib/delegation/caveatBuilder/limitedCallsBuilder"),l=e("../../../../../shared/lib/delegation/caveatBuilder/specificActionERC20TransferBatchBuilder"),u=e("../../../../../shared/lib/delegation/delegation"),d=e("../transaction-relay");function p(e,t,n){h(e,t),t.set(e,n)}function h(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function m(e,t){return e.get(g(e,t))}function f(e,t,n){return e.set(g(e,t),n),n}function g(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const y={transactionHash:undefined},v=(0,i.createProjectLogger)("delegation-7702-publish-hook");var b=new WeakMap,S=new WeakMap,w=new WeakSet;async function T(e,t){try{return await g(w,this,_).call(this,e,t)}catch(e){throw v("Error",e),e}}async function _(e,t){const{chainId:n,gasFeeTokens:s,selectedGasFeeToken:a,txParams:i}=e,{from:o}=i,c=(await m(b,this).call(this,{address:o,chainIds:[n]})).find(e=>e.chainId.toLowerCase()===n.toLowerCase());if(!(c&&(!c.delegationAddress||c.isSupported)))return v("Skipping as EIP-7702 is not supported",{from:o,chainId:n}),y;const{delegationAddress:l,upgradeContractAddress:p}=c,h=e.isGasFeeIncluded;if(!(a&&null!=s&&s.length||h))return v("Skipping as no selected gas fee token"),y;const f=h?undefined:null==s?void 0:s.find(e=>e.tokenAddress.toLowerCase()===(null==a?void 0:a.toLowerCase()));if(!f&&!h)throw new Error("Selected gas fee token not found");const S=(0,r.getDeleGatorEnvironment)(parseInt(e.chainId,16)),T=S.DelegationManager,_=!h;if(_&&(!f||f===undefined))throw new Error("Gas fee token not found");const P=await g(w,this,k).call(this,S,e,f,_),A=[_?r.BATCH_DEFAULT_MODE:r.SINGLE_DEFAULT_MODE],M=g(w,this,E).call(this,e,f,_),O=(0,u.encodeRedeemDelegations)({delegations:P,modes:A,executions:M}),I={chainId:n,data:O,to:T};l||(I.authorizationList=await g(w,this,C).call(this,e,p)),v("Relay request",I);const{uuid:j}=await(0,d.submitRelayTransaction)(I),{transactionHash:R,status:x}=await(0,d.waitForRelayResult)({chainId:n,uuid:j,interval:1e3});if(x!==d.RelayStatus.Success)throw new Error(`Transaction relay error - ${x}`);return{transactionHash:R}}async function k(e,t,n,s){const a=g(w,this,P).call(this,e,t,n,s);v("Signing delegation");const i=await m(S,this).call("DelegationController:signDelegation",{chainId:t.chainId,delegation:a});v("Delegation signature",i);return[[{...a,signature:i}]]}function E(e,t,n){const{txParams:s}=e,{data:a,to:i,value:r}=s,o={target:i,value:BigInt(r??"0x0"),callData:a??"0x"};if(!n)return[[o]];if(!t)throw new Error("Selected gas fee token not found");return[[o,{target:t.tokenAddress,value:BigInt("0x0"),callData:g(w,this,M).call(this,t.recipient,t.amount)}]]}function P(e,t,n,s){const a=g(w,this,A).call(this,e,t,n,s);v("Caveats",a);const i=(0,r.createDelegation)({from:t.txParams.from,to:u.ANY_BENEFICIARY,caveats:a});return v("Delegation",i),i}function A(e,t,n,s){const a=(0,r.createCaveatBuilder)(e),{txParams:i}=t,{to:u,value:d,data:p}=i;if(s&&n!==undefined){const{tokenAddress:e,recipient:t,amount:s}=n;u!==undefined&&a.addCaveat(l.specificActionERC20TransferBatch,e,t,s,u,d??"0x0",p)}else u!==undefined&&a.addCaveat(o.exactExecution,u,d??"0x0",p??"0x");return a.addCaveat(c.limitedCalls,1),a.build()}async function C(e,t){const{chainId:n,txParams:s}=e,{from:a,nonce:i}=s;if(v("Including authorization as not upgraded"),!t)throw new Error("Upgrade contract address not found");const r=await m(S,this).call("KeyringController:signEip7702Authorization",{chainId:parseInt(n,16),contractAddress:t,from:a,nonce:parseInt(i,16)}),{r:o,s:c,yParity:l}=g(w,this,O).call(this,r);return v("Authorization signature",{authorizationSignature:r,r:o,s:c,yParity:l}),[{address:t,chainId:n,nonce:i,r:o,s:c,yParity:l}]}function M(e,t){return new s.Interface(a.abiERC20).encodeFunctionData("transfer",[e,t])}function O(e){return{r:e.slice(0,66),s:`0x${e.slice(66,130)}`,yParity:parseInt(e.slice(130,132),16)-27==0?"0x":"0x1"}}n.Delegation7702PublishHook=class{constructor({isAtomicBatchSupported:e,messenger:t}){var n,s;h(n=this,s=w),s.add(n),p(this,b,void 0),p(this,S,void 0),f(b,this,e),f(S,this,t)}getHook(){return g(w,this,T).bind(this)}}}}},{package:"$root$",file:"app/scripts/lib/transaction/hooks/delegation-7702-publish.ts"}],[281,{"../containers/util":273,"@metamask/controller-utils":1301,"@metamask/transaction-controller":2754,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.EnforceSimulationHook=void 0;e("@metamask/transaction-controller");var s=e("@metamask/utils");e("@metamask/controller-utils"),e("../containers/util");function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(r(e,t))}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const o=(0,s.createProjectLogger)("enforce-simulation-hook");var c=new WeakMap,l=new WeakSet;async function u(e,t){const{transactionMeta:n}=t,{isFinal:s}=e,{containerTypes:a,delegationAddress:r,id:l,origin:u,simulationData:d,txParamsOriginal:p}=n,h=i(c,this).call("AppStateController:getState");(null==h?void 0:h.enableEnforcedSimulationsForTransactions[l])??(null==h||h.enableEnforcedSimulations);return o("Skipping as enforced simulations are disabled"),{skipSimulation:!1}}n.EnforceSimulationHook=class{constructor({messenger:e}){var t,n;a(t=this,n=l),n.add(t),function(e,t,n){a(e,t),t.set(e,n)}(this,c,void 0),function(e,t,n){e.set(r(e,t),n)}(c,this,e)}getAfterSimulateHook(){return r(l,this,u).bind(this,{})}getBeforeSignHook(){return r(l,this,u).bind(this,{isFinal:!0})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/hooks/enforce-simulation-hook.ts"}],[2812,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<e.length;s++){var a=e.charAt(s),i=a.charCodeAt(0);if(255!==t[i])throw new TypeError(a+" is ambiguous");t[i]=s}var r=e.length,o=e.charAt(0),c=Math.log(r)/Math.log(256),l=Math.log(256)/Math.log(r);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var n=0;if(" "!==e[n]){for(var s=0,a=0;e[n]===o;)s++,n++;for(var i=(e.length-n)*c+1>>>0,l=new Uint8Array(i);e[n];){var u=t[e.charCodeAt(n)];if(255===u)return;for(var d=0,p=i-1;(0!==u||d<a)&&-1!==p;p--,d++)u+=r*l[p]>>>0,l[p]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");a=d,n++}if(" "!==e[n]){for(var h=i-a;h!==i&&0===l[h];)h++;for(var m=new Uint8Array(s+(i-h)),f=s;h!==i;)m[f++]=l[h++];return m}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,s=0,a=0,i=t.length;a!==i&&0===t[a];)a++,n++;for(var c=(i-a)*l+1>>>0,u=new Uint8Array(c);a!==i;){for(var d=t[a],p=0,h=c-1;(0!==d||p<s)&&-1!==h;h--,p++)d+=256*u[h]>>>0,u[h]=d%r>>>0,d=d/r>>>0;if(0!==d)throw new Error("Non-zero carry");s=p,a++}for(var m=c-s;m!==c&&0===u[m];)m++;for(var f=o.repeat(n);m<c;++m)f+=e.charAt(u[m]);return f},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+r+" character")}}}}}},{package:"@ensdomains/content-hash>cids>multibase>@multiformats/base-x",file:"node_modules/@multiformats/base-x/src/index.js"}],[282,{"../../../../shared/constants/app":5415,"../../../../shared/constants/gas":5423,"../../../../shared/constants/metametrics":5430,"../../../../shared/constants/transaction":5451,"../../../../shared/lib/confirmation.utils":5463,"../../../../shared/lib/transactions-controller-utils":5519,"../../../../shared/modules/Numeric":5524,"../../../../shared/modules/conversion.utils":5529,"../../../../shared/modules/gas.utils":5534,"../../../../shared/modules/metametrics":5537,"../../../../shared/modules/transaction.utils":5553,"../../../../ui/helpers/utils/metrics":6683,"../snap-keyring/metrics":259,"../util":290,"@metamask/transaction-controller":2754,"@metamask/utils":2799,"bignumber.js":3648,"ethereumjs-util":4019},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handleTransactionSubmitted=n.handleTransactionRejected=n.handleTransactionFailed=n.handleTransactionDropped=n.handleTransactionConfirmed=n.handleTransactionApproved=n.handleTransactionAdded=n.handlePostTransactionBalanceUpdate=n.createTransactionEventFragmentWithTxId=n.METRICS_STATUS_FAILED=void 0;var s=e("bignumber.js"),a=e("ethereumjs-util"),i=e("@metamask/transaction-controller"),r=e("@metamask/utils"),o=e("../../../../shared/constants/app"),c=e("../../../../shared/constants/gas"),l=e("../../../../shared/constants/metametrics"),u=e("../../../../shared/constants/transaction"),d=e("../../../../shared/lib/transactions-controller-utils"),p=e("../../../../shared/modules/conversion.utils"),h=e("../../../../shared/modules/metametrics"),m=e("../../../../shared/modules/transaction.utils"),f=e("../../../../ui/helpers/utils/metrics"),g=e("../snap-keyring/metrics"),y=e("../../../../shared/lib/confirmation.utils"),v=e("../../../../shared/modules/gas.utils"),b=e("../../../../shared/modules/Numeric"),S=e("../util");const w=(0,r.createProjectLogger)("transaction-metrics"),T=n.METRICS_STATUS_FAILED="failed on-chain",_=[i.TransactionType.bridge,i.TransactionType.bridgeApproval,i.TransactionType.contractInteraction,i.TransactionType.tokenMethodApprove,i.TransactionType.tokenMethodIncreaseAllowance,i.TransactionType.tokenMethodSafeTransferFrom,i.TransactionType.tokenMethodSetApprovalForAll,i.TransactionType.tokenMethodTransfer,i.TransactionType.tokenMethodTransferFrom,i.TransactionType.swap,i.TransactionType.swapAndSend,i.TransactionType.swapApproval];var k=function(e){return e.swap="mm_swap",e.bridge="mm_bridge",e}(k||{});n.handleTransactionAdded=async(e,t)=>{if(!t.transactionMeta)return;const{properties:n,sensitiveProperties:s}=await C({transactionEventPayload:t,transactionMetricsRequest:e});E({eventName:u.TransactionMetaMetricsEvent.added,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:n,sensitiveProperties:s}})};n.handleTransactionApproved=async(e,t)=>{t.transactionMeta&&await P({eventName:u.TransactionMetaMetricsEvent.approved,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionFailed=async(e,t)=>{if(!t.transactionMeta)return;const n={};t.error&&(n.error=t.error),await P({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:n,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionConfirmed=async(e,t)=>{if(0===Object.keys(t).length)return;const n={},s={...t},{txReceipt:a}=s;n.gas_used=null==a?void 0:a.gasUsed,n.block_number=(null==a?void 0:a.blockNumber)&&(0,p.hexToDecimal)(a.blockNumber);const{submittedTime:i,blockTimestamp:r}=s;i&&(n.completion_time=function(e){return Math.round((Date.now()-e)/1e3).toString()}(i)),i&&r&&(n.completion_time_onchain=function(e,t){const n=2,s=Number((0,p.hexToDecimal)(t))-e/1e3;return(Math.round(s*10**n)/10**n).toString()}(i,r)),"0x0"===(null==a?void 0:a.status)&&(n.status=T),await P({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:n,transactionEventPayload:{actionId:s.actionId,transactionMeta:s},transactionMetricsRequest:e})};n.handleTransactionDropped=async(e,t)=>{if(!t.transactionMeta)return;await P({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:{dropped:!0},transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionRejected=async(e,t)=>{t.transactionMeta&&await P({eventName:u.TransactionMetaMetricsEvent.rejected,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionSubmitted=async(e,t)=>{if(!t.transactionMeta)return;const{properties:n,sensitiveProperties:s}=await C({transactionEventPayload:t,transactionMetricsRequest:e});E({eventName:u.TransactionMetaMetricsEvent.submitted,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:n,sensitiveProperties:s}})};n.createTransactionEventFragmentWithTxId=async(e,{transactionId:t,actionId:n})=>{const s={...e.getTransaction(t),actionId:n},{properties:a,sensitiveProperties:i}=await C({transactionEventPayload:{transactionMeta:s},transactionMetricsRequest:e});E({eventName:u.TransactionMetaMetricsEvent.approved,transactionEventPayload:{actionId:s.actionId,transactionMeta:s},transactionMetricsRequest:e,payload:{properties:a,sensitiveProperties:i}})};function E({eventName:e,transactionEventPayload:{transactionMeta:t,actionId:n},transactionMetricsRequest:s,payload:a}){if(function(e,t,n){const s=A(t,n.id);return void 0!==e(s)}(s.getEventFragmentById,e,t)&&e!==u.TransactionMetaMetricsEvent.submitted)return;const i=A(e,t.id);switch(e){case u.TransactionMetaMetricsEvent.added:s.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,initialEvent:u.TransactionMetaMetricsEvent.added,successEvent:u.TransactionMetaMetricsEvent.approved,failureEvent:u.TransactionMetaMetricsEvent.rejected,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:i,persist:!0});break;case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.rejected:s.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,successEvent:u.TransactionMetaMetricsEvent.approved,failureEvent:u.TransactionMetaMetricsEvent.rejected,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:i,persist:!0});break;case u.TransactionMetaMetricsEvent.submitted:s.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,initialEvent:u.TransactionMetaMetricsEvent.submitted,successEvent:u.TransactionMetaMetricsEvent.finalized,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:i,persist:!0});break;case u.TransactionMetaMetricsEvent.finalized:s.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,successEvent:u.TransactionMetaMetricsEvent.finalized,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:i,persist:!0})}}async function P({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,extraParams:s={}}){const{properties:a,sensitiveProperties:i}=await C({transactionEventPayload:t,transactionMetricsRequest:n,extraParams:s});E({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,payload:{properties:a,sensitiveProperties:i}}),function({eventName:e,transactionEventPayload:{transactionMeta:t},transactionMetricsRequest:n,payload:s}){const a=A(e,t.id);switch(e){case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.rejected:case u.TransactionMetaMetricsEvent.finalized:n.updateEventFragment(a,{properties:s.properties,sensitiveProperties:s.sensitiveProperties})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,payload:{properties:a,sensitiveProperties:i}}),function({eventName:e,transactionMetricsRequest:t,transactionEventPayload:{transactionMeta:n}}){const s=A(e,n.id);switch(e){case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.finalized:t.finalizeEventFragment(s);break;case u.TransactionMetaMetricsEvent.rejected:t.finalizeEventFragment(s,{abandoned:!0})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n})}function A(e,t){return`transaction-${e===u.TransactionMetaMetricsEvent.finalized||e===u.TransactionMetaMetricsEvent.submitted?"submitted":"added"}-${t}`}async function C({transactionEventPayload:{transactionMeta:e},transactionMetricsRequest:t,extraParams:n={}}){var T;const{type:k,time:E,status:P,chainId:A,origin:C,txParams:{gasPrice:O,gas:I,maxFeePerGas:j,maxPriorityFeePerGas:R,estimateSuggested:x,estimateUsed:N},defaultGasEstimates:D,originalType:L,replacedById:F,customTokenAmount:U,dappProposedTokenAmount:$,currentTokenBalance:B,originalApprovalAmount:H,finalApprovalAmount:G,securityProviderResponse:q,simulationFails:V,id:W,userFeeLevel:Y}=e,K=C===o.ORIGIN_METAMASK?"user":"dapp",z="dappSuggested"===Y?"dapp_proposed":Y,{assetType:J,tokenStandard:Z}=await(0,m.determineTransactionAssetType)(e,t.provider,t.getTokenStandardAndDetails);let X;if(e.txParams.data){const n=await t.getMethodData(e.txParams.data);X=null==n?void 0:n.name}const Q={};if((0,m.isEIP1559Transaction)(e)?(Q.max_fee_per_gas=j,Q.max_priority_fee_per_gas=R):(Q.gas_price=O,Q.default_estimate=l.MetaMetricsEventTransactionEstimateType.DefaultEstimate),D){var ee,te;const{estimateType:n}=D;if(n){var ne,se;Q.default_estimate=n===c.PriorityLevels.dAppSuggested?l.MetaMetricsEventTransactionEstimateType.DappProposed:n;let s=null===(ne=e.defaultGasEstimates)||void 0===ne?void 0:ne.maxFeePerGas,a=null===(se=e.defaultGasEstimates)||void 0===se?void 0:se.maxPriorityFeePerGas;if([c.GasRecommendations.low,c.GasRecommendations.medium,c.GasRecommendations.high].includes(n)){var ae,ie;const{gasFeeEstimates:e}=await t.getEIP1559GasFeeEstimates();var re,oe;if(null!=e&&null!==(ae=e[n])&&void 0!==ae&&ae.suggestedMaxFeePerGas)s=null===(re=e[n])||void 0===re?void 0:re.suggestedMaxFeePerGas,Q.default_max_fee_per_gas=s;if(null!=e&&null!==(ie=e[n])&&void 0!==ie&&ie.suggestedMaxPriorityFeePerGas)a=null===(oe=e[n])||void 0===oe?void 0:oe.suggestedMaxPriorityFeePerGas,Q.default_max_priority_fee_per_gas=a}}null!==(ee=e.defaultGasEstimates)&&void 0!==ee&&ee.gas&&(Q.default_gas=e.defaultGasEstimates.gas),null!==(te=e.defaultGasEstimates)&&void 0!==te&&te.gasPrice&&(Q.default_gas_price=e.defaultGasEstimates.gasPrice)}x&&(Q.estimate_suggested=x),N&&(Q.estimate_used=N),null!=n&&n.gas_used&&(Q.gas_used=n.gas_used);const ce=function(e){const t={};for(const n in e)(0,a.isHexString)(e[n])?t[n]=(0,p.hexWEIToDecGWEI)(e[n]):t[n]=e[n];return t}(Q);let le="0";e.txParams.maxFeePerGas&&(le="2");const ue="Approve";let de,pe,he,me,fe,ge;const{transactionType:ye,isContractInteraction:ve}=function(e,t){const n=e&&_.includes(e);if([i.TransactionType.swapAndSend,i.TransactionType.cancel,i.TransactionType.deployContract,i.TransactionType.gasPayment,i.TransactionType.batch].includes(e))return{transactionType:e,isContractInteraction:n};if(e===i.TransactionType.retry&&t)return{transactionType:t,isContractInteraction:n};if(n){const t=M(e);return t?{transactionType:t,isContractInteraction:!0}:{transactionType:i.TransactionType.contractInteraction,isContractInteraction:!0}}return{transactionType:i.TransactionType.simpleSend,isContractInteraction:!1}}(k,L);var be,Se;ve&&(pe=X,fe=null===(be=e.txParams)||void 0===be?void 0:be.to,ge=null===(Se=e.txParams)||void 0===Se||null===(Se=Se.data)||void 0===Se?void 0:Se.slice(0,10),pe===ue&&Z===u.TokenStandard.ERC20&&("0"===$||"0"===U?de=u.TransactionApprovalAmountType.revoke:U&&U!==$?de=u.TransactionApprovalAmountType.custom:$&&(de=u.TransactionApprovalAmountType.dappProposed),he=function(e,t,n){if(e===u.TransactionApprovalAmountType.custom&&t&&n)return`${new s.BigNumber(t,10).div(n,10).times(100).round(2)}`;return null}(de,H,G),me=function(e,t,n){if((e===u.TransactionApprovalAmountType.custom||e===u.TransactionApprovalAmountType.dappProposed)&&t&&n)return`${new s.BigNumber(t,16).div(n,10).times(100).round(2)}`;return null}(de,$,B)));const we=t.getTransaction(F),Te={RETRY:i.TransactionType.retry,CANCEL:i.TransactionType.cancel,SAME_NONCE:"other"};let _e;null!=n&&n.dropped&&(_e=Te.SAME_NONCE,(null==we?void 0:we.type)===i.TransactionType.cancel?_e=Te.CANCEL:(null==we?void 0:we.type)===i.TransactionType.retry&&(_e=Te.RETRY));const ke=[];let Ee=null;1===(null==q?void 0:q.flagAsDangerous)?ke.push(l.MetaMetricsEventUiCustomization.FlaggedAsMalicious):2===(null==q?void 0:q.flagAsDangerous)&&ke.push(l.MetaMetricsEventUiCustomization.FlaggedAsSafetyUnknown);const Pe=(0,f.getBlockaidMetricsProps)(e);(null==Pe||null===(T=Pe.ui_customizations)||void 0===T?void 0:T.length)>0&&ke.push(...Pe.ui_customizations),V&&ke.push(l.MetaMetricsEventUiCustomization.GasEstimationFailed);(0,y.shouldUseRedesignForTransactions)({transactionMetadataType:e.type})&&(ke.push(l.MetaMetricsEventUiCustomization.RedesignedConfirmation),Ee=t.getIsConfirmationAdvancedDetailsOpen());const Ae=(0,h.getSmartTransactionMetricsProperties)(t,e),Ce=(0,f.getSwapAndSendMetricsProps)(e),Me={hd_entropy_index:t.getHDEntropyIndex()};let Oe;try{Oe=await t.getAccountType(t.getSelectedAddress())}catch(e){Oe="error",w("Error getting account type for transaction metrics:",e)}let Ie={chain_id:A,referrer:C,source:K,status:P,network:`${parseInt(A,16)}`,eip_1559_version:le,gas_edit_type:"none",gas_edit_attempted:"none",gas_estimation_failed:Boolean(V),account_type:Oe,device_model:await t.getDeviceModel(t.getSelectedAddress()),asset_type:J,token_standard:Z,transaction_type:ye,transaction_speed_up:k===i.TransactionType.retry,transaction_internal_id:W,gas_fee_selected:z,...Pe,ui_customizations:ke.length>0?ke:null,transaction_advanced_view:Ee,transaction_contract_method:pe?[pe]:[],...Ae,...Ce,...Me};const je=await(0,g.getSnapAndHardwareInfoForMetrics)(t.getAccountType,t.getDeviceModel,t.getHardwareTypeForMetric,t.snapAndHardwareMessenger);var Re,xe;(Object.assign(Ie,je),pe===ue||M(k))&&(Ie={...Ie,simulation_receiving_assets_total_value:Ie.simulation_receiving_assets_total_value??(null==e||null===(Re=e.assetsFiatValues)||void 0===Re?void 0:Re.receiving),simulation_sending_assets_total_value:Ie.simulation_sending_assets_total_value??(null==e||null===(xe=e.assetsFiatValues)||void 0===xe?void 0:xe.sending),transaction_approval_amount_type:de});let Ne={transaction_envelope_type:(0,m.isEIP1559Transaction)(e)?d.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:d.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:E,gas_limit:I,transaction_replaced:_e,transaction_contract_address:fe?[fe]:[],transaction_contract_method_4byte:ge,...n,...ce};if(pe===ue&&(Ne={...Ne,transaction_approval_amount_vs_balance_ratio:me,transaction_approval_amount_vs_proposed_ratio:he}),await async function(e,t,n,s){const a=origin&&origin!==o.ORIGIN_METAMASK,{delegationAddress:r,nestedTransactions:c,txParams:l}=e,{authorizationList:d}=l,p=Boolean(null==c?void 0:c.length),h=Boolean(null==d?void 0:d.length);a&&(n.api_method=p?o.MESSAGE_TYPE.WALLET_SEND_CALLS:o.MESSAGE_TYPE.ETH_SEND_TRANSACTION);p&&(n.batch_transaction_count=null==c?void 0:c.length,n.batch_transaction_method="eip7702",n.transaction_contract_method=await async function(e,t){const n=e.filter(e=>_.includes(e.type)&&e.data).map(e=>e.data),s=await Promise.all(n.map(e=>t(e)));return s.map(e=>null==e?void 0:e.name).filter(e=>null==e?void 0:e.length)}(c??[],t),s.transaction_contract_address=null==c?void 0:c.filter(e=>{var t;return _.includes(e.type)&&(null===(t=e.to)||void 0===t?void 0:t.length)}).map(e=>e.to));if(e.status===i.TransactionStatus.rejected){const{error:t}=e;n.eip7702_upgrade_rejection=h&&t.code===u.EIP5792ErrorCode.RejectedUpgrade}n.eip7702_upgrade_transaction=h,s.account_eip7702_upgraded=r}(e,t.getMethodData,Ie,Ne),function(e,t,n,s){var a;const{gasFeeTokens:i,selectedGasFeeToken:o}=e;t.gas_payment_tokens_available=null==i?void 0:i.map(e=>e.symbol),t.gas_paid_with=null==i||null===(a=i.find(e=>e.tokenAddress.toLowerCase()===(null==o?void 0:o.toLowerCase())))||void 0===a?void 0:a.symbol,(null==o?void 0:o.toLowerCase())===u.NATIVE_TOKEN_ADDRESS&&(t.gas_paid_with="pre-funded_ETH");t.gas_insufficient_native_asset=function(e,t){const{chainId:n,txParams:s}=e,{from:a,gas:i,gasPrice:o,maxFeePerGas:c,value:l}=s,u=t(a,n),d=(0,v.getMaximumGasTotalInHexWei)({gasLimit:i,gasPrice:o,maxFeePerGas:c}),h=(0,r.add0x)((0,p.addHexes)(d,l??"0x0"));return new b.Numeric(h,16).greaterThan(new b.Numeric(u,16))}(e,s)}(e,Ie,0,t.getAccountBalance),P===i.TransactionStatus.submitted||P===i.TransactionStatus.confirmed){const n=t.getNetworkRpcUrl(e.chainId),s=(0,S.extractRpcDomain)(n);Ie.rpc_domain=s}return{properties:Ie,sensitiveProperties:Ne}}function M(e){return e===i.TransactionType.swap?k.swap:e===i.TransactionType.bridge?k.bridge:null}n.handlePostTransactionBalanceUpdate=async({getParticipateInMetrics:e,trackEvent:t,getHDEntropyIndex:n},{transactionMeta:a,approvalTransactionMeta:i})=>{var r;if(e()&&a.swapMetaData)if("0x0"===(null===(r=a.txReceipt)||void 0===r?void 0:r.status))t({event:l.MetaMetricsEventName.SwapFailed,category:l.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...a.swapMetaData},properties:{hd_entropy_index:n()}});else{var o;const e=(0,d.getSwapsTokensReceivedFromTxMeta)(a.destinationTokenSymbol,a,a.destinationTokenAddress,a.txParams.from,a.destinationTokenDecimals,i,a.chainId),r=e?`${new s.BigNumber(e,10).div(a.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,c=null!==(o=a.txReceipt)&&void 0!==o&&o.gasUsed&&a.swapMetaData.estimated_gas?`${new s.BigNumber(a.txReceipt.gasUsed,16).div(a.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null,u=function(e,t){var n,a;let i="0x0";null!=t&&t.txReceipt&&(i=(0,d.calcGasTotal)(t.txReceipt.gasUsed,t.txReceipt.effectiveGasPrice));const r=(0,d.calcGasTotal)(null===(n=e.txReceipt)||void 0===n?void 0:n.gasUsed,null===(a=e.txReceipt)||void 0===a?void 0:a.effectiveGasPrice),o=new s.BigNumber(r,16).plus(i,16).toString(16);return{approvalGasCostInEth:Number((0,p.hexWEIToDecETH)(i)),tradeGasCostInEth:Number((0,p.hexWEIToDecETH)(r)),tradeAndApprovalGasCostInEth:Number((0,p.hexWEIToDecETH)(o))}}(a,i);t({event:l.MetaMetricsEventName.SwapCompleted,category:l.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...a.swapMetaData,token_to_amount_received:e,quote_vs_executionRatio:r,estimated_vs_used_gasRatio:c,approval_gas_cost_in_eth:u.approvalGasCostInEth,trade_gas_cost_in_eth:u.tradeGasCostInEth,trade_and_approval_gas_cost_in_eth:u.tradeAndApprovalGasCostInEth,token_to_amount:a.swapMetaData.token_to_amount.toString(10)},properties:{hd_entropy_index:n()}})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/metrics.ts"}],[283,{"../../../../shared/modules/conversion.utils":5529,"../../../../shared/modules/fetch-with-timeout":5533},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.buildUrl=u,n.getSendBundleSupportedChains=async function(e){const t=await c();return e.reduce((e,n)=>{const s=(0,a.hexToDecimal)(n),i=t[s];return e[n]=(null==i?void 0:i.sendBundle)??!1,e},{})},n.getSentinelNetworkFlags=l,n.isSendBundleSupported=async function(e){const t=await l(e);if(null==t||!t.sendBundle)return!1;return!0};var s,a=e("../../../../shared/modules/conversion.utils"),i=(s=e("../../../../shared/modules/fetch-with-timeout"))&&s.__esModule?s:{default:s};const r="https://tx-sentinel-{0}.api.cx.metamask.io/",o="networks";async function c(){const e=`${u("ethereum-mainnet")}${o}`;return(await(0,i.default)()(e)).json()}async function l(e){const t=(0,a.hexToDecimal)(e);return(await c())[t]}function u(e){return r.replace("{0}",e)}}}},{package:"$root$",file:"app/scripts/lib/transaction/sentinel-api.ts"}],[284,{"../../../../shared/modules/fetch-with-timeout":5533,"../../../../shared/modules/rpc.utils":5542,"./sentinel-api":283,"@metamask/utils":2799},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RelayStatus=n.RELAY_RPC_METHOD=void 0,n.isRelaySupported=async function(e){return Boolean(await d(e))},n.submitRelayTransaction=async function(e){const{chainId:t}=e,n=await d(t);if(!n)throw new Error(`Chain not supported by transaction relay - ${t}`);c("Request",n,e);const s=await(0,i.jsonRpcRequest)(n,u,[e]);return c("Response",s),s},n.waitForRelayResult=async function(e){const{chainId:t,interval:n,uuid:s}=e,a=await d(t);if(!a)throw new Error(`Chain not supported by transaction relay - ${t}`);const i=`${a}smart-transactions/${s}`;return new Promise((e,t)=>{const s=setInterval(async()=>{try{const t=await async function(e){c("Polling request",e);const t=await(0,r.default)()(e);if(c("Polling response",t),!t.ok){const e=await t.text();throw new Error(`Failed to fetch relay transaction status: ${t.status} - ${e}`)}const n=await t.json(),s=null==n?void 0:n.transactions[0],{hash:a,status:i}=s||{};return{status:i,transactionHash:a}}(i);t.status!==l.Pending&&(clearInterval(s),e(t))}catch(e){clearInterval(s),t(e)}},n)})};var s,a=e("@metamask/utils"),i=e("../../../../shared/modules/rpc.utils"),r=(s=e("../../../../shared/modules/fetch-with-timeout"))&&s.__esModule?s:{default:s},o=e("./sentinel-api");const c=(0,a.createProjectLogger)("transaction-relay");let l=n.RelayStatus=function(e){return e.Pending="PENDING",e.Success="VALIDATED",e}({});const u=n.RELAY_RPC_METHOD="eth_sendRelayTransaction";async function d(e){const t=await(0,o.getSentinelNetworkFlags)(e);return null!=t&&t.relayTransactions?(0,o.buildUrl)(t.network):(c("Chain is not supported",e),undefined)}}}},{package:"$root$",file:"app/scripts/lib/transaction/transaction-relay.ts"}],[285,{"../../../../shared/constants/app":5415,"../../../../shared/constants/security-provider":5441,"../../../../shared/lib/trace":5517,"../ppom/ppom-util":231,"../trust-signals/security-alerts-api":286,"../trust-signals/trust-signals-util":288,"@metamask/keyring-api":1994,"ethereumjs-util":4019},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.addDappTransaction=async function(e){const{dappRequest:t}=e,{id:n,method:s,origin:a}=t,{securityAlertResponse:i,traceContext:r}=t,c={actionId:n,method:s,origin:a,requireApproval:!0,securityAlertResponse:i};(0,o.endTrace)({name:o.TraceName.Middleware,id:n});const{waitForHash:l}=await d({...e,transactionOptions:{...c,traceContext:r}}),u=await l();return(0,o.endTrace)({name:o.TraceName.Transaction,id:n}),u},n.addTransaction=async function(e){await async function(e){const{chainId:t,ppomController:n,securityAlertsEnabled:s,transactionOptions:a,transactionParams:o,updateSecurityAlertResponse:d,internalAccounts:p,getSecurityAlertsConfig:h}=e;!function(e){const{getSecurityAlertResponse:t,addSecurityAlertResponse:n,securityAlertsEnabled:s,transactionOptions:a,transactionParams:i,chainId:r}=e,{origin:o}=a;if(o!==c.ORIGIN_METAMASK||!s)return;const{to:d}=i;if("string"!=typeof d)return;const p=(0,u.mapChainIdToSupportedEVMChain)(r);if(!p)return;(0,l.scanAddressAndAddToCache)(d,t,n,p).catch(e=>{console.error("[scanAddressForTrustSignals] error scanning address for trust signals:",e)})}(e);const{type:m}=a,f=r.SECURITY_PROVIDER_EXCLUDED_TRANSACTION_TYPES.includes(m);if(!s||f)return;if(p.some(({address:e})=>{var t;return e.toLowerCase()===(null===(t=o.to)||void 0===t?void 0:t.toLowerCase())}))return;try{const{from:s,to:c,value:l,data:u}=o,{actionId:p,origin:m}=a,f={method:"eth_sendTransaction",id:p??"",origin:m??"",params:[{from:s,to:c??"",value:l??"",data:u??""}],jsonrpc:"2.0"},g=(0,i.generateSecurityAlertId)();(0,i.validateRequestWithPPOM)({ppomController:n,request:f,securityAlertId:g,chainId:t,updateSecurityAlertResponse:d,getSecurityAlertsConfig:h});const y={...r.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:g};e.transactionOptions.securityAlertResponse=y}catch(e){(0,i.handlePPOMError)(e,"Error validating JSON RPC using PPOM: ")}}(e);const{transactionMeta:t,waitForHash:n}=await d(e);if(!e.waitForSubmit)return n().catch(()=>{}),t;const s=await n();return function(e,t){return t.state.transactions.find(t=>t.hash===e)}(s,e.transactionController)},n.getTransactionById=p;var s=e("@metamask/keyring-api"),a=e("ethereumjs-util"),i=e("../ppom/ppom-util"),r=e("../../../../shared/constants/security-provider"),o=e("../../../../shared/lib/trace"),c=e("../../../../shared/constants/app"),l=e("../trust-signals/security-alerts-api"),u=e("../trust-signals/trust-signals-util");async function d(e){const{selectedAccount:t}=e;return t.type===s.EthAccountType.Erc4337?async function(e){var t;const{networkClientId:n,transactionController:s,transactionOptions:i,transactionParams:r,userOperationController:o}=e,{maxFeePerGas:c,maxPriorityFeePerGas:l}=r,{origin:u,requireApproval:d,type:h}=i,m={...r,maxFeePerGas:(0,a.addHexPrefix)(c),maxPriorityFeePerGas:(0,a.addHexPrefix)(l)},f=null==i||null===(t=i.swaps)||void 0===t?void 0:t.meta;null!=f&&f.type&&delete f.type;const g={networkClientId:n,origin:u,requireApproval:d,swaps:f,type:h},y=await o.addUserOperationFromTransaction(m,g);o.startPollingByNetworkClientId(n);return{transactionMeta:p(y.id,s),waitForHash:y.transactionHash}}(e):async function(e){const{transactionController:t,transactionOptions:n,transactionParams:s,networkClientId:a}=e,{result:i,transactionMeta:r}=await t.addTransaction(s,{...n,networkClientId:a});return{transactionMeta:r,waitForHash:()=>i}}(e)}function p(e,t){return t.state.transactions.find(t=>t.id===e)}}}},{package:"$root$",file:"app/scripts/lib/transaction/util.ts"}],[2856,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.openrpcDocument=void 0,n.openrpcDocument={$schema:"https://meta.json-schema.tools/",$id:"https://meta.open-rpc.org/",title:"openrpcDocument",type:"object",required:["info","methods","openrpc"],additionalProperties:!1,patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}},properties:{openrpc:{title:"openrpc",type:"string",enum:["1.3.2","1.3.1","1.3.0","1.2.6","1.2.5","1.2.4","1.2.3","1.2.2","1.2.1","1.2.0","1.1.12","1.1.11","1.1.10","1.1.9","1.1.8","1.1.7","1.1.6","1.1.5","1.1.4","1.1.3","1.1.2","1.1.1","1.1.0","1.0.0","1.0.0-rc1","1.0.0-rc0"]},info:{$ref:"#/definitions/infoObject"},externalDocs:{$ref:"#/definitions/externalDocumentationObject"},servers:{title:"servers",type:"array",additionalItems:!1,items:{$ref:"#/definitions/serverObject"}},methods:{title:"methods",type:"array",additionalItems:!1,items:{title:"methodOrReference",oneOf:[{$ref:"#/definitions/methodObject"},{$ref:"#/definitions/referenceObject"}]}},components:{title:"components",type:"object",properties:{schemas:{title:"schemaComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/JSONSchema"}}},links:{title:"linkComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/linkObject"}}},errors:{title:"errorComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/errorObject"}}},examples:{title:"exampleComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/exampleObject"}}},examplePairings:{title:"examplePairingComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/examplePairingObject"}}},contentDescriptors:{title:"contentDescriptorComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/contentDescriptorObject"}}},tags:{title:"tagComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/tagObject"}}}}},$schema:{title:"metaSchema",description:"JSON Schema URI (used by some editors)",type:"string",default:"https://meta.open-rpc.org/"}},definitions:{specificationExtension:{title:"specificationExtension"},JSONSchema:{$ref:"https://meta.json-schema.tools"},referenceObject:{title:"referenceObject",type:"object",additionalProperties:!1,required:["$ref"],properties:{$ref:{$ref:"https://meta.json-schema.tools/#/definitions/JSONSchemaObject/properties/$ref"}}},errorObject:{title:"errorObject",type:"object",description:"Defines an application level error.",additionalProperties:!1,required:["code","message"],properties:{code:{title:"errorObjectCode",description:"A Number that indicates the error type that occurred. This MUST be an integer. The error codes from and including -32768 to -32000 are reserved for pre-defined errors. These pre-defined errors SHOULD be assumed to be returned from any JSON-RPC api.",type:"integer"},message:{title:"errorObjectMessage",description:"A String providing a short description of the error. The message SHOULD be limited to a concise single sentence.",type:"string"},data:{title:"errorObjectData",description:"A Primitive or Structured value that contains additional information about the error. This may be omitted. The value of this member is defined by the Server (e.g. detailed error information, nested errors etc.)."}}},licenseObject:{title:"licenseObject",type:"object",additionalProperties:!1,properties:{name:{title:"licenseObjectName",type:"string"},url:{title:"licenseObjectUrl",type:"string"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},contactObject:{title:"contactObject",type:"object",additionalProperties:!1,properties:{name:{title:"contactObjectName",type:"string"},email:{title:"contactObjectEmail",type:"string"},url:{title:"contactObjectUrl",type:"string"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},infoObject:{title:"infoObject",type:"object",additionalProperties:!1,required:["title","version"],properties:{title:{title:"infoObjectProperties",type:"string"},description:{title:"infoObjectDescription",type:"string"},termsOfService:{title:"infoObjectTermsOfService",type:"string",format:"uri"},version:{title:"infoObjectVersion",type:"string"},contact:{$ref:"#/definitions/contactObject"},license:{$ref:"#/definitions/licenseObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},serverObject:{title:"serverObject",type:"object",required:["url"],additionalProperties:!1,properties:{url:{title:"serverObjectUrl",type:"string",format:"uri"},name:{title:"serverObjectName",type:"string"},description:{title:"serverObjectDescription",type:"string"},summary:{title:"serverObjectSummary",type:"string"},variables:{title:"serverObjectVariables",type:"object",patternProperties:{"[0-z]+":{title:"serverObjectVariable",type:"object",required:["default"],properties:{default:{title:"serverObjectVariableDefault",type:"string"},description:{title:"serverObjectVariableDescription",type:"string"},enum:{title:"serverObjectVariableEnum",type:"array",items:{title:"serverObjectVariableEnumItem",type:"string"}}}}}}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},linkObject:{title:"linkObject",type:"object",additionalProperties:!1,properties:{name:{title:"linkObjectName",type:"string",minLength:1},summary:{title:"linkObjectSummary",type:"string"},method:{title:"linkObjectMethod",type:"string"},description:{title:"linkObjectDescription",type:"string"},params:{title:"linkObjectParams"},server:{title:"linkObjectServer",$ref:"#/definitions/serverObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},externalDocumentationObject:{title:"externalDocumentationObject",type:"object",additionalProperties:!1,description:"information about external documentation",required:["url"],properties:{description:{title:"externalDocumentationObjectDescription",type:"string"},url:{title:"externalDocumentationObjectUrl",type:"string",format:"uri"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},methodObject:{title:"methodObject",type:"object",required:["name","params"],additionalProperties:!1,properties:{name:{title:"methodObjectName",description:"The cannonical name for the method. The name MUST be unique within the methods array.",type:"string",minLength:1},description:{title:"methodObjectDescription",description:"A verbose explanation of the method behavior. GitHub Flavored Markdown syntax MAY be used for rich text representation.",type:"string"},summary:{title:"methodObjectSummary",description:"A short summary of what the method does.",type:"string"},servers:{title:"servers",type:"array",additionalItems:!1,items:{$ref:"#/definitions/serverObject"}},tags:{title:"methodObjectTags",type:"array",items:{title:"tagOrReference",oneOf:[{$ref:"#/definitions/tagObject"},{$ref:"#/definitions/referenceObject"}]}},paramStructure:{title:"methodObjectParamStructure",type:"string",description:"Format the server expects the params. Defaults to 'either'.",enum:["by-position","by-name","either"],default:"either"},params:{title:"methodObjectParams",type:"array",items:{title:"contentDescriptorOrReference",oneOf:[{$ref:"#/definitions/contentDescriptorObject"},{$ref:"#/definitions/referenceObject"}]}},result:{title:"methodObjectResult",oneOf:[{$ref:"#/definitions/contentDescriptorObject"},{$ref:"#/definitions/referenceObject"}]},errors:{title:"methodObjectErrors",description:"Defines an application level error.",type:"array",items:{title:"errorOrReference",oneOf:[{$ref:"#/definitions/errorObject"},{$ref:"#/definitions/referenceObject"}]}},links:{title:"methodObjectLinks",type:"array",items:{title:"linkOrReference",oneOf:[{$ref:"#/definitions/linkObject"},{$ref:"#/definitions/referenceObject"}]}},examples:{title:"methodObjectExamples",type:"array",items:{title:"examplePairingOrReference",oneOf:[{$ref:"#/definitions/examplePairingObject"},{$ref:"#/definitions/referenceObject"}]}},deprecated:{title:"methodObjectDeprecated",type:"boolean",default:!1},externalDocs:{$ref:"#/definitions/externalDocumentationObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},tagObject:{title:"tagObject",type:"object",additionalProperties:!1,required:["name"],properties:{name:{title:"tagObjectName",type:"string",minLength:1},description:{title:"tagObjectDescription",type:"string"},externalDocs:{$ref:"#/definitions/externalDocumentationObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},exampleObject:{title:"exampleObject",type:"object",required:["name","value"],properties:{summary:{title:"exampleObjectSummary",type:"string"},value:{title:"exampleObjectValue"},description:{title:"exampleObjectDescription",type:"string"},name:{title:"exampleObjectName",type:"string",minLength:1}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},examplePairingObject:{title:"examplePairingObject",type:"object",required:["name","params"],properties:{name:{title:"examplePairingObjectName",type:"string",minLength:1},description:{title:"examplePairingObjectDescription",type:"string"},params:{title:"examplePairingObjectParams",type:"array",items:{title:"exampleOrReference",oneOf:[{$ref:"#/definitions/exampleObject"},{$ref:"#/definitions/referenceObject"}]}},result:{title:"examplePairingObjectResult",oneOf:[{$ref:"#/definitions/exampleObject"},{$ref:"#/definitions/referenceObject"}]}}},contentDescriptorObject:{title:"contentDescriptorObject",type:"object",additionalProperties:!1,required:["name","schema"],properties:{name:{title:"contentDescriptorObjectName",type:"string",minLength:1},description:{title:"contentDescriptorObjectDescription",type:"string"},summary:{title:"contentDescriptorObjectSummary",type:"string"},schema:{$ref:"#/definitions/JSONSchema"},required:{title:"contentDescriptorObjectRequired",type:"boolean",default:!1},deprecated:{title:"contentDescriptorObjectDeprecated",type:"boolean",default:!1}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}}}},n.default=n.openrpcDocument}}},{package:"@open-rpc/meta-schema",file:"node_modules/@open-rpc/meta-schema/index.js"}],[2857,{"@json-schema-tools/dereferencer":752,"@json-schema-tools/reference-resolver":756,"fast-safe-stringify":4109},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},s.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(a,i){function r(e){try{c(s.next(e))}catch(e){i(e)}}function o(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,s,a,i,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(r=0)),r;)try{if(n=1,s&&(a=2&o[0]?s.return:o[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,o[1])).done)return a;switch(s=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,s=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],s=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenRPCDocumentDereferencingError=void 0;var o=r(e("@json-schema-tools/dereferencer")),c=r(e("@json-schema-tools/reference-resolver")),l=r(e("fast-safe-stringify")),u=function(e){this.name="OpenRPCDocumentDereferencingError",this.message="The json schema provided cannot be dereferenced. Received Error: \n ".concat(e)};n.OpenRPCDocumentDereferencingError=u;var d=function(e,t,n){return a(void 0,void 0,void 0,function(){var s,a;return i(this,function(i){switch(i.label){case 0:if((s=e.$ref)===undefined)return[2,e];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.resolve(s,t)];case 2:return[2,i.sent()];case 3:throw a=i.sent(),new u(["unable to eval pointer against OpenRPC Document.","error type: ".concat(a.name),"instance: ".concat(a.instance),"token: ".concat(a.token),"pointer: ".concat(s),"reference object: ".concat((0,l.default)(e))].join("\n"));case 4:return[2]}})})},p=function(e,t,n){return a(void 0,void 0,void 0,function(){var s,a,r,o,c,l;return i(this,function(i){switch(i.label){case 0:s=[],a=0,r=e,i.label=1;case 1:return a<r.length?(o=r[a],l=(c=s).push,[4,d(o,t,n)]):[3,4];case 2:l.apply(c,[i.sent()]),i.label=3;case 3:return a++,[3,1];case 4:return[2,s]}})})},h=function(e,t){return a(void 0,void 0,void 0,function(){var n,s,a;return i(this,function(i){switch(i.label){case 0:if(!0===e||!1===e)return[2,Promise.resolve(e)];t!==undefined&&(e.components={schemas:t}),n=new o.default(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.resolve()];case 2:return!0!==(s=i.sent())&&!1!==s&&(delete s.components,delete e.components),[2,s];case 3:throw a=i.sent(),new u(["Unable to parse reference inside of JSONSchema",e.title?"Schema Title: ".concat(e.title):"","error message: ".concat(a.message),"schema in question: ".concat((0,l.default)(e))].join("\n"));case 4:return[2]}})})},m=function(e){return a(void 0,void 0,void 0,function(){var t,n,s,a,r,o,c;return i(this,function(i){switch(i.label){case 0:if(e.components===undefined)return[2,Promise.resolve(e)];if(e.components.contentDescriptors===undefined)return[2,Promise.resolve(e)];t=e.components.contentDescriptors,n=Object.keys(t),s={},e.components.schemas&&(s=e.components.schemas),a=0,r=n,i.label=1;case 1:return a<r.length?(o=r[a],c=t[o],[4,h(t[o].schema,s)]):[3,4];case 2:c.schema=i.sent(),i.label=3;case 3:return a++,[3,1];case 4:return[2,e]}})})},f=function(e,t,n){return a(void 0,void 0,void 0,function(){var s,a,r,o,c,l,u,m,f,g,y,v,b,S,w,T,_,k,E,P;return i(this,function(i){switch(i.label){case 0:return s=e,e.$ref===undefined?[3,2]:[4,d({$ref:e.$ref},t,n)];case 1:s=i.sent(),i.label=2;case 2:return s.tags===undefined?[3,4]:(a=s,[4,p(s.tags,t,n)]);case 3:a.tags=i.sent(),i.label=4;case 4:return s.errors===undefined?[3,6]:(r=s,[4,p(s.errors,t,n)]);case 5:r.errors=i.sent(),i.label=6;case 6:return s.links===undefined?[3,8]:(o=s,[4,p(s.links,t,n)]);case 7:o.links=i.sent(),i.label=8;case 8:return s.examples===undefined?[3,14]:(c=s,[4,p(s.examples,t,n)]);case 9:c.examples=i.sent(),l=0,u=s.examples,i.label=10;case 10:return l<u.length?(m=u[l],f=m,[4,p(m.params,t,n)]):[3,14];case 11:return f.params=i.sent(),m.result===undefined?[3,13]:(g=m,[4,d(m.result,t,n)]);case 12:g.result=i.sent(),i.label=13;case 13:return l++,[3,10];case 14:return y=s,[4,p(s.params,t,n)];case 15:return y.params=i.sent(),s.result===undefined?[3,17]:(v=s,[4,d(s.result,t,n)]);case 16:v.result=i.sent(),i.label=17;case 17:b={},t.components&&t.components.schemas&&(b=t.components.schemas),S=s.params,w=0,T=S,i.label=18;case 18:return w<T.length?(_=T[w],k=_,[4,h(_.schema,b)]):[3,21];case 19:k.schema=i.sent(),i.label=20;case 20:return w++,[3,18];case 21:return s.result===undefined?[3,23]:(E=s.result,P=E,[4,h(E.schema,b)]);case 22:P.schema=i.sent(),i.label=23;case 23:return[2,s]}})})};n.default=function(e,t){return void 0===t&&(t=c.default),a(this,void 0,void 0,function(){var n,r,o,c,l,u,d;return i(this,function(p){switch(p.label){case 0:return n=s({},e),[4,(g=n,a(void 0,void 0,void 0,function(){var e,t,n,s,a,r,o;return i(this,function(i){switch(i.label){case 0:if(g.components===undefined)return[2,Promise.resolve(g)];if(g.components.schemas===undefined)return[2,Promise.resolve(g)];e=g.components.schemas,t=Object.keys(e),n=0,s=t,i.label=1;case 1:return n<s.length?(a=s[n],r=e,o=a,[4,h(e[a],e)]):[3,4];case 2:r[o]=i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2,g]}})}))];case 1:return n=p.sent(),[4,m(n)];case 2:n=p.sent(),r=[],o=0,c=n.methods,p.label=3;case 3:return o<c.length?(l=c[o],d=(u=r).push,[4,f(l,n,t)]):[3,6];case 4:d.apply(u,[p.sent()]),p.label=5;case 5:return o++,[3,3];case 6:return n.methods=r,[2,n]}var g})})}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/dereference-document.js"}],[2858,{"./dereference-document":2857,"./validate-open-rpc-document":2859,"@json-schema-tools/reference-resolver":756,"@json-schema-tools/reference-resolver/build/reference-resolver":757,"is-url":4353},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},s.apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,a)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},o=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(a,i){function r(e){try{c(s.next(e))}catch(e){i(e)}}function o(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((s=s.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,s,a,i,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(r=0)),r;)try{if(n=1,s&&(a=2&o[0]?s.return:o[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,o[1])).done)return a;switch(s=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,s=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],s=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.makeCustomResolver=void 0;var u=l(e("./dereference-document")),d=r(e("./validate-open-rpc-document")),p=l(e("@json-schema-tools/reference-resolver")),h=e("is-url"),m=l(e("@json-schema-tools/reference-resolver/build/reference-resolver")),f={dereference:!0,validate:!0};n.makeCustomResolver=function(e){return new m.default(e)},n.default=function(e,t){return function(n,a){return void 0===n&&(n="./openrpc.json"),void 0===a&&(a=f),o(this,void 0,void 0,function(){var i,r,o,l;return c(this,function(c){switch(c.label){case 0:return r=s(s({},f),a),"string"==typeof n?[3,1]:(i=n,[3,6]);case 1:return function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(n)?(i=JSON.parse(n),[3,6]):[3,2];case 2:return h(n)?[4,e(n)]:[3,4];case 3:return i=c.sent(),[3,6];case 4:return[4,t(n)];case 5:i=c.sent(),c.label=6;case 6:if(r.validate&&(l=(0,d.default)(i))instanceof d.OpenRPCDocumentValidationError)throw l;return o=i,r.dereference?r.resolver===undefined?[3,8]:[4,(0,u.default)(i,r.resolver)]:[3,10];case 7:return o=c.sent(),[3,10];case 8:return[4,(0,u.default)(i,p.default)];case 9:o=c.sent(),c.label=10;case 10:if(r.validate&&(l=(0,d.default)(o))instanceof d.OpenRPCDocumentValidationError)throw l;return[2,o]}})})}}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/parse-open-rpc-document.js"}],[2859,{"@json-schema-tools/meta-schema":753,"@open-rpc/meta-schema":2856,ajv:3496},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},s.apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenRPCDocumentValidationError=void 0;var i=a(e("@open-rpc/meta-schema")),r=a(e("ajv")),o=a(e("@json-schema-tools/meta-schema")),c=function(e){this.name="OpenRPCDocumentDereferencingError",this.message=["Error validating OpenRPC Document against @open-rpc/meta-schema.","The errors found are as follows:",JSON.stringify(e,undefined,"  ")].join("\n")};n.OpenRPCDocumentValidationError=c,n.default=function(e){var t=new r.default;t.addSchema(o.default,"https://meta.json-schema.tools");var n=s({},i.default);delete n.definitions.JSONSchema.$id,delete n.definitions.JSONSchema.$schema,delete n.$schema,delete n.$id;try{t.validate(n,e)}catch(e){throw new Error(["schema-utils-js: Internal Error","-----",e,"-----","If you see this report it: https://github.com/open-rpc/schema-utils-js/issues"].join("\n"))}return!t.errors||new c(t.errors)}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/validate-open-rpc-document.js"}],[286,{"../../../../shared/constants/time":5449,"../../../../shared/modules/fetch-with-timeout":5533,"./types":289},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.scanAddress=l,n.scanAddressAndAddToCache=async function(e,t,n,s){const a=t(e);if(a)return a;const i={result_type:r.ResultType.Loading,label:""};n(e,i);try{const t=await l(s,e);return n(e,t),t}catch(t){throw n(e,{result_type:r.ResultType.ErrorResult,label:""}),t}};var s,a=e("../../../../shared/constants/time"),i=(s=e("../../../../shared/modules/fetch-with-timeout"))&&s.__esModule?s:{default:s},r=e("./types");const o=5*a.SECOND,c="address/evm/scan";async function l(e,t){const n="https://security-alerts.api.cx.metamask.io";const s=`${n}/${c}`,a={chain:e,address:t},r=await(0,i.default)(o)(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await r.json()}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/security-alerts-api.ts"}],[287,{"../../../../shared/modules/transaction.utils":5553,"../ppom/security-alerts-api":233,"./security-alerts-api":286,"./trust-signals-util":288},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createTrustSignalsMiddleware=function(e,t,n,c,l){return async(u,d,p)=>{try{if(!(0,r.isSecurityAlertsEnabledByUser)(c)||!(0,a.isSecurityAlertsAPIEnabled)())return;(0,r.isEthSendTransaction)(u)?(!function(e,t,n){if(!(0,r.hasValidTransactionParams)(e))return;const{to:s}=e.params[0];let a;try{a=(0,r.getChainId)(n)}catch(e){return void console.error("[createTrustSignalsMiddleware] error getting chainId:",e)}if(!a)return;(0,i.scanAddressAndAddToCache)(s,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,a).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning address for transaction:",e)})}(u,t,e),o(u,n)):(0,r.isEthSignTypedData)(u)?(!function(e,t,n){var a;if(!(0,r.hasValidTypedDataParams)(e))return;const o=(0,s.parseTypedDataMessage)("string"==typeof e.params[1]?e.params[1]:JSON.stringify(e.params[1])),c=null===(a=o.domain)||void 0===a?void 0:a.verifyingContract;if(!c)return;let l;try{l=(0,r.getChainId)(n)}catch(e){return void console.error("[createTrustSignalsMiddleware] error getting chainId:",e)}if(!l)return;(0,i.scanAddressAndAddToCache)(c,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,l).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning address for signature:",e)})}(u,t,e),o(u,n)):((0,r.isConnected)(u,l)||(0,r.connectScreenHasBeenPrompted)(u))&&o(u,n)}catch(e){console.error("[createTrustSignalsMiddleware] error: ",e)}finally{p()}}};var s=e("../../../../shared/modules/transaction.utils"),a=e("../ppom/security-alerts-api"),i=e("./security-alerts-api"),r=e("./trust-signals-util");function o(e,t){e.origin&&t.scanUrl(e.origin).catch(e=>{console.error("[createTrustSignalsMiddleware] error:",e)})}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/trust-signals-middleware.ts"}],[2877,{assert:3756,buffer:3760,"component-type":3828,"join-component":4361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=e("component-type"),a=e("join-component"),i=e("assert");t.exports=function(e,t){switch(o(e),t=t||e.type,i(t,"You must pass an event type."),t){case"track":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),i(e.event,'You must pass an "event".')}(e);case"group":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),i(e.groupId,'You must pass a "groupId".')}(e);case"identify":case"page":case"screen":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".')}(e);case"alias":return function(e){i(e.userId,'You must pass a "userId".'),i(e.previousId,'You must pass a "previousId".')}(e);default:i(0,'Invalid event type: "'+t+'"')}};var r={anonymousId:["string","number"],category:"string",context:"object",event:"string",groupId:["string","number"],integrations:"object",name:"string",previousId:["string","number"],timestamp:"date",userId:["string","number"],type:"string"};function o(e){i("object"===s(e),"You must pass a message object.");var t=JSON.stringify(e);for(var o in i(n.byteLength(t,"utf8")<32768,"Your message must be < 32kb."),r){var c=e[o];if(c){var l=r[o];"array"!==s(l)&&(l=[l]);var u="object"===l[0]?"an":"a";i(l.some(function(e){return s(c)===e}),'"'+o+'" must be '+u+" "+a(l,"or")+".")}}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@segment/loosely-validate-event",file:"node_modules/@segment/loosely-validate-event/index.js"}],[288,{"../../../../shared/constants/app":5415,"../../../../shared/constants/network":5433,"../../../../shared/modules/selectors/networks":5547,"./types":289},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.connectScreenHasBeenPrompted=function(e){return e.method===i.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS||e.method===i.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS},n.getChainId=function(e){var t;const n=null===(t=(0,a.getProviderConfig)({metamask:e.state}))||void 0===t?void 0:t.chainId;if(!n)throw new Error("Chain ID not found");return c(n)},n.hasValidTransactionParams=function(e){if(!("params"in e)||!e.params)return!1;if(!Array.isArray(e.params)||0===e.params.length)return!1;const t=e.params[0];return"object"==typeof t&&null!==t&&"to"in t},n.hasValidTypedDataParams=function(e){if(!("params"in e)||!e.params)return!1;if(!Array.isArray(e.params)||e.params.length<2)return!1;return e.params[1]!==undefined&&null!==e.params[1]},n.isConnected=function(e,t){if(!e.origin||e.method!==i.MESSAGE_TYPE.ETH_ACCOUNTS)return!1;const n=t(e.origin);return Array.isArray(n)&&n.length>0},n.isEthSendTransaction=function(e){return e.method===i.MESSAGE_TYPE.ETH_SEND_TRANSACTION},n.isEthSignTypedData=function(e){return e.method===i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA||e.method===i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1||e.method===i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3||e.method===i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4},n.isSecurityAlertsEnabledByUser=function(e){const{securityAlertsEnabled:t}=e.state;return t},n.mapChainIdToSupportedEVMChain=c;var s=e("../../../../shared/constants/network"),a=e("../../../../shared/modules/selectors/networks"),i=e("../../../../shared/constants/app"),r=e("./types");const o={[s.CHAIN_IDS.ARBITRUM.toLowerCase()]:r.SupportedEVMChain.Arbitrum,[s.CHAIN_IDS.AVALANCHE.toLowerCase()]:r.SupportedEVMChain.Avalanche,[s.CHAIN_IDS.BASE.toLowerCase()]:r.SupportedEVMChain.Base,[s.CHAIN_IDS.BASE_SEPOLIA.toLowerCase()]:r.SupportedEVMChain.BaseSepolia,[s.CHAIN_IDS.BSC.toLowerCase()]:r.SupportedEVMChain.Bsc,[s.CHAIN_IDS.MAINNET.toLowerCase()]:r.SupportedEVMChain.Ethereum,[s.CHAIN_IDS.OPTIMISM.toLowerCase()]:r.SupportedEVMChain.Optimism,[s.CHAIN_IDS.POLYGON.toLowerCase()]:r.SupportedEVMChain.Polygon,[s.CHAIN_IDS.ZKSYNC_ERA.toLowerCase()]:r.SupportedEVMChain.Zksync,[s.CHAIN_IDS.ZK_SYNC_ERA_TESTNET.toLowerCase()]:r.SupportedEVMChain.ZksyncSepolia,"0x76adf1":r.SupportedEVMChain.Zora,[s.CHAIN_IDS.LINEA_MAINNET.toLowerCase()]:r.SupportedEVMChain.Linea,[s.CHAIN_IDS.BLAST.toLowerCase()]:r.SupportedEVMChain.Blast,[s.CHAIN_IDS.SCROLL.toLowerCase()]:r.SupportedEVMChain.Scroll,[s.CHAIN_IDS.SEPOLIA.toLowerCase()]:r.SupportedEVMChain.EthereumSepolia,"0x27bc86aa":r.SupportedEVMChain.Degen,[s.CHAIN_IDS.AVALANCHE_TESTNET.toLowerCase()]:r.SupportedEVMChain.AvalancheFuji,"0x343b":r.SupportedEVMChain.ImmutableZkevm,"0x34a1":r.SupportedEVMChain.ImmutableZkevmTestnet,[s.CHAIN_IDS.GNOSIS.toLowerCase()]:r.SupportedEVMChain.Gnosis,"0x1e0":r.SupportedEVMChain.Worldchain,"0x79a":r.SupportedEVMChain.SoneiumMinato,"0x7e4":r.SupportedEVMChain.Ronin,[s.CHAIN_IDS.APECHAIN_MAINNET.toLowerCase()]:r.SupportedEVMChain.ApeChain,"0x849ea":r.SupportedEVMChain.ZeroNetwork,[s.CHAIN_IDS.BERACHAIN.toLowerCase()]:r.SupportedEVMChain.Berachain,"0x138c5":r.SupportedEVMChain.BerachainBartio,[s.CHAIN_IDS.INK.toLowerCase()]:r.SupportedEVMChain.Ink,[s.CHAIN_IDS.INK_SEPOLIA.toLowerCase()]:r.SupportedEVMChain.InkSepolia,"0xab5":r.SupportedEVMChain.Abstract,"0x2b74":r.SupportedEVMChain.AbstractTestnet,"0x74c":r.SupportedEVMChain.Soneium,[s.CHAIN_IDS.UNICHAIN.toLowerCase()]:r.SupportedEVMChain.Unichain,[s.CHAIN_IDS.SEI.toLowerCase()]:r.SupportedEVMChain.Sei,[s.CHAIN_IDS.FLOW.toLowerCase()]:r.SupportedEVMChain.FlowEvm};function c(e){return"string"==typeof e&&e?o[e.toLowerCase()]:undefined}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/trust-signals-util.ts"}],[29,{"@metamask/assets-controllers":1157},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DeFiPositionsControllerInit=void 0;var s=e("@metamask/assets-controllers");n.DeFiPositionsControllerInit=({initMessenger:e,controllerMessenger:t,getController:n})=>({controller:new s.DeFiPositionsController({messenger:t,isEnabled:()=>{var t;const s=n("PreferencesController"),{useExternalServices:a}=s.state,i=e.call("RemoteFeatureFlagController:getState"),r=Boolean(null==i||null===(t=i.remoteFeatureFlags)||void 0===t?void 0:t.assetsDefiPositionsEnabled);return a&&r},trackEvent:e.call.bind(e,"MetaMetricsController:trackEvent")})})}}},{package:"$root$",file:"app/scripts/controller-init/defi-positions/defi-positions-controller-init.ts"}],[2909,{"@metamask/eth-sig-util":1833,tslib:5321},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.transformTypedData=void 0;const s=e("tslib").__importStar(e("@metamask/eth-sig-util"));function a(e){switch(Object.prototype.toString.call(e)){case"[object Object]":{const t=Object.keys(e).map(t=>[t,a(e[t])]);return Object.fromEntries(t)}case"[object Array]":return e.map(e=>a(e));case"[object BigInt]":return e.toString();default:return e}}n.transformTypedData=(e,t)=>{if(!t)throw new Error("Trezor: Only version 4 of typed data signing is supported");const n=s.SignTypedDataVersion.V4,{types:i,primaryType:r,domain:o,message:c}=s.TypedDataUtils.sanitizeData(e),l=s.TypedDataUtils.hashStruct("EIP712Domain",a(o),i,n).toString("hex");let u=null;return"EIP712Domain"!==r&&(u=s.TypedDataUtils.hashStruct(r,a(c),i,n).toString("hex")),Object.assign({domain_separator_hash:l,message_hash:u},e)},n.default=n.transformTypedData}}},{package:"@metamask/eth-trezor-keyring>@trezor/connect-plugin-ethereum",file:"node_modules/@trezor/connect-plugin-ethereum/lib/index.js"}]],[],{});