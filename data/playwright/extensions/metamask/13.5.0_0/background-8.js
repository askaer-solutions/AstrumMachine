LavaPack.loadBundle([[864,{"./errors":865,"./modules/Domains":866,"./modules/EIP712":867,"./services/ledger":874,"./utils":877,"@ethersproject/transactions":723,"@ledgerhq/logs":882,"bignumber.js":878,buffer:3760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ledgerService=void 0;const a=e("@ledgerhq/logs"),l=e("bignumber.js"),c=e("@ethersproject/transactions"),d=e("./errors"),u=e("./modules/EIP712"),f=e("./modules/Domains"),p=i(e("./services/ledger"));r.ledgerService=p.default;const h=e("./utils");o(e("./utils"),r);const g={eth:1,erc20:2,erc721:3,erc20mintable:4,erc721mintable:5},m=e=>e&&27264===e.statusCode?new d.EthAppPleaseEnableContractData("Please enable Blind signing or Contract data in the Ethereum app Settings"):e;r.default=class{setLoadConfig(e){this.loadConfig=e}constructor(e,t="w0w",r={}){this.transport=e,this.loadConfig=r,e.decorateAppAPIMethods(this,["getAddress","signTransaction","signPersonalMessage","getAppConfiguration","signEIP712Message","signEIP712HashedMessage","starkGetPublicKey","starkSignOrder","starkSignOrder_v2","starkSignTransfer","starkSignTransfer_v2","starkProvideQuantum","starkProvideQuantum_v2","starkUnsafeSign","eth2GetPublicKey","eth2SetWithdrawalIndex","getEIP1024PublicEncryptionKey","getEIP1024SharedSecret"],t)}getAddress(e,r,n,o){const s=(0,h.splitPath)(e);let i=t.alloc(1+4*s.length);if(i[0]=s.length,s.forEach((e,t)=>{i.writeUInt32BE(e,1+4*t)}),o){const e=t.alloc(8,0),r=t.from((0,h.padHexString)(new l.BigNumber(o).toString(16)),"hex");e.write(r.toString("hex"),e.length-r.length,"hex"),i=t.concat([i,e])}return this.transport.send(224,2,r?1:0,n?1:0,i).then(e=>{const t=e[0],r=e[1+t];return{publicKey:e.slice(1,1+t).toString("hex"),address:"0x"+e.slice(1+t+1,1+t+1+r).toString("ascii"),chainCode:n?e.slice(1+t+1+r,1+t+1+r+32).toString("hex"):undefined}})}signTransaction(e,r,n){return s(this,void 0,void 0,function*(){let o;if(function(e){e[e.CLA=224]="CLA",e[e.INS=4]="INS",e[e.P1_FIRST_CHUNK=0]="P1_FIRST_CHUNK",e[e.P1_FOLLOWING_CHUNK=128]="P1_FOLLOWING_CHUNK",e[e.P2=0]="P2"}(o||(o={})),n===undefined&&(console.warn("hw-app-eth: signTransaction(path, rawTxHex, resolution): please provide the 'resolution' parameter. See https://github.com/LedgerHQ/ledgerjs/blob/master/packages/hw-app-eth/README.md â€“ the previous signature is deprecated and providing the 3rd 'resolution' parameter explicitly will become mandatory so you have the control on the resolution and the fallback mecanism (e.g. fallback to blind signing or not).// Possible solution:\n + import { ledgerService } from '@ledgerhq/hw-app-eth';\n + const resolution = await ledgerService.resolveTransaction(rawTxHex);"),n=yield p.default.resolveTransaction(r,this.loadConfig,{externalPlugins:!0,erc20:!0,uniswapV3:!1}).catch(e=>(console.warn("an error occurred in resolveTransaction => fallback to blind signing: "+String(e)),null))),n){for(const e of n.domains)yield(0,f.domainResolutionFlow)(this,e).catch(t=>{(0,a.log)("error","domainResolutionFlow failed",{domainDescriptor:e,error:t})});for(const e of n.plugin)yield this.setPlugin(e);for(const{payload:e,signature:t}of n.externalPlugin)yield this.setExternalPlugin(e,t);for(const e of n.nfts)yield this.provideNFTInformation(e);for(const e of n.erc20Tokens)yield this.provideERC20TokenInformation(e)}const s=t.from(r,"hex"),i=(0,c.parse)(`0x${s.toString("hex")}`),d=new l.BigNumber(i.chainId),u=(0,h.splitPath)(e),g=t.alloc(1+4*u.length);g[0]=u.length,u.forEach((e,t)=>{g.writeUInt32BE(e,1+4*t)});const E=(0,h.safeChunkTransaction)(s,g,i.type);let _;for(const e of E){const t=e===E[0];_=yield this.transport.send(o.CLA,o.INS,t?o.P1_FIRST_CHUNK:o.P1_FOLLOWING_CHUNK,o.P2,e).catch(e=>{throw m(e)})}return{v:(0,h.getV)(_[0],d,i.type),r:_.subarray(1,33).toString("hex"),s:_.subarray(33,65).toString("hex")}})}clearSignTransaction(e,t,r){return s(this,arguments,void 0,function*(e,t,r,n=!1){const o=yield p.default.resolveTransaction(t,this.loadConfig,r).catch(e=>{if(console.warn("an error occurred in resolveTransaction => fallback to blind signing: "+String(e)),n)throw e;return null});return this.signTransaction(e,t,o)})}getAppConfiguration(){return this.transport.send(224,6,0,0).then(e=>({arbitraryDataEnabled:1&e[0],erc20ProvisioningNecessary:2&e[0],starkEnabled:4&e[0],starkv2Supported:8&e[0],version:e[1]+"."+e[2]+"."+e[3]}))}signPersonalMessage(e,r){return s(this,void 0,void 0,function*(){const n=(0,h.splitPath)(e);let o=0;const s=t.from(r,"hex");let i;for(;o!==s.length;){const e=0===o?149-4*n.length-4:150,r=o+e>s.length?s.length-o:e,a=t.alloc(0===o?1+4*n.length+4+r:r);0===o?(a[0]=n.length,n.forEach((e,t)=>{a.writeUInt32BE(e,1+4*t)}),a.writeUInt32BE(s.length,1+4*n.length),s.copy(a,1+4*n.length+4,o,o+r)):s.copy(a,0,o,o+r),i=yield this.transport.send(224,8,0===o?0:128,0,a),o+=r}return{v:i[0],r:i.slice(1,33).toString("hex"),s:i.slice(33,65).toString("hex")}})}signEIP712HashedMessage(e,t,r){return(0,u.signEIP712HashedMessage)(this.transport,e,t,r)}signEIP712Message(e,t){return s(this,arguments,void 0,function*(e,t,r=!1){return(0,u.signEIP712Message)(this.transport,e,t,r,this.loadConfig)})}getChallenge(){return s(this,void 0,void 0,function*(){let e;return function(e){e[e.CLA=224]="CLA",e[e.INS=32]="INS",e[e.P1=0]="P1",e[e.P2=0]="P2",e[e.LC=0]="LC"}(e||(e={})),this.transport.send(e.CLA,e.INS,e.P1,e.P2).then(e=>{const[,t,r]=new RegExp("(.*)(.{4}$)").exec(e.toString("hex"))||[];if("9000"!==r)throw new Error(`An error happened while generating the challenge. Status code: ${r}`);return`0x${t}`}).catch(e=>{throw(0,a.log)("error","couldn't request a challenge",e),e})})}starkGetPublicKey(e,r){const n=(0,h.splitPath)(e),o=t.alloc(1+4*n.length);return o[0]=n.length,n.forEach((e,t)=>{o.writeUInt32BE(e,1+4*t)}),this.transport.send(240,2,r?1:0,0,o).then(e=>e.slice(0,e.length-2))}starkSignOrder(e,r,n,o,s,i,a,l,c,d,u){const f=(0,h.maybeHexBuffer)(r),p=(0,h.maybeHexBuffer)(o),g=(0,h.splitPath)(e),m=t.alloc(1+4*g.length+20+32+20+32+4+4+8+8+4+4,0);let E=0;return m[0]=g.length,g.forEach((e,t)=>{m.writeUInt32BE(e,1+4*t)}),E=1+4*g.length,f&&f.copy(m,E),E+=20,t.from(n.toString(16).padStart(64,"0"),"hex").copy(m,E),E+=32,p&&p.copy(m,E),E+=20,t.from(s.toString(16).padStart(64,"0"),"hex").copy(m,E),E+=32,m.writeUInt32BE(i,E),E+=4,m.writeUInt32BE(a,E),E+=4,t.from(l.toString(16).padStart(16,"0"),"hex").copy(m,E),E+=8,t.from(c.toString(16).padStart(16,"0"),"hex").copy(m,E),E+=8,m.writeUInt32BE(d,E),E+=4,m.writeUInt32BE(u,E),this.transport.send(240,4,1,0,m).then(e=>({r:e.slice(1,33).toString("hex"),s:e.slice(33,65).toString("hex")}))}starkSignOrder_v2(e,r,n,o,s,i,a,l,c,d,u,f,p,m,E){const _=(0,h.maybeHexBuffer)(r),S=(0,h.maybeHexBuffer)(i);if(!(n in g))throw new Error("eth.starkSignOrderv2 invalid source quantization type="+n);if(!(a in g))throw new Error("eth.starkSignOrderv2 invalid destination quantization type="+a);const A=(0,h.splitPath)(e),P=t.alloc(1+4*A.length+1+20+32+32+1+20+32+32+4+4+8+8+4+4,0);let v=0;return P[0]=A.length,A.forEach((e,t)=>{P.writeUInt32BE(e,1+4*t)}),v=1+4*A.length,P[v]=g[n],v++,_&&_.copy(P,v),v+=20,o&&t.from(o.toString(16).padStart(64,"0"),"hex").copy(P,v),v+=32,s&&t.from(s.toString(16).padStart(64,"0"),"hex").copy(P,v),v+=32,P[v]=g[a],v++,S&&S.copy(P,v),v+=20,l&&t.from(l.toString(16).padStart(64,"0"),"hex").copy(P,v),v+=32,c&&t.from(c.toString(16).padStart(64,"0"),"hex").copy(P,v),v+=32,P.writeUInt32BE(d,v),v+=4,P.writeUInt32BE(u,v),v+=4,t.from(f.toString(16).padStart(16,"0"),"hex").copy(P,v),v+=8,t.from(p.toString(16).padStart(16,"0"),"hex").copy(P,v),v+=8,P.writeUInt32BE(m,v),v+=4,P.writeUInt32BE(E,v),this.transport.send(240,4,3,0,P).then(e=>({r:e.slice(1,33).toString("hex"),s:e.slice(33,65).toString("hex")}))}starkSignTransfer(e,r,n,o,s,i,a,l,c){const d=(0,h.maybeHexBuffer)(r),u=(0,h.hexBuffer)(o),f=(0,h.splitPath)(e),p=t.alloc(1+4*f.length+20+32+32+4+4+8+4+4,0);let g=0;return p[0]=f.length,f.forEach((e,t)=>{p.writeUInt32BE(e,1+4*t)}),g=1+4*f.length,d&&d.copy(p,g),g+=20,t.from(n.toString(16).padStart(64,"0"),"hex").copy(p,g),g+=32,u.copy(p,g),g+=32,p.writeUInt32BE(s,g),g+=4,p.writeUInt32BE(i,g),g+=4,t.from(a.toString(16).padStart(16,"0"),"hex").copy(p,g),g+=8,p.writeUInt32BE(l,g),g+=4,p.writeUInt32BE(c,g),this.transport.send(240,4,2,0,p).then(e=>({r:e.slice(1,33).toString("hex"),s:e.slice(33,65).toString("hex")}))}starkSignTransfer_v2(e,r,n,o,s,i,a,l,c,d,u,f,p){const m=(0,h.maybeHexBuffer)(r),E=(0,h.hexBuffer)(i),_=(0,h.maybeHexBuffer)(f);if(!(n in g))throw new Error("eth.starkSignTransferv2 invalid quantization type="+n);const S=(0,h.splitPath)(e),A=t.alloc(1+4*S.length+1+20+32+32+32+4+4+8+4+4+(_?52:0),0);let P=0;return A[0]=S.length,S.forEach((e,t)=>{A.writeUInt32BE(e,1+4*t)}),P=1+4*S.length,A[P]=g[n],P++,m&&m.copy(A,P),P+=20,o&&t.from(o.toString(16).padStart(64,"0"),"hex").copy(A,P),P+=32,s&&t.from(s.toString(16).padStart(64,"0"),"hex").copy(A,P),P+=32,E.copy(A,P),P+=32,A.writeUInt32BE(a,P),P+=4,A.writeUInt32BE(l,P),P+=4,t.from(c.toString(16).padStart(16,"0"),"hex").copy(A,P),P+=8,A.writeUInt32BE(d,P),P+=4,A.writeUInt32BE(u,P),_&&p&&(P+=4,t.from(p.toString(16).padStart(64,"0"),"hex").copy(A,P),P+=32,_.copy(A,P)),this.transport.send(240,4,_?5:4,0,A).then(e=>({r:e.slice(1,33).toString("hex"),s:e.slice(33,65).toString("hex")}))}starkProvideQuantum(e,r){const n=(0,h.maybeHexBuffer)(e),o=t.alloc(52,0);return n&&n.copy(o,0),t.from(r.toString(16).padStart(64,"0"),"hex").copy(o,20),this.transport.send(240,8,0,0,o).then(()=>!0,e=>{if(e&&27904===e.statusCode)return!1;throw e})}starkProvideQuantum_v2(e,r,n,o){const s=(0,h.maybeHexBuffer)(e);if(!(r in g))throw new Error("eth.starkProvideQuantumV2 invalid quantization type="+r);const i=t.alloc(84,0);let a=0;return s&&s.copy(i,a),a+=20,n&&t.from(n.toString(16).padStart(64,"0"),"hex").copy(i,a),a+=32,o&&t.from(o.toString(16).padStart(64,"0"),"hex").copy(i,a),this.transport.send(240,8,g[r],0,i).then(()=>!0,e=>{if(e&&27904===e.statusCode)return!1;throw e})}starkUnsafeSign(e,r){const n=(0,h.hexBuffer)(r),o=(0,h.splitPath)(e),s=t.alloc(1+4*o.length+32);let i=0;return s[0]=o.length,o.forEach((e,t)=>{s.writeUInt32BE(e,1+4*t)}),i=1+4*o.length,n.copy(s,i),this.transport.send(240,10,0,0,s).then(e=>({r:e.slice(1,33).toString("hex"),s:e.slice(33,65).toString("hex")}))}eth2GetPublicKey(e,r){const n=(0,h.splitPath)(e),o=t.alloc(1+4*n.length);return o[0]=n.length,n.forEach((e,t)=>{o.writeUInt32BE(e,1+4*t)}),this.transport.send(224,14,r?1:0,0,o).then(e=>({publicKey:e.slice(0,-2).toString("hex")}))}eth2SetWithdrawalIndex(e){const r=t.alloc(4,0);return r.writeUInt32BE(e,0),this.transport.send(224,16,0,0,r).then(()=>!0,e=>{if(e&&27904===e.statusCode)return!1;throw e})}getEIP1024PublicEncryptionKey(e,r){const n=(0,h.splitPath)(e),o=t.alloc(1+4*n.length);return o[0]=n.length,n.forEach((e,t)=>{o.writeUInt32BE(e,1+4*t)}),this.transport.send(224,24,r?1:0,0,o).then(e=>({publicKey:e.slice(0,-2).toString("hex")}))}getEIP1024SharedSecret(e,r,n){const o=(0,h.splitPath)(e),s=(0,h.hexBuffer)(r),i=t.alloc(1+4*o.length+32);let a=0;return i[0]=o.length,o.forEach((e,t)=>{i.writeUInt32BE(e,1+4*t)}),a=1+4*o.length,s.copy(i,a),this.transport.send(224,24,n?1:0,1,i).then(e=>({sharedSecret:e.slice(0,-2).toString("hex")}))}provideERC20TokenInformation(e){const r=t.from(e,"hex");return this.transport.send(224,10,0,0,r).then(()=>!0,e=>{if(e&&27904===e.statusCode)return!1;throw e})}setExternalPlugin(e,r){const n=t.from(e,"hex"),o=t.from(null!=r?r:"","hex"),s=t.concat([n,o]);return this.transport.send(224,18,0,0,s).then(()=>!0,e=>{if(e&&27264===e.statusCode)return!1;if(e&&27012===e.statusCode)return!1;if(e&&27904===e.statusCode)return!1;throw e})}setPlugin(e){const r=t.from(e,"hex");return this.transport.send(224,22,0,0,r).then(()=>!0,e=>{if(e&&27264===e.statusCode)return!1;if(e&&27012===e.statusCode)return!1;if(e&&27904===e.statusCode)return!1;throw e})}provideNFTInformation(e){const r=t.from(e,"hex");return this.transport.send(224,20,0,0,r).then(()=>!0,e=>{if(e&&27904===e.statusCode)throw new d.EthAppNftNotSupported;throw e})}provideDomainName(e){return s(this,void 0,void 0,function*(){let r;!function(e){e[e.CLA=224]="CLA",e[e.INS=34]="INS",e[e.P1_FIRST_CHUNK=1]="P1_FIRST_CHUNK",e[e.P1_FOLLOWING_CHUNK=0]="P1_FOLLOWING_CHUNK",e[e.P2=0]="P2"}(r||(r={}));const n=t.from(e,"hex"),o=t.concat([t.from((0,h.intAsHexBytes)(n.length,2),"hex"),n]),s=new Array(Math.ceil(o.length/256)).fill(null).map((e,t)=>o.slice(255*t,255*(t+1)));for(const e of s){const t=e===s[0];yield this.transport.send(r.CLA,r.INS,t?r.P1_FIRST_CHUNK:r.P1_FOLLOWING_CHUNK,r.P2,e)}return!0})}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/Eth.js"}],[865,{"@ledgerhq/errors":860},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.EthAppNftNotSupported=r.EthAppPleaseEnableContractData=void 0;const n=e("@ledgerhq/errors");r.EthAppPleaseEnableContractData=(0,n.createCustomErrorClass)("EthAppPleaseEnableContractData"),r.EthAppNftNotSupported=(0,n.createCustomErrorClass)("EthAppNftNotSupported")}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/errors.js"}],[866,{"../../services/ledger":874},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.domainResolutionFlow=void 0;const s=o(e("../../services/ledger"));r.domainResolutionFlow=(e,t)=>n(void 0,void 0,void 0,function*(){if(!t)return;const{domain:r,address:n,registry:o,type:i}=t,a=yield e.getChallenge(),l="forward"===i?yield s.default.signDomainResolution(r,o,a):yield s.default.signAddressResolution(n,o,a);l&&(yield e.provideDomainName(l))})}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/Domains/index.js"}],[867,{"../../services/ledger/erc20":873,"../../services/ledger/loadConfig":875,"../../utils":877,"./utils":868,"@ledgerhq/evm-tools/lib/message/EIP712/index":861,buffer:3760,semver:5252},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.signEIP712HashedMessage=r.signEIP712Message=void 0;const s=o(e("semver")),i=e("@ledgerhq/evm-tools/lib/message/EIP712/index"),a=e("../../services/ledger/erc20"),l=e("../../utils"),c=e("../../services/ledger/loadConfig"),d=e("./utils"),u=(e,r)=>{let n;!function(e){e[e.CLA=224]="CLA",e[e.INS=26]="INS",e[e.P1_complete=0]="P1_complete",e[e.P1_partial=1]="P1_partial",e[e.P2_name=0]="P2_name",e[e.P2_field=255]="P2_field"}(n||(n={}));const{structType:o,value:s}=r,i="name"===o&&"string"==typeof s?t.from(s,"utf-8"):s;return e.send(n.CLA,n.INS,n.P1_complete,"name"===o?n.P2_name:n.P2_field,i)},f=(e,r)=>n(void 0,void 0,void 0,function*(){var n;let o;!function(e){e[e.CLA=224]="CLA",e[e.INS=28]="INS",e[e.P1_complete=0]="P1_complete",e[e.P1_partial=1]="P1_partial",e[e.P2_root=0]="P2_root",e[e.P2_array=15]="P2_array",e[e.P2_field=255]="P2_field"}(o||(o={}));const{structType:s,value:i}=r;if("root"===s)return e.send(o.CLA,o.INS,o.P1_complete,o.P2_root,t.from(i,"utf-8"));if("array"===s)return e.send(o.CLA,o.INS,o.P1_complete,o.P2_array,t.from((0,l.intAsHexBytes)(i,1),"hex"));if("field"===s){const{data:r,type:s,sizeInBits:a}=i,c=null===(n=d.EIP712_TYPE_ENCODERS[s.toUpperCase()])||void 0===n?void 0:n.call(d.EIP712_TYPE_ENCODERS,r,a);if(c){const r=Math.floor(c.length/256),n=c.length%256,s=t.concat([t.from((0,l.intAsHexBytes)(r,1),"hex"),t.from((0,l.intAsHexBytes)(n,1),"hex"),c]),i=new Array(Math.ceil(s.length/256)).fill(null).map((e,t)=>s.subarray(255*t,255*(t+1)));for(const t of i)yield e.send(o.CLA,o.INS,t!==i[i.length-1]?o.P1_partial:o.P1_complete,o.P2_field,t)}}return Promise.resolve()});function p(e,r,o,s){return n(this,void 0,void 0,function*(){let n;switch(function(e){e[e.CLA=224]="CLA",e[e.INS=30]="INS",e[e.P1_standard=0]="P1_standard",e[e.P1_discarded=1]="P1_discarded",e[e.P2_activate=0]="P2_activate",e[e.P2_discarded=1]="P2_discarded",e[e.P2_show_field=255]="P2_show_field",e[e.P2_message_info=15]="P2_message_info",e[e.P2_datetime=252]="P2_datetime",e[e.P2_amount_join_token=253]="P2_amount_join_token",e[e.P2_amount_join_value=254]="P2_amount_join_value",e[e.P2_raw=255]="P2_raw"}(n||(n={})),r){case"activate":return e.send(n.CLA,n.INS,n.P1_discarded,n.P2_activate);case"contractName":{const{displayName:r,filtersCount:o,sig:i}=s,{displayNameBuffer:a,sigBuffer:c}=(0,d.getFilterDisplayNameAndSigBuffers)(r,i),u=t.from((0,l.intAsHexBytes)(o,1),"hex"),f=t.concat([a,u,c]);return e.send(n.CLA,n.INS,n.P1_standard,n.P2_message_info,f)}case"showField":{const{displayName:r,sig:o,format:i,coinRef:l,chainId:c,coinRefsTokensMap:u,shouldUseV1Filters:f,erc20SignaturesBlob:p,isDiscarded:h}=s,{displayNameBuffer:g,sigBuffer:m}=(0,d.getFilterDisplayNameAndSigBuffers)(r,o);if(f){const r=t.concat([g,m]);return e.send(n.CLA,n.INS,n.P1_standard,n.P2_show_field,r)}if("token"===i&&l!==undefined){const{token:t,deviceTokenIndex:r}=u[l];if(r===undefined){const r=yield(0,a.byContractAddressAndChainId)(t,c,p);if(r){let t;!function(e){e[e.CLA=224]="CLA",e[e.INS=10]="INS",e[e.P1=0]="P1",e[e.P2=0]="P2"}(t||(t={}));const n=yield e.send(t.CLA,t.INS,t.P1,t.P2,r.data);u[l].deviceTokenIndex=n[0]}}}if("amount"===i&&255===l){const{token:t}=u[255],r=yield(0,a.byContractAddressAndChainId)(t,c,p);r&&(yield e.send(224,10,0,0,r.data),u[255].deviceTokenIndex=255)}if(!i)throw new Error("Missing format");const E={raw:n.P2_raw,datetime:n.P2_datetime,token:n.P2_amount_join_token,amount:n.P2_amount_join_value},_=(0,d.getPayloadForFilterV2)(i,l,u,g,m);return e.send(n.CLA,n.INS,h?n.P1_discarded:n.P1_standard,E[i],_)}case"discardField":{const{path:r}=s,o=t.from(r),i=t.from((0,l.intAsHexBytes)(o.length,1),"hex"),a=t.concat([i,o]);return e.send(n.CLA,n.INS,n.P1_standard,n.P2_discarded,a)}}})}r.signEIP712Message=(e,r,o,...h)=>n(void 0,[e,r,o,...h],void 0,function*(e,r,o,h=!1,g){let m;!function(e){e[e.CLA=224]="CLA",e[e.INS=12]="INS",e[e.P1=0]="P1",e[e.P2_v0=0]="P2_v0",e[e.P2_full=1]="P2_full"}(m||(m={}));const{primaryType:E,types:_,domain:S,message:A}=o,{calServiceURL:P}=(0,c.getLoadConfig)(g),v=(0,i.sortObjectAlphabetically)(_),{version:C}=yield(0,d.getAppAndVersion)(e),T=!s.default.gte(C,"1.11.1-0",{includePrerelease:!0}),I=s.default.gte(C,"1.12.0-0",{includePrerelease:!0}),b=yield(0,i.getFiltersForMessage)(o,T,P),y=(0,d.getCoinRefTokensMap)(b,T,o),w=Object.entries(v);for(const[t,r]of w){yield u(e,{structType:"name",value:t});for(const{name:t,type:n}of r){const r=(0,d.makeTypeEntryStructBuffer)({name:t,type:n});yield u(e,{structType:"field",value:r})}}b&&(yield p(e,"activate"));const N=T?undefined:yield(0,a.findERC20SignaturesInfo)(g,S.chainId||0),O=(({transport:e,loadConfig:t,chainId:r,erc20SignaturesBlob:o,types:s,filters:i,shouldUseV1Filters:a,shouldUseDiscardedFields:l,coinRefsTokensMap:c})=>{var u;const h={};for(const e in s)h[e]=null===(u=s[e])||void 0===u?void 0:u.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.type}),{});const g=(t,s,...u)=>n(void 0,[t,s,...u],void 0,function*(t,n,s=""){var u,m;const[E,_]=t,[S,...A]=_,P=!d.EIP712_TYPE_PROPERTIES[(null===(u=null==E?void 0:E.name)||void 0===u?void 0:u.toUpperCase())||""];if(Array.isArray(n)&&void 0!==S){yield f(e,{structType:"array",value:n.length});const t=`${s}.[]`;if(!n.length){const n=null==i?void 0:i.fields.filter(e=>e.path.startsWith(t));if(n&&l)for(const t of n)yield p(e,"discardField",0,{path:t.path}),yield p(e,"showField",0,{displayName:t.label,sig:t.signature,format:t.format,coinRef:t.coin_ref,chainId:r,erc20SignaturesBlob:o,shouldUseV1Filters:a,coinRefsTokensMap:c,isDiscarded:!0})}for(const e of n)yield g([E,A],e,t)}else if(P)for(const e of Object.keys(h[(null==E?void 0:E.name)||""])){const t=n[e],r=null===(m=h[(null==E?void 0:E.name)||""])||void 0===m?void 0:m[e];r&&(yield g((0,d.destructTypeFromString)(r),t,`${s}.${e}`))}else{const t=null==i?void 0:i.fields.find(e=>s===e.path);t&&(yield p(e,"showField",0,{displayName:t.label,sig:t.signature,format:t.format,coinRef:t.coin_ref,chainId:r,erc20SignaturesBlob:o,shouldUseV1Filters:a,coinRefsTokensMap:c,isDiscarded:!1})),yield f(e,{structType:"field",value:{data:n,type:(null==E?void 0:E.name)||"",sizeInBits:null==E?void 0:E.size}})}});return g})({transport:e,loadConfig:g,chainId:S.chainId||0,erc20SignaturesBlob:N,types:v,filters:b,shouldUseV1Filters:T,shouldUseDiscardedFields:I,coinRefsTokensMap:y}),R="EIP712Domain";yield f(e,{structType:"root",value:R});const M=v[R];for(const{name:e,type:t}of M){const r=S[e];yield O((0,d.destructTypeFromString)(t),r)}if(b){const{contractName:t,fields:r}=b,n={displayName:t.label,filtersCount:r.length,sig:t.signature};yield p(e,"contractName",0,n)}yield f(e,{structType:"root",value:E});const x=v[E];for(const{name:e,type:t}of x){const r=A[e];yield O((0,d.destructTypeFromString)(t),r,e)}const L=(0,l.splitPath)(r),k=t.alloc(1+4*L.length);return k[0]=L.length,L.forEach((e,t)=>{k.writeUInt32BE(e,1+4*t)}),e.send(m.CLA,m.INS,m.P1,h?m.P2_v0:m.P2_full,k).then(e=>({v:e[0],r:e.subarray(1,33).toString("hex"),s:e.subarray(33,65).toString("hex")}))});r.signEIP712HashedMessage=(e,r,n,o)=>{const s=(0,l.hexBuffer)(n),i=(0,l.hexBuffer)(o),a=(0,l.splitPath)(r),c=t.alloc(1+4*a.length+32+32,0);let d=0;return c[0]=a.length,a.forEach((e,t)=>{c.writeUInt32BE(e,1+4*t)}),d=1+4*a.length,s.copy(c,d),d+=32,i.copy(c,d),e.send(224,12,0,0,c).then(e=>({v:e[0],r:e.subarray(1,33).toString("hex"),s:e.subarray(33,65).toString("hex")}))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/EIP712/index.js"}],[868,{"../../utils":877,"@ledgerhq/evm-tools/lib/message/index":862,"bignumber.js":878,buffer:3760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.getPayloadForFilterV2=r.getFilterDisplayNameAndSigBuffers=r.getAppAndVersion=r.getCoinRefTokensMap=r.makeTypeEntryStructBuffer=r.constructTypeDescByteString=r.destructTypeFromString=r.EIP712_TYPE_ENCODERS=r.EIP712_TYPE_PROPERTIES=void 0;const s=o(e("bignumber.js")),i=e("@ledgerhq/evm-tools/lib/message/index"),a=e("../../utils");var l;!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.FIXED=1]="FIXED"}(l||(l={})),r.EIP712_TYPE_PROPERTIES={CUSTOM:{key:()=>0,size:()=>null},INT:{key:()=>1,size:e=>Number(e)/8},UINT:{key:()=>2,size:e=>Number(e)/8},ADDRESS:{key:()=>3,size:()=>null},BOOL:{key:()=>4,size:()=>null},STRING:{key:()=>5,size:()=>null},BYTES:{key:e=>void 0!==e?6:7,size:e=>void 0!==e?Number(e):null}},r.EIP712_TYPE_ENCODERS={INT(e,r=256){const n=null!=e?e:"0";if("string"==typeof n&&(null==n?void 0:n.startsWith("0x")))return(0,a.hexBuffer)(n);let o=new s.default(n);if(o.lt(0)){const e=r/8;o=new s.default(`0x${t.alloc(e,255).toString("hex")}`).plus(o).plus(1)}const i=o.toString(16).length%2?"0"+o.toString(16):o.toString(16);return t.from(i,"hex")},UINT(e){return this.INT(e)},BOOL(e){return this.INT("boolean"==typeof e?Number(e).toString():e)},ADDRESS:e=>(0,a.hexBuffer)(null!=e?e:"").slice(0,20),STRING:e=>t.from(null!=e?e:"","utf-8"),BYTES(e,t){const r=null!=e?e:"";return(0,a.hexBuffer)(r).slice(0,null!=t?t:((null==r?void 0:r.length)-2)/2)}};r.destructTypeFromString=e=>{const t=new RegExp(/^([^[\]]*)(\[.*\])*/g),r=new RegExp(/\[(\d*)\]/g),n=new RegExp(/(?=u?int|bytes)([a-zA-Z-0-9]+?)(\d{1,3})$/g),[,o,s]=t.exec(e||"")||[],[,i=o,a]=n.exec(o||"")||[];return[i?{name:i,size:a?Number(a):undefined}:null,(s?[...s.matchAll(r)]:[]).map(([,e])=>e?Number(e):null)]};r.constructTypeDescByteString=(e,t,r)=>{if(r>=16)throw new Error("Eth utils - constructTypeDescByteString - Cannot accept a typeValue >= 16 because the typeValue can only be 4 bits in binary"+{isArray:e,typeSize:t,typeValue:r});const n=e?"1":"0",o="number"==typeof t?"1":"0",s=r.toString(2).padStart(4,"0");return(0,a.intAsHexBytes)(parseInt(n+o+"00"+s,2),1)};r.makeTypeEntryStructBuffer=({name:e,type:n})=>{var o,s,i,c;const[d,u]=(0,r.destructTypeFromString)(n),f=Boolean(u.length),p=r.EIP712_TYPE_PROPERTIES[(null===(o=null==d?void 0:d.name)||void 0===o?void 0:o.toUpperCase())||""]||r.EIP712_TYPE_PROPERTIES.CUSTOM,h=p.key(null==d?void 0:d.size),g=p.size(null==d?void 0:d.size),m=(0,r.constructTypeDescByteString)(f,g,h),E=[t.from(m,"hex")];return p===r.EIP712_TYPE_PROPERTIES.CUSTOM&&(E.push(t.from((0,a.intAsHexBytes)(null!==(i=null===(s=null==d?void 0:d.name)||void 0===s?void 0:s.length)&&void 0!==i?i:0,1),"hex")),E.push(t.from(null!==(c=null==d?void 0:d.name)&&void 0!==c?c:"","utf-8"))),"number"==typeof g&&E.push(t.from((0,a.intAsHexBytes)(g,1),"hex")),f&&(E.push(t.from((0,a.intAsHexBytes)(u.length,1),"hex")),u.forEach(e=>{"number"==typeof e?E.push(t.from((0,a.intAsHexBytes)(l.FIXED,1),"hex"),t.from((0,a.intAsHexBytes)(e,1),"hex")):E.push(t.from((0,a.intAsHexBytes)(l.DYNAMIC,1),"hex"))})),E.push(t.from((0,a.intAsHexBytes)(e.length,1),"hex"),t.from(e,"utf-8")),t.concat(E)};r.getCoinRefTokensMap=(e,t,r)=>{const n={};if(t||!e)return n;const o=e.fields.filter(({format:e})=>"token"===e).sort((e,t)=>(e.coin_ref||0)-(t.coin_ref||0)).reduce((e,t)=>{const n=(0,i.getValueFromPath)(t.path,r);if(Array.isArray(n))throw new Error("Array of tokens is not supported with a single coin ref");return[...e,{token:n,coinRef:t.coin_ref}]},[]);for(const{token:e,coinRef:t}of o)n[t]={token:e};return e.fields.some(e=>"amount"===e.format&&255===e.coin_ref)&&r.domain.verifyingContract&&(n[255]={token:r.domain.verifyingContract}),n};r.getAppAndVersion=e=>n(void 0,void 0,void 0,function*(){const t=yield e.send(176,1,0,0);let r=1;const n=t[r];r+=1;const o=t.subarray(r,r+n).toString("ascii");r+=n;const s=t[r];r+=1;return{name:o,version:t.subarray(r,r+s).toString("ascii")}});r.getFilterDisplayNameAndSigBuffers=(e,r)=>{const n=t.from(e),o=t.from((0,a.intAsHexBytes)(n.length,1),"hex"),s=t.from(r,"hex"),i=t.from((0,a.intAsHexBytes)(s.length,1),"hex");return{displayNameBuffer:t.concat([o,n]),sigBuffer:t.concat([i,s])}};r.getPayloadForFilterV2=(e,r,n,o,s)=>{switch(e){case"raw":case"datetime":return t.concat([o,s]);case"token":{const{deviceTokenIndex:e}=n[r];return t.concat([t.from((0,a.intAsHexBytes)(e||r||0,1),"hex"),s])}case"amount":{const{deviceTokenIndex:e}=n[r];return t.concat([o,t.from((0,a.intAsHexBytes)(e||r||0,1),"hex"),s])}default:throw new Error("Invalid format")}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/EIP712/utils.js"}],[869,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SWAP_COMMANDS=r.UNISWAP_COMMANDS=r.WETH_PER_CHAIN_ID=r.UNISWAP_EXECUTE_SELECTOR=r.UNISWAP_UNIVERSAL_ROUTER_ADDRESS=void 0,r.UNISWAP_UNIVERSAL_ROUTER_ADDRESS="0x3fc91a3afd70395cd496c647d5a6cc9d4b2b7fad",r.UNISWAP_EXECUTE_SELECTOR="0x3593564c",r.WETH_PER_CHAIN_ID={1:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",5:"0xB4FBF271143F4FBf7B91A5ded31805e42b2208d6",11155111:"0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14",42161:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",421613:"0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3",43114:"0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7",56:"0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c",8453:"0x4200000000000000000000000000000000000006",84531:"0x44D627f900da8AdaC7561bD73aA745F132450798",23888:"0x4300000000000000000000000000000000000004",42220:new Error("Celo isn't supporting wrapping Eth"),44787:new Error("Celo Alfajores isn't supporting wrapping Eth"),10:"0x4200000000000000000000000000000000000006",420:"0x4200000000000000000000000000000000000006",137:"0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",80001:"0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889"},r.UNISWAP_COMMANDS={"0x08":"V2_SWAP_EXACT_IN","0x09":"V2_SWAP_EXACT_OUT","0x00":"V3_SWAP_EXACT_IN","0x01":"V3_SWAP_EXACT_OUT","0x0b":"WRAP_ETH","0x0c":"UNWRAP_ETH","0x0a":"PERMIT2_PERMIT","0x0d":"PERMIT2_TRANSFER_FROM","0x02":"PERMIT2_PERMIT_BATCH","0x03":"PERMIT2_TRANSFER_FROM_BATCH","0x06":"PAY_PORTION","0x04":"SWEEP"},r.SWAP_COMMANDS=["V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V3_SWAP_EXACT_IN","V3_SWAP_EXACT_OUT"]}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/Uniswap/constants.js"}],[87,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSelectedNetworkControllerMessenger=function(e){return e.getRestricted({name:"SelectedNetworkController",allowedActions:["NetworkController:getNetworkClientById","NetworkController:getState","NetworkController:getSelectedNetworkClient","PermissionController:hasPermissions","PermissionController:getSubjectNames"],allowedEvents:["NetworkController:stateChange","PermissionController:stateChange"]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/selected-network-controller-messenger.ts"}],[870,{"./constants":869,"@ethersproject/abi":631,buffer:3760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.UniswapDecoders=void 0;const n=e("@ethersproject/abi"),o=e("./constants"),s=e=>{const[,,,t]=n.defaultAbiCoder.decode(["address","uint256","uint256","address[]","bool"],e);return t.map(e=>e.toLowerCase())},i=e=>{const[,,,r]=n.defaultAbiCoder.decode(["address","uint256","uint256","bytes","bool"],e),o=t.from(r.slice(2),"hex"),s=[];let i=0;for(;i<o.length;)s.push(`0x${o.subarray(i,i+20).toString("hex").toLowerCase()}`),i+=23;return s},a=(e,t)=>{const r=o.WETH_PER_CHAIN_ID[t];return r instanceof Error?[]:[r.toLowerCase()]},l=()=>[];r.UniswapDecoders={V2_SWAP_EXACT_IN:s,V2_SWAP_EXACT_OUT:s,V3_SWAP_EXACT_IN:i,V3_SWAP_EXACT_OUT:i,WRAP_ETH:a,UNWRAP_ETH:a,PERMIT2_PERMIT:l,PERMIT2_TRANSFER_FROM:l,PERMIT2_PERMIT_BATCH:l,PERMIT2_TRANSFER_FROM_BATCH:l,PAY_PORTION:l,SWEEP:e=>{const[t]=n.defaultAbiCoder.decode(["address","address","uint256"],e);return[t.toLowerCase()]}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/Uniswap/decoders.js"}],[871,{"../../services/ledger/erc20":873,"./constants":869,"./decoders":870,"@ethersproject/abi":631,"@ledgerhq/logs":882,buffer:3760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.loadInfosForUniswap=r.getCommandsAndTokensFromUniswapCalldata=r.isSupported=void 0;const o=e("@ledgerhq/logs"),s=e("@ethersproject/abi"),i=e("../../services/ledger/erc20"),a=e("./decoders"),l=e("./constants");r.isSupported=(e,t,r,n)=>{const o=e.slice(0,10),s=null==t?void 0:t.toLowerCase();if(o!==l.UNISWAP_EXECUTE_SELECTOR||s!==l.UNISWAP_UNIVERSAL_ROUTER_ADDRESS||!n.length)return!1;let i;for(let e=0;e<n.length;e++){const[t,r]=n[e];if(!t)return!1;if(!l.SWAP_COMMANDS.includes(t))continue;const o=t.slice(0,2);if(i&&(i.asset!==r[0]||i.poolVersion!==o))return!1;i={poolVersion:o,asset:r[r.length-1]}}return!0};r.getCommandsAndTokensFromUniswapCalldata=(e,r)=>{try{const[n,o]=new s.Interface(["function execute(bytes calldata commands, bytes[] calldata inputs, uint256 deadline) external payable"]).decodeFunctionData("execute",e);return t.from(n.slice(2),"hex").reduce((e,t,n)=>{const s=l.UNISWAP_COMMANDS[`0x${t.toString(16).padStart(2,"0")}`];if(!s)return[...e,[undefined,[]]];const i=a.UniswapDecoders[s];return[...e,[s,i(o[n],r)]]},[])}catch(e){return(0,o.log)("Uniswap","Error decoding Uniswap calldata",e),[]}};r.loadInfosForUniswap=(e,o,s)=>n(void 0,void 0,void 0,function*(){const a=e.data.slice(0,10),c=(0,r.getCommandsAndTokensFromUniswapCalldata)(e.data,o);if(!(0,r.isSupported)(a,e.to,o,c))return{};const d=Array.from(new Set(c.flatMap(([,e])=>e))),u=Promise.all(d.map(e=>n(void 0,void 0,void 0,function*(){var t;const r=yield(0,i.findERC20SignaturesInfo)(s||{},o);return null===(t=(0,i.byContractAddressAndChainId)(e,o,r))||void 0===t?void 0:t.data}))),f=yield u.then(e=>e.filter(e=>!!e)),p="Uniswap",h=t.alloc(1);h.writeUIntBE(7,0,1);const g=t.from(p),m=t.from(l.UNISWAP_UNIVERSAL_ROUTER_ADDRESS.slice(2),"hex"),E=t.from(l.UNISWAP_EXECUTE_SELECTOR.slice(2),"hex"),_=t.from("3044022014391e8f355867a57fe88f6a5a4dbcb8bf8f888a9db3ff3449caf72d120396bd02200c13d9c3f79400fe0aa0434ac54d59b79503c9964a4abc3e8cd22763e0242935","hex");return{pluginData:t.concat([h,g,m,E,_]),tokenDescriptors:f}})}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/Uniswap/index.js"}],[872,{"./loadConfig":875,"@ledgerhq/logs":882,axios:3587},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.loadInfosForContractMethod=void 0;const s=o(e("axios")),i=e("./loadConfig"),a=e("@ledgerhq/logs");r.loadInfosForContractMethod=(e,t,r,o)=>n(void 0,void 0,void 0,function*(){const{pluginBaseURL:r,extraPlugins:n}=(0,i.getLoadConfig)(o);let l={};if(r){const e=`${r}/plugins/ethereum.json`;l=yield s.default.get(`${r}/plugins/ethereum.json`).then(e=>e.data).catch(t=>((0,a.log)("error","could not fetch from "+e+": "+String(t)),null))}if(n&&(l=Object.assign(Object.assign({},l),n)),!l)return;const c=t.toLowerCase(),d=e.toLowerCase();if(d in l){const e=l[d];if(c in e)return{payload:e[c].serialized_data,signature:e[c].signature,plugin:e[c].plugin,erc20OfInterest:e[c].erc20OfInterest,abi:e.abi}}})}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/contracts.js"}],[873,{"./loadConfig":875,"@ledgerhq/cryptoassets-evm-signatures/lib/data/evm/index":855,"@ledgerhq/logs":882,axios:3587,buffer:3760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.byContractAddressAndChainId=r.findERC20SignaturesInfo=void 0;const s=o(e("axios")),i=e("@ledgerhq/logs"),a=e("@ledgerhq/cryptoassets-evm-signatures/lib/data/evm/index"),l=e("./loadConfig"),c=e=>{const t=e.toLowerCase();return t.startsWith("0x")?t:"0x"+t};r.findERC20SignaturesInfo=(e,t)=>n(void 0,void 0,void 0,function*(){const{cryptoassetsBaseURL:r}=(0,l.getLoadConfig)(e);if(!r)return null;const n=`${r}/evm/${t}/erc20-signatures.json`;return yield s.default.get(n).then(({data:e})=>{if(!e||"string"!=typeof e)throw new Error(`ERC20 signatures for chainId ${t} file is malformed ${n}`);return e}).catch(e=>((0,i.log)("error","could not fetch from "+n+": "+String(e)),null))});r.byContractAddressAndChainId=(e,t,r)=>{var n,o;if(r)try{return d(r).byContractAndChainId(c(e),t)}catch(r){return null===(n=u(t))||void 0===n?void 0:n.byContractAndChainId(c(e),t)}return null===(o=u(t))||void 0===o?void 0:o.byContractAndChainId(c(e),t)};const d=e=>{const r=t.from(e,"base64"),n={},o=[];let s=0;for(;s<r.length;){const e=r.readUInt32BE(s);s+=4;const t=r.slice(s,s+e);let i=0;const a=t.readUInt8(i);i+=1;const l=t.slice(i,i+a).toString("ascii");i+=a;const d=c(t.slice(i,i+20).toString("hex"));i+=20;const u=t.readUInt32BE(i);i+=4;const f=t.readUInt32BE(i);i+=4;const p={ticker:l,contractAddress:d,decimals:u,chainId:f,signature:t.slice(i),data:t};o.push(p),n[String(f)+":"+d]=p,s+=e}return{list:()=>o,byContractAndChainId:(e,t)=>n[String(t)+":"+e]}},u=(()=>{const e={};return t=>{if(e[t])return e[t];const r=a.signatures[t];if(!r)return null;const n=d(r);return e[t]=n,n}})()}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/erc20.js"}],[874,{"../../modules/Uniswap":871,"../../modules/Uniswap/constants":869,"../../utils":877,"./contracts":872,"./erc20":873,"./nfts":876,"@ethersproject/abi":631,"@ethersproject/transactions":723,"@ledgerhq/domain-service/lib/signers/index":857,"@ledgerhq/logs":882,buffer:3760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});const o=e("@ethersproject/transactions"),s=e("@ethersproject/abi"),i=e("@ledgerhq/logs"),a=e("@ledgerhq/domain-service/lib/signers/index"),l=e("../../modules/Uniswap/constants"),c=e("./erc20"),d=e("../../modules/Uniswap"),u=e("./contracts"),f=e("./nfts"),p=e("../../utils"),h=(e,t,r,o)=>n(void 0,void 0,void 0,function*(){const n={nfts:[],erc20Tokens:[]};if(o.nft){const o=yield(0,f.getNFTInfo)(e,t,r);o?((0,i.log)("ethereum","loaded nft info for "+o.contractAddress+" ("+o.collectionName+")"),n.nfts.push(o.data)):(0,i.log)("ethereum","couldn't load nft info for "+e)}if(o.token){const o=yield(0,c.findERC20SignaturesInfo)(r,t),s=(0,c.byContractAddressAndChainId)(e,t,o);s?((0,i.log)("ethereum","loaded erc20token info for "+s.contractAddress+" ("+s.ticker+")"),n.erc20Tokens.push(s.data.toString("hex"))):(0,i.log)("ethereum","couldn't load erc20token info for "+e)}return n});r.default={resolveTransaction:(e,r,a)=>n(void 0,void 0,void 0,function*(){var c;const g=t.from(e,"hex"),m=(0,o.parse)(`0x${g.toString("hex")}`),E=(0,p.getChainIdAsUint32)(m.chainId),{domains:_}=a,S=null===(c=m.to)||void 0===c?void 0:c.toLowerCase();if(!S)return{nfts:[],erc20Tokens:[],externalPlugin:[],plugin:[],domains:[]};const A=m.data.length>=10&&m.data.substring(0,10),P=[];if(A){const e={token:a.erc20&&p.tokenSelectors.includes(A),nft:a.nft&&p.nftSelectors.includes(A),externalPlugins:a.externalPlugins,uniswapV3:a.uniswapV3},t=yield((e,t,r,o,a,c)=>n(void 0,void 0,void 0,function*(){let n={externalPlugin:[],plugin:[],nfts:[],erc20Tokens:[],domains:[]};if(c.nft){const r=yield(0,f.loadNftPlugin)(e,t,o,a);r?n.plugin.push(r):(0,i.log)("ethereum","no NFT plugin payload for selector "+t+" and address "+e)}if(c.externalPlugins&&e!==l.UNISWAP_UNIVERSAL_ROUTER_ADDRESS){const l=yield(0,u.loadInfosForContractMethod)(e,t,o,a);if(l){const{plugin:e,payload:c,signature:d,erc20OfInterest:u,abi:f}=l;if(e&&((0,i.log)("ethereum",`found plugin (${e}) for selector: ${t}`),n.externalPlugin.push({payload:c,signature:d})),u&&u.length&&f){const e=new s.Interface(f).parseTransaction(r).args;for(const t of u){const r=t.split(".").reduce((e,t)=>"-1"===t&&Array.isArray(e)?e[e.length-1]:e[t],e),s=yield h(r,o,a,{nft:!1,externalPlugins:!1,token:!0,uniswapV3:!1});n=(0,p.mergeResolutions)([n,s])}}}else(0,i.log)("ethereum","no infos for selector "+t)}if(c.uniswapV3){const{pluginData:e,tokenDescriptors:t}=yield(0,d.loadInfosForUniswap)(r,o);e&&t&&(n.externalPlugin.push({payload:e.toString("hex"),signature:""}),n.erc20Tokens.push(...t.map(e=>e.toString("hex"))))}return n}))(S,A,m,E,r,e);t&&P.push(t);const o=yield h(S,E,r,e);o&&P.push(o)}if(_){const e={domains:_};P.push(e)}return(0,p.mergeResolutions)(P)}),signDomainResolution:a.signDomainResolution,signAddressResolution:a.signAddressResolution}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/index.js"}],[875,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getLoadConfig=void 0;const n={nftExplorerBaseURL:"https://nft.api.live.ledger.com/v1/ethereum",pluginBaseURL:"https://cdn.live.ledger.com",extraPlugins:null,cryptoassetsBaseURL:"https://cdn.live.ledger.com/cryptoassets",calServiceURL:"https://crypto-assets-service.api.ledger.com"};r.getLoadConfig=function(e){return Object.assign(Object.assign({},n),e)}}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/loadConfig.js"}],[876,{"./loadConfig":875,"@ledgerhq/logs":882,axios:3587},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.loadNftPlugin=r.getNFTInfo=void 0;const s=o(e("axios")),i=e("./loadConfig"),a=e("@ledgerhq/logs");r.getNFTInfo=(e,t,r)=>n(void 0,void 0,void 0,function*(){var n;const{nftExplorerBaseURL:o}=(0,i.getLoadConfig)(r);if(!o)return;const l=`${o}/${t}/contracts/${e}`,c=yield s.default.get(l).then(e=>e.data).catch(e=>((0,a.log)("error","could not fetch from "+l+": "+String(e)),null));if(!c)return;const d=c.payload,u=parseInt(d.slice(4,6),16),f=null===(n=d.substr(6,2*u).match(/.{2}/g))||void 0===n?void 0:n.reduce((e,t)=>e+String.fromCharCode(parseInt(t,16)),"");return{contractAddress:e,collectionName:f||"",data:d}});r.loadNftPlugin=(e,t,r,o)=>n(void 0,void 0,void 0,function*(){const{nftExplorerBaseURL:n}=(0,i.getLoadConfig)(o);if(!n)return;const l=`${n}/${r}/contracts/${e}/plugin-selector/${t}`,c=yield s.default.get(l).then(e=>e.data).catch(e=>((0,a.log)("error","could not fetch from "+l+": "+String(e)),null));if(!c)return;return c.payload})}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/nfts.js"}],[877,{"@ethersproject/rlp":707,"@ledgerhq/evm-tools/lib/selectors/index":863,"bignumber.js":878,buffer:3760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.safeChunkTransaction=r.getV=r.getChainIdAsUint32=r.getParity=r.mergeResolutions=r.nftSelectors=r.tokenSelectors=r.intAsHexBytes=r.maybeHexBuffer=r.hexBuffer=r.splitPath=r.padHexString=r.ERC1155_CLEAR_SIGNED_SELECTORS=r.ERC721_CLEAR_SIGNED_SELECTORS=r.ERC20_CLEAR_SIGNED_SELECTORS=void 0;const i=e("bignumber.js"),a=s(e("@ethersproject/rlp")),l=e("@ledgerhq/evm-tools/lib/selectors/index");Object.defineProperty(r,"ERC20_CLEAR_SIGNED_SELECTORS",{enumerable:!0,get:function(){return l.ERC20_CLEAR_SIGNED_SELECTORS}}),Object.defineProperty(r,"ERC721_CLEAR_SIGNED_SELECTORS",{enumerable:!0,get:function(){return l.ERC721_CLEAR_SIGNED_SELECTORS}}),Object.defineProperty(r,"ERC1155_CLEAR_SIGNED_SELECTORS",{enumerable:!0,get:function(){return l.ERC1155_CLEAR_SIGNED_SELECTORS}});function c(e){if(!e)return t.alloc(0);const n=e.startsWith("0x")?e.slice(2):e;return t.from((0,r.padHexString)(n),"hex")}r.padHexString=e=>e.length%2?"0"+e:e,r.splitPath=function(e){const t=[];return e.split("/").forEach(e=>{let r=parseInt(e,10);isNaN(r)||(e.length>1&&"'"===e[e.length-1]&&(r+=2147483648),t.push(r))}),t},r.hexBuffer=c,r.maybeHexBuffer=function(e){return e?c(e):null};r.intAsHexBytes=(e,t)=>e.toString(16).padStart(2*t,"0"),r.tokenSelectors=Object.values(l.ERC20_CLEAR_SIGNED_SELECTORS),r.nftSelectors=[...Object.values(l.ERC721_CLEAR_SIGNED_SELECTORS),...Object.values(l.ERC1155_CLEAR_SIGNED_SELECTORS)];r.mergeResolutions=e=>{const t={nfts:[],erc20Tokens:[],externalPlugin:[],plugin:[],domains:[]};for(const r of e)for(const e in r)t[e].push(...r[e]);return t};r.getParity=(e,t,n)=>{if(n)return e;const o=2*(0,r.getChainIdAsUint32)(t)+35;if(o%256===e)return 0;if((o+1)%256===e)return 1;throw new Error("Invalid v value")};r.getChainIdAsUint32=e=>{const n=t.from((0,r.padHexString)(new i.BigNumber(e).toString(16)),"hex").subarray(0,4);return parseInt(n.toString("hex"),16)};r.getV=(e,t,n)=>{if(t.isZero())return e.toString(16);const o=(0,r.getParity)(e,t,n);return n?(0,r.padHexString)(o.toString(16)):(0,r.padHexString)(t.times(2).plus(35).plus(o).toString(16))};r.safeChunkTransaction=(e,r,n)=>{const o=255,s=t.concat([r,e]);if(s.length<=o)return[s];if(n){const e=Math.ceil(s.length/o);return new Array(e).fill(null).map((e,t)=>s.subarray(t*o,(t+1)*o))}const i=a.decode(e).slice(-3),l=c(a.encode(i)).subarray(1);let d=0;const u=s.length%o;if(0===u||u>l.length)d=o;else for(let e=1;e<=o;e++){const t=s.length%(o-e);if(0===t||t>l.length){d=o-e;break}}const f=Math.ceil(s.length/d);return new Array(f).fill(null).map((e,t)=>s.subarray(t*d,(t+1)*d))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/utils.js"}],[878,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){!function(e){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,o=Math.ceil,s=Math.floor,i="[BigNumber Error] ",a=i+"Number primitive has more than 15 significant digits: ",l=1e14,c=14,d=9007199254740991,u=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],f=1e7,p=1e9;function h(e){var t=0|e;return e>0||e===t?t:t-1}function g(e){for(var t,r,n=1,o=e.length,s=e[0]+"";n<o;){for(t=e[n++]+"",r=c-t.length;r--;t="0"+t);s+=t}for(o=s.length;48===s.charCodeAt(--o););return s.slice(0,o+1||1)}function m(e,t){var r,n,o=e.c,s=t.c,i=e.s,a=t.s,l=e.e,c=t.e;if(!i||!a)return null;if(r=o&&!o[0],n=s&&!s[0],r||n)return r?n?0:-a:i;if(i!=a)return i;if(r=i<0,n=l==c,!o||!s)return n?0:!o^r?1:-1;if(!n)return l>c^r?1:-1;for(a=(l=o.length)<(c=s.length)?l:c,i=0;i<a;i++)if(o[i]!=s[i])return o[i]>s[i]^r?1:-1;return l==c?0:l>c^r?1:-1}function E(e,t,r,n){if(e<t||e>r||e!==s(e))throw Error(i+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function _(e){var t=e.c.length-1;return h(e.e/c)==t&&e.c[t]%2!=0}function S(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function A(e,t,r){var n,o;if(t<0){for(o=r+".";++t;o+=r);e=o+e}else if(++t>(n=e.length)){for(o=r,t-=n;--t;o+=r);e+=o}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}r=function e(t){var r,P,v,C,T,I,b,y,w,N,O=q.prototype={constructor:q,toString:null,valueOf:null},R=new q(1),M=20,x=4,L=-7,k=21,U=-1e7,D=1e7,B=!1,F=1,j=0,G={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",V=!0;function q(e,t){var r,o,i,l,u,f,p,h,g=this;if(!(g instanceof q))return new q(e,t);if(null==t){if(e&&!0===e._isBigNumber)return g.s=e.s,void(!e.c||e.e>D?g.c=g.e=null:e.e<U?g.c=[g.e=0]:(g.e=e.e,g.c=e.c.slice()));if((f="number"==typeof e)&&0*e==0){if(g.s=1/e<0?(e=-e,-1):1,e===~~e){for(l=0,u=e;u>=10;u/=10,l++);return void(l>D?g.c=g.e=null:(g.e=l,g.c=[e]))}h=String(e)}else{if(!n.test(h=String(e)))return v(g,h,f);g.s=45==h.charCodeAt(0)?(h=h.slice(1),-1):1}(l=h.indexOf("."))>-1&&(h=h.replace(".","")),(u=h.search(/e/i))>0?(l<0&&(l=u),l+=+h.slice(u+1),h=h.substring(0,u)):l<0&&(l=h.length)}else{if(E(t,2,H.length,"Base"),10==t&&V)return $(g=new q(e),M+g.e+1,x);if(h=String(e),f="number"==typeof e){if(0*e!=0)return v(g,h,f,t);if(g.s=1/e<0?(h=h.slice(1),-1):1,q.DEBUG&&h.replace(/^0\.0*|\./,"").length>15)throw Error(a+e)}else g.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1;for(r=H.slice(0,t),l=u=0,p=h.length;u<p;u++)if(r.indexOf(o=h.charAt(u))<0){if("."==o){if(u>l){l=p;continue}}else if(!i&&(h==h.toUpperCase()&&(h=h.toLowerCase())||h==h.toLowerCase()&&(h=h.toUpperCase()))){i=!0,u=-1,l=0;continue}return v(g,String(e),f,t)}f=!1,(l=(h=P(h,t,10,g.s)).indexOf("."))>-1?h=h.replace(".",""):l=h.length}for(u=0;48===h.charCodeAt(u);u++);for(p=h.length;48===h.charCodeAt(--p););if(h=h.slice(u,++p)){if(p-=u,f&&q.DEBUG&&p>15&&(e>d||e!==s(e)))throw Error(a+g.s*e);if((l=l-u-1)>D)g.c=g.e=null;else if(l<U)g.c=[g.e=0];else{if(g.e=l,g.c=[],u=(l+1)%c,l<0&&(u+=c),u<p){for(u&&g.c.push(+h.slice(0,u)),p-=c;u<p;)g.c.push(+h.slice(u,u+=c));u=c-(h=h.slice(u)).length}else u-=p;for(;u--;h+="0");g.c.push(+h)}}else g.c=[g.e=0]}function K(e,t,r,n){var o,s,i,a,l;if(null==r?r=x:E(r,0,8),!e.c)return e.toString();if(o=e.c[0],i=e.e,null==t)l=g(e.c),l=1==n||2==n&&(i<=L||i>=k)?S(l,i):A(l,i,"0");else if(s=(e=$(new q(e),t,r)).e,a=(l=g(e.c)).length,1==n||2==n&&(t<=s||s<=L)){for(;a<t;l+="0",a++);l=S(l,s)}else if(t-=i,l=A(l,s,"0"),s+1>a){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=s-a)>0)for(s+1==a&&(l+=".");t--;l+="0");return e.s<0&&o?"-"+l:l}function Y(e,t){for(var r,n,o=1,s=new q(e[0]);o<e.length;o++)(!(n=new q(e[o])).s||(r=m(s,n))===t||0===r&&s.s===t)&&(s=n);return s}function W(e,t,r){for(var n=1,o=t.length;!t[--o];t.pop());for(o=t[0];o>=10;o/=10,n++);return(r=n+r*c-1)>D?e.c=e.e=null:r<U?e.c=[e.e=0]:(e.e=r,e.c=t),e}function $(e,t,r,n){var i,a,d,f,p,h,g,m=e.c,E=u;if(m){e:{for(i=1,f=m[0];f>=10;f/=10,i++);if((a=t-i)<0)a+=c,d=t,p=m[h=0],g=s(p/E[i-d-1]%10);else if((h=o((a+1)/c))>=m.length){if(!n)break e;for(;m.length<=h;m.push(0));p=g=0,i=1,d=(a%=c)-c+1}else{for(p=f=m[h],i=1;f>=10;f/=10,i++);g=(d=(a%=c)-c+i)<0?0:s(p/E[i-d-1]%10)}if(n=n||t<0||null!=m[h+1]||(d<0?p:p%E[i-d-1]),n=r<4?(g||n)&&(0==r||r==(e.s<0?3:2)):g>5||5==g&&(4==r||n||6==r&&(a>0?d>0?p/E[i-d]:0:m[h-1])%10&1||r==(e.s<0?8:7)),t<1||!m[0])return m.length=0,n?(t-=e.e+1,m[0]=E[(c-t%c)%c],e.e=-t||0):m[0]=e.e=0,e;if(0==a?(m.length=h,f=1,h--):(m.length=h+1,f=E[c-a],m[h]=d>0?s(p/E[i-d]%E[d])*f:0),n)for(;;){if(0==h){for(a=1,d=m[0];d>=10;d/=10,a++);for(d=m[0]+=f,f=1;d>=10;d/=10,f++);a!=f&&(e.e++,m[0]==l&&(m[0]=1));break}if(m[h]+=f,m[h]!=l)break;m[h--]=0,f=1}for(a=m.length;0===m[--a];m.pop());}e.e>D?e.c=e.e=null:e.e<U&&(e.c=[e.e=0])}return e}function X(e){var t,r=e.e;return null===r?e.toString():(t=g(e.c),t=r<=L||r>=k?S(t,r):A(t,r,"0"),e.s<0?"-"+t:t)}return q.clone=e,q.ROUND_UP=0,q.ROUND_DOWN=1,q.ROUND_CEIL=2,q.ROUND_FLOOR=3,q.ROUND_HALF_UP=4,q.ROUND_HALF_DOWN=5,q.ROUND_HALF_EVEN=6,q.ROUND_HALF_CEIL=7,q.ROUND_HALF_FLOOR=8,q.EUCLID=9,q.config=q.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(E(r=e[t],0,p,t),M=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(E(r=e[t],0,8,t),x=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(E(r[0],-p,0,t),E(r[1],0,p,t),L=r[0],k=r[1]):(E(r,-p,p,t),L=-(k=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)E(r[0],-p,-1,t),E(r[1],1,p,t),U=r[0],D=r[1];else{if(E(r,-p,p,t),!r)throw Error(i+t+" cannot be zero: "+r);U=-(D=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(i+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw B=!r,Error(i+"crypto unavailable");B=r}else B=r}if(e.hasOwnProperty(t="MODULO_MODE")&&(E(r=e[t],0,9,t),F=r),e.hasOwnProperty(t="POW_PRECISION")&&(E(r=e[t],0,p,t),j=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(i+t+" not an object: "+r);G=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(i+t+" invalid: "+r);V="0123456789"==r.slice(0,10),H=r}}return{DECIMAL_PLACES:M,ROUNDING_MODE:x,EXPONENTIAL_AT:[L,k],RANGE:[U,D],CRYPTO:B,MODULO_MODE:F,POW_PRECISION:j,FORMAT:G,ALPHABET:H}},q.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!q.DEBUG)return!0;var t,r,n=e.c,o=e.e,a=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===a||-1===a)&&o>=-p&&o<=p&&o===s(o)){if(0===n[0]){if(0===o&&1===n.length)return!0;break e}if((t=(o+1)%c)<1&&(t+=c),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=l||r!==s(r))break e;if(0!==r)return!0}}}else if(null===n&&null===o&&(null===a||1===a||-1===a))return!0;throw Error(i+"Invalid BigNumber: "+e)},q.maximum=q.max=function(){return Y(arguments,-1)},q.minimum=q.min=function(){return Y(arguments,1)},q.random=(C=9007199254740992,T=Math.random()*C&2097151?function(){return s(Math.random()*C)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,a,l,d=0,f=[],h=new q(R);if(null==e?e=M:E(e,0,p),a=o(e/c),B)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(a*=2));d<a;)(l=131072*t[d]+(t[d+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[d]=r[0],t[d+1]=r[1]):(f.push(l%1e14),d+=2);d=a/2}else{if(!crypto.randomBytes)throw B=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(a*=7);d<a;)(l=281474976710656*(31&t[d])+1099511627776*t[d+1]+4294967296*t[d+2]+16777216*t[d+3]+(t[d+4]<<16)+(t[d+5]<<8)+t[d+6])>=9e15?crypto.randomBytes(7).copy(t,d):(f.push(l%1e14),d+=7);d=a/7}if(!B)for(;d<a;)(l=T())<9e15&&(f[d++]=l%1e14);for(a=f[--d],e%=c,a&&e&&(l=u[c-e],f[d]=s(a/l)*l);0===f[d];f.pop(),d--);if(d<0)f=[n=0];else{for(n=-1;0===f[0];f.splice(0,1),n-=c);for(d=1,l=f[0];l>=10;l/=10,d++);d<c&&(n-=c-d)}return h.e=n,h.c=f,h}),q.sum=function(){for(var e=1,t=arguments,r=new q(t[0]);e<t.length;)r=r.plus(t[e++]);return r},P=function(){var e="0123456789";function t(e,t,r,n){for(var o,s,i=[0],a=0,l=e.length;a<l;){for(s=i.length;s--;i[s]*=t);for(i[0]+=n.indexOf(e.charAt(a++)),o=0;o<i.length;o++)i[o]>r-1&&(null==i[o+1]&&(i[o+1]=0),i[o+1]+=i[o]/r|0,i[o]%=r)}return i.reverse()}return function(n,o,s,i,a){var l,c,d,u,f,p,h,m,E=n.indexOf("."),_=M,S=x;for(E>=0&&(u=j,j=0,n=n.replace(".",""),p=(m=new q(o)).pow(n.length-E),j=u,m.c=t(A(g(p.c),p.e,"0"),10,s,e),m.e=m.c.length),d=u=(h=t(n,o,s,a?(l=H,e):(l=e,H))).length;0==h[--u];h.pop());if(!h[0])return l.charAt(0);if(E<0?--d:(p.c=h,p.e=d,p.s=i,h=(p=r(p,m,_,S,s)).c,f=p.r,d=p.e),E=h[c=d+_+1],u=s/2,f=f||c<0||null!=h[c+1],f=S<4?(null!=E||f)&&(0==S||S==(p.s<0?3:2)):E>u||E==u&&(4==S||f||6==S&&1&h[c-1]||S==(p.s<0?8:7)),c<1||!h[0])n=f?A(l.charAt(1),-_,l.charAt(0)):l.charAt(0);else{if(h.length=c,f)for(--s;++h[--c]>s;)h[c]=0,c||(++d,h=[1].concat(h));for(u=h.length;!h[--u];);for(E=0,n="";E<=u;n+=l.charAt(h[E++]));n=A(n,d,l.charAt(0))}return n}}(),r=function(){function e(e,t,r){var n,o,s,i,a=0,l=e.length,c=t%f,d=t/f|0;for(e=e.slice();l--;)a=((o=c*(s=e[l]%f)+(n=d*s+(i=e[l]/f|0)*c)%f*f+a)/r|0)+(n/f|0)+d*i,e[l]=o%r;return a&&(e=[a].concat(e)),e}function t(e,t,r,n){var o,s;if(r!=n)s=r>n?1:-1;else for(o=s=0;o<r;o++)if(e[o]!=t[o]){s=e[o]>t[o]?1:-1;break}return s}function r(e,t,r,n){for(var o=0;r--;)e[r]-=o,o=e[r]<t[r]?1:0,e[r]=o*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,o,i,a,d){var u,f,p,g,m,E,_,S,A,P,v,C,T,I,b,y,w,N=n.s==o.s?1:-1,O=n.c,R=o.c;if(!(O&&O[0]&&R&&R[0]))return new q(n.s&&o.s&&(O?!R||O[0]!=R[0]:R)?O&&0==O[0]||!R?0*N:N/0:NaN);for(A=(S=new q(N)).c=[],N=i+(f=n.e-o.e)+1,d||(d=l,f=h(n.e/c)-h(o.e/c),N=N/c|0),p=0;R[p]==(O[p]||0);p++);if(R[p]>(O[p]||0)&&f--,N<0)A.push(1),g=!0;else{for(I=O.length,y=R.length,p=0,N+=2,(m=s(d/(R[0]+1)))>1&&(R=e(R,m,d),O=e(O,m,d),y=R.length,I=O.length),T=y,v=(P=O.slice(0,y)).length;v<y;P[v++]=0);w=R.slice(),w=[0].concat(w),b=R[0],R[1]>=d/2&&b++;do{if(m=0,(u=t(R,P,y,v))<0){if(C=P[0],y!=v&&(C=C*d+(P[1]||0)),(m=s(C/b))>1)for(m>=d&&(m=d-1),_=(E=e(R,m,d)).length,v=P.length;1==t(E,P,_,v);)m--,r(E,y<_?w:R,_,d),_=E.length,u=1;else 0==m&&(u=m=1),_=(E=R.slice()).length;if(_<v&&(E=[0].concat(E)),r(P,E,v,d),v=P.length,-1==u)for(;t(R,P,y,v)<1;)m++,r(P,y<v?w:R,v,d),v=P.length}else 0===u&&(m++,P=[0]);A[p++]=m,P[0]?P[v++]=O[T]||0:(P=[O[T]],v=1)}while((T++<I||null!=P[0])&&N--);g=null!=P[0],A[0]||A.splice(0,1)}if(d==l){for(p=1,N=A[0];N>=10;N/=10,p++);$(S,i+(S.e=p+f*c-1)+1,a,g)}else S.e=f,S.r=+g;return S}}(),I=/^(-?)0([xbo])(?=\w[\w.]*$)/i,b=/^([^.]+)\.$/,y=/^\.([^.]+)$/,w=/^-?(Infinity|NaN)$/,N=/^\s*\+(?=[\w.])|^\s+|\s+$/g,v=function(e,t,r,n){var o,s=r?t:t.replace(N,"");if(w.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!r&&(s=s.replace(I,function(e,t,r){return o="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=o?e:t}),n&&(o=n,s=s.replace(b,"$1").replace(y,"0.$1")),t!=s))return new q(s,o);if(q.DEBUG)throw Error(i+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},O.absoluteValue=O.abs=function(){var e=new q(this);return e.s<0&&(e.s=1),e},O.comparedTo=function(e,t){return m(this,new q(e,t))},O.decimalPlaces=O.dp=function(e,t){var r,n,o,s=this;if(null!=e)return E(e,0,p),null==t?t=x:E(t,0,8),$(new q(s),e+s.e+1,t);if(!(r=s.c))return null;if(n=((o=r.length-1)-h(this.e/c))*c,o=r[o])for(;o%10==0;o/=10,n--);return n<0&&(n=0),n},O.dividedBy=O.div=function(e,t){return r(this,new q(e,t),M,x)},O.dividedToIntegerBy=O.idiv=function(e,t){return r(this,new q(e,t),0,1)},O.exponentiatedBy=O.pow=function(e,t){var r,n,a,l,d,u,f,p,h=this;if((e=new q(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+X(e));if(null!=t&&(t=new q(t)),d=e.e>14,!h.c||!h.c[0]||1==h.c[0]&&!h.e&&1==h.c.length||!e.c||!e.c[0])return p=new q(Math.pow(+X(h),d?e.s*(2-_(e)):+X(e))),t?p.mod(t):p;if(u=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new q(NaN);(n=!u&&h.isInteger()&&t.isInteger())&&(h=h.mod(t))}else{if(e.e>9&&(h.e>0||h.e<-1||(0==h.e?h.c[0]>1||d&&h.c[1]>=24e7:h.c[0]<8e13||d&&h.c[0]<=9999975e7)))return l=h.s<0&&_(e)?-0:0,h.e>-1&&(l=1/l),new q(u?1/l:l);j&&(l=o(j/c+2))}for(d?(r=new q(.5),u&&(e.s=1),f=_(e)):f=(a=Math.abs(+X(e)))%2,p=new q(R);;){if(f){if(!(p=p.times(h)).c)break;l?p.c.length>l&&(p.c.length=l):n&&(p=p.mod(t))}if(a){if(0===(a=s(a/2)))break;f=a%2}else if($(e=e.times(r),e.e+1,1),e.e>14)f=_(e);else{if(0===(a=+X(e)))break;f=a%2}h=h.times(h),l?h.c&&h.c.length>l&&(h.c.length=l):n&&(h=h.mod(t))}return n?p:(u&&(p=R.div(p)),t?p.mod(t):l?$(p,j,x,undefined):p)},O.integerValue=function(e){var t=new q(this);return null==e?e=x:E(e,0,8),$(t,t.e+1,e)},O.isEqualTo=O.eq=function(e,t){return 0===m(this,new q(e,t))},O.isFinite=function(){return!!this.c},O.isGreaterThan=O.gt=function(e,t){return m(this,new q(e,t))>0},O.isGreaterThanOrEqualTo=O.gte=function(e,t){return 1===(t=m(this,new q(e,t)))||0===t},O.isInteger=function(){return!!this.c&&h(this.e/c)>this.c.length-2},O.isLessThan=O.lt=function(e,t){return m(this,new q(e,t))<0},O.isLessThanOrEqualTo=O.lte=function(e,t){return-1===(t=m(this,new q(e,t)))||0===t},O.isNaN=function(){return!this.s},O.isNegative=function(){return this.s<0},O.isPositive=function(){return this.s>0},O.isZero=function(){return!!this.c&&0==this.c[0]},O.minus=function(e,t){var r,n,o,s,i=this,a=i.s;if(t=(e=new q(e,t)).s,!a||!t)return new q(NaN);if(a!=t)return e.s=-t,i.plus(e);var d=i.e/c,u=e.e/c,f=i.c,p=e.c;if(!d||!u){if(!f||!p)return f?(e.s=-t,e):new q(p?i:NaN);if(!f[0]||!p[0])return p[0]?(e.s=-t,e):new q(f[0]?i:3==x?-0:0)}if(d=h(d),u=h(u),f=f.slice(),a=d-u){for((s=a<0)?(a=-a,o=f):(u=d,o=p),o.reverse(),t=a;t--;o.push(0));o.reverse()}else for(n=(s=(a=f.length)<(t=p.length))?a:t,a=t=0;t<n;t++)if(f[t]!=p[t]){s=f[t]<p[t];break}if(s&&(o=f,f=p,p=o,e.s=-e.s),(t=(n=p.length)-(r=f.length))>0)for(;t--;f[r++]=0);for(t=l-1;n>a;){if(f[--n]<p[n]){for(r=n;r&&!f[--r];f[r]=t);--f[r],f[n]+=l}f[n]-=p[n]}for(;0==f[0];f.splice(0,1),--u);return f[0]?W(e,f,u):(e.s=3==x?-1:1,e.c=[e.e=0],e)},O.modulo=O.mod=function(e,t){var n,o,s=this;return e=new q(e,t),!s.c||!e.s||e.c&&!e.c[0]?new q(NaN):!e.c||s.c&&!s.c[0]?new q(s):(9==F?(o=e.s,e.s=1,n=r(s,e,0,3),e.s=o,n.s*=o):n=r(s,e,0,F),(e=s.minus(n.times(e))).c[0]||1!=F||(e.s=s.s),e)},O.multipliedBy=O.times=function(e,t){var r,n,o,s,i,a,d,u,p,g,m,E,_,S,A,P=this,v=P.c,C=(e=new q(e,t)).c;if(!(v&&C&&v[0]&&C[0]))return!P.s||!e.s||v&&!v[0]&&!C||C&&!C[0]&&!v?e.c=e.e=e.s=null:(e.s*=P.s,v&&C?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=h(P.e/c)+h(e.e/c),e.s*=P.s,(d=v.length)<(g=C.length)&&(_=v,v=C,C=_,o=d,d=g,g=o),o=d+g,_=[];o--;_.push(0));for(S=l,A=f,o=g;--o>=0;){for(r=0,m=C[o]%A,E=C[o]/A|0,s=o+(i=d);s>o;)r=((u=m*(u=v[--i]%A)+(a=E*u+(p=v[i]/A|0)*m)%A*A+_[s]+r)/S|0)+(a/A|0)+E*p,_[s--]=u%S;_[s]=r}return r?++n:_.splice(0,1),W(e,_,n)},O.negated=function(){var e=new q(this);return e.s=-e.s||null,e},O.plus=function(e,t){var r,n=this,o=n.s;if(t=(e=new q(e,t)).s,!o||!t)return new q(NaN);if(o!=t)return e.s=-t,n.minus(e);var s=n.e/c,i=e.e/c,a=n.c,d=e.c;if(!s||!i){if(!a||!d)return new q(o/0);if(!a[0]||!d[0])return d[0]?e:new q(a[0]?n:0*o)}if(s=h(s),i=h(i),a=a.slice(),o=s-i){for(o>0?(i=s,r=d):(o=-o,r=a),r.reverse();o--;r.push(0));r.reverse()}for((o=a.length)-(t=d.length)<0&&(r=d,d=a,a=r,t=o),o=0;t;)o=(a[--t]=a[t]+d[t]+o)/l|0,a[t]=l===a[t]?0:a[t]%l;return o&&(a=[o].concat(a),++i),W(e,a,i)},O.precision=O.sd=function(e,t){var r,n,o,s=this;if(null!=e&&e!==!!e)return E(e,1,p),null==t?t=x:E(t,0,8),$(new q(s),e,t);if(!(r=s.c))return null;if(n=(o=r.length-1)*c+1,o=r[o]){for(;o%10==0;o/=10,n--);for(o=r[0];o>=10;o/=10,n++);}return e&&s.e+1>n&&(n=s.e+1),n},O.shiftedBy=function(e){return E(e,-9007199254740991,d),this.times("1e"+e)},O.squareRoot=O.sqrt=function(){var e,t,n,o,s,i=this,a=i.c,l=i.s,c=i.e,d=M+4,u=new q("0.5");if(1!==l||!a||!a[0])return new q(!l||l<0&&(!a||a[0])?NaN:a?i:1/0);if(0==(l=Math.sqrt(+X(i)))||l==1/0?(((t=g(a)).length+c)%2==0&&(t+="0"),l=Math.sqrt(+t),c=h((c+1)/2)-(c<0||c%2),n=new q(t=l==1/0?"5e"+c:(t=l.toExponential()).slice(0,t.indexOf("e")+1)+c)):n=new q(l+""),n.c[0])for((l=(c=n.e)+d)<3&&(l=0);;)if(s=n,n=u.times(s.plus(r(i,s,d,1))),g(s.c).slice(0,l)===(t=g(n.c)).slice(0,l)){if(n.e<c&&--l,"9999"!=(t=t.slice(l-3,l+1))&&(o||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||($(n,n.e+M+2,1),e=!n.times(n).eq(i));break}if(!o&&($(s,s.e+M+2,0),s.times(s).eq(i))){n=s;break}d+=4,l+=4,o=1}return $(n,n.e+M+1,x,e)},O.toExponential=function(e,t){return null!=e&&(E(e,0,p),e++),K(this,e,t,1)},O.toFixed=function(e,t){return null!=e&&(E(e,0,p),e=e+this.e+1),K(this,e,t)},O.toFormat=function(e,t,r){var n,o=this;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=G;else if("object"!=typeof r)throw Error(i+"Argument not an object: "+r);if(n=o.toFixed(e,t),o.c){var s,a=n.split("."),l=+r.groupSize,c=+r.secondaryGroupSize,d=r.groupSeparator||"",u=a[0],f=a[1],p=o.s<0,h=p?u.slice(1):u,g=h.length;if(c&&(s=l,l=c,c=s,g-=s),l>0&&g>0){for(s=g%l||l,u=h.substr(0,s);s<g;s+=l)u+=d+h.substr(s,l);c>0&&(u+=d+h.slice(s)),p&&(u="-"+u)}n=f?u+(r.decimalSeparator||"")+((c=+r.fractionGroupSize)?f.replace(new RegExp("\\d{"+c+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):f):u}return(r.prefix||"")+n+(r.suffix||"")},O.toFraction=function(e){var t,n,o,s,a,l,d,f,p,h,m,E,_=this,S=_.c;if(null!=e&&(!(d=new q(e)).isInteger()&&(d.c||1!==d.s)||d.lt(R)))throw Error(i+"Argument "+(d.isInteger()?"out of range: ":"not an integer: ")+X(d));if(!S)return new q(_);for(t=new q(R),p=n=new q(R),o=f=new q(R),E=g(S),a=t.e=E.length-_.e-1,t.c[0]=u[(l=a%c)<0?c+l:l],e=!e||d.comparedTo(t)>0?a>0?t:p:d,l=D,D=1/0,d=new q(E),f.c[0]=0;h=r(d,t,0,1),1!=(s=n.plus(h.times(o))).comparedTo(e);)n=o,o=s,p=f.plus(h.times(s=p)),f=s,t=d.minus(h.times(s=t)),d=s;return s=r(e.minus(n),o,0,1),f=f.plus(s.times(p)),n=n.plus(s.times(o)),f.s=p.s=_.s,m=r(p,o,a*=2,x).minus(_).abs().comparedTo(r(f,n,a,x).minus(_).abs())<1?[p,o]:[f,n],D=l,m},O.toNumber=function(){return+X(this)},O.toPrecision=function(e,t){return null!=e&&E(e,1,p),K(this,e,t,2)},O.toString=function(e){var t,r=this,n=r.s,o=r.e;return null===o?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=o<=L||o>=k?S(g(r.c),o):A(g(r.c),o,"0"):10===e&&V?t=A(g((r=$(new q(r),M+o+1,x)).c),r.e,"0"):(E(e,2,H.length,"Base"),t=P(A(g(r.c),o,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},O.valueOf=O.toJSON=function(){return X(this)},O._isBigNumber=!0,null!=t&&q.set(t),q}(),r.default=r.BigNumber=r,"function"==typeof define&&define.amd?define(function(){return r}):void 0!==t&&t.exports?t.exports=r:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=r)}(this)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>bignumber.js",file:"node_modules/@ledgerhq/hw-app-eth/node_modules/bignumber.js/bignumber.js"}],[879,{"@ledgerhq/errors":860,"@ledgerhq/logs":882,buffer:3760,events:4072},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.getAltStatusMessage=r.StatusCodes=r.TransportStatusError=r.TransportError=void 0;const s=o(e("events")),i=e("@ledgerhq/errors");Object.defineProperty(r,"TransportError",{enumerable:!0,get:function(){return i.TransportError}}),Object.defineProperty(r,"StatusCodes",{enumerable:!0,get:function(){return i.StatusCodes}}),Object.defineProperty(r,"getAltStatusMessage",{enumerable:!0,get:function(){return i.getAltStatusMessage}}),Object.defineProperty(r,"TransportStatusError",{enumerable:!0,get:function(){return i.TransportStatusError}});const a=e("@ledgerhq/logs");class l{constructor({context:e,logType:r}={}){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new s.default,this.send=(e,r,o,s,...a)=>n(this,[e,r,o,s,...a],void 0,function*(e,r,n,o,s=t.alloc(0),a=[i.StatusCodes.OK],{abortTimeoutMs:l}={}){const c=this.tracer.withUpdatedContext({function:"send"});if(s.length>=256)throw c.trace("data.length exceeded 256 bytes limit",{dataLength:s.length}),new i.TransportError("data.length exceed 256 bytes limit. Got: "+s.length,"DataLengthTooBig");c.trace("Starting an exchange",{abortTimeoutMs:l});const d=yield this.exchange(t.concat([t.from([e,r,n,o]),t.from([s.length]),s]),{abortTimeoutMs:l});c.trace("Received response from exchange");const u=d.readUInt16BE(d.length-2);if(!a.some(e=>e===u))throw new i.TransportStatusError(u);return d}),this._appAPIlock=null,this.tracer=new a.LocalTracer(null!=r?r:"transport",e)}exchange(e,{abortTimeoutMs:t}={}){throw new Error("exchange not implemented")}exchangeBulk(e,t){let r=!1;return(()=>n(this,void 0,void 0,function*(){if(!r)for(const n of e){const e=yield this.exchange(n);if(r)return;const o=e.readUInt16BE(e.length-2);if(o!==i.StatusCodes.OK)throw new i.TransportStatusError(o);t.next(e)}}))().then(()=>!r&&t.complete(),e=>!r&&t.error(e)),{unsubscribe:()=>{r=!0}}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,t){this._events.on(e,t)}off(e,t){this._events.removeListener(e,t)}emit(e,...t){this._events.emit(e,...t)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,t){return new Promise((r,n)=>{let o=!1;const s=this.listen({next:t=>{o=!0,s&&s.unsubscribe(),a&&clearTimeout(a),this.open(t.descriptor,e).then(r,n)},error:e=>{a&&clearTimeout(a),n(e)},complete:()=>{a&&clearTimeout(a),o||n(new i.TransportError(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),a=t?setTimeout(()=>{s.unsubscribe(),n(new i.TransportError(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},t):null})}exchangeAtomicImpl(e){return n(this,void 0,void 0,function*(){const t=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw t.trace("Atomic exchange is already busy"),new i.TransportRaceCondition("An action was already pending on the Ledger device. Please deny or reconnect.");let r;const n=new Promise(e=>{r=e});this.exchangeBusyPromise=n;let o=!1;const s=setTimeout(()=>{t.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),o=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const r=yield e();return o&&(t.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),r}finally{t.trace("Finalize, clearing busy guard"),clearTimeout(s),r&&r(),this.exchangeBusyPromise=null}})}decorateAppAPIMethods(e,t,r){for(const n of t)e[n]=this.decorateAppAPIMethod(n,e[n],e,r)}decorateAppAPIMethod(e,t,r,o){return(...s)=>n(this,void 0,void 0,function*(){const{_appAPIlock:n}=this;if(n)return Promise.reject(new i.TransportError("Ledger Device is busy (lock "+n+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(o),yield t.apply(r,s)}finally{this._appAPIlock=null}})}setTraceContext(e){this.tracer=this.tracer.withContext(e)}updateTraceContext(e){this.tracer.updateContext(e)}getTraceContext(){return this.tracer.getContext()}}l.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",l.ErrorMessage_NoDeviceFound="No Ledger device found",r.default=l}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/hw-transport",file:"node_modules/@ledgerhq/hw-transport/lib/Transport.js"}],[88,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getShieldControllerInitMessenger=function(e){return e.getRestricted({name:"ShieldControllerInit",allowedEvents:[],allowedActions:["AuthenticationController:getBearerToken"]})},r.getShieldControllerMessenger=function(e){return e.getRestricted({name:"ShieldController",allowedActions:[],allowedEvents:["TransactionController:stateChange"]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/shield/shield-controller-messenger.ts"}],[880,{rxjs:4996},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.setEnvUnsafe=r.setEnv=r.changes=r.getEnvDesc=r.isEnvDefault=r.getEnvDefault=r.getEnv=r.getAllEnvs=r.getAllEnvNames=r.getDefinition=void 0;const n=e("rxjs"),o=e=>{if(!Number.isNaN(e))return parseInt(e,10)},s=e=>{if(!Number.isNaN(e))return parseFloat(e)},i=e=>"boolean"==typeof e?e:!("0"===e||"false"===e),a=e=>"string"==typeof e?e:undefined,l=e=>{const t="string"==typeof e?e.split(","):null;if(Array.isArray(t)&&t.length>0)return t},c={ADDRESS_POISONING_FAMILIES:{def:"evm,tron",parser:a,desc:"List of families impacted by the address poisoning attack"},ANALYTICS_CONSOLE:{def:!1,parser:i,desc:"Show tracking overlays on the app UI"},DEBUG_THEME:{def:!1,parser:i,desc:"Show theme debug overlay UI"},API_ICP_ENDPOINT:{def:"https://icp.coin.ledger.com/",parser:a,desc:"Rosetta API for ICP"},API_CASPER_INDEXER_ENDPOINT:{parser:a,def:"https://casper.coin.ledger.com/indexer",desc:"Casper API url indexer"},API_CASPER_NODE_ENDPOINT:{parser:a,def:"https://casper.coin.ledger.com/node/",desc:"Casper API url node"},API_ALGORAND_BLOCKCHAIN_EXPLORER_API_ENDPOINT:{def:"https://algorand.coin.ledger.com",parser:a,desc:"Node API endpoint for algorand"},API_CELO_INDEXER:{def:"https://celo.coin.ledger.com/indexer/",parser:a,desc:"Explorer API for celo"},API_CELO_NODE:{def:"https://celo.coin.ledger.com/archive/",parser:a,desc:"Node endpoint for celo"},COSMOS_GAS_AMPLIFIER:{def:1.3,parser:o,desc:"Cosmos gas estimate multiplier"},API_FILECOIN_ENDPOINT:{parser:a,def:"https://filecoin.coin.ledger.com",desc:"Filecoin API url"},API_STACKS_ENDPOINT:{parser:a,def:"https://stacks.coin.ledger.com",desc:"Stacks API url"},API_POLKADOT_INDEXER:{parser:a,def:"https://polkadot.coin.ledger.com",desc:"Explorer API for polkadot"},API_POLKADOT_SIDECAR:{parser:a,def:"https://polkadot-sidecar.coin.ledger.com",desc:"Polkadot Sidecar API url"},API_POLKADOT_SIDECAR_CREDENTIALS:{parser:a,def:"",desc:"Polkadot Sidecar API credentials"},API_POLKADOT_NODE:{parser:a,def:"https://polkadot-fullnodes.api.live.ledger.com",desc:"Polkadot Node"},ELROND_API_ENDPOINT:{parser:a,def:"https://elrond.coin.ledger.com",desc:"Elrond API url"},ELROND_DELEGATION_API_ENDPOINT:{parser:a,def:"https://delegations-elrond.coin.ledger.com",desc:"Elrond DELEGATION API url"},API_STELLAR_HORIZON:{parser:a,def:"https://stellar.coin.ledger.com",desc:"Stellar Horizon API url"},API_STELLAR_HORIZON_FETCH_LIMIT:{parser:o,def:100,desc:"Limit of operation that Horizon will fetch per page"},API_STELLAR_HORIZON_STATIC_FEE:{def:!1,parser:i,desc:"Static fee for Stellar account"},API_TEZOS_BAKER:{parser:a,def:"https://tezos-bakers.api.live.ledger.com",desc:"bakers API for tezos"},API_TEZOS_BLOCKCHAIN_EXPLORER_API_ENDPOINT:{def:"https://xtz-explorer.api.live.ledger.com/explorer",parser:a,desc:"Ledger explorer API for tezos"},API_TEZOS_TZKT_API:{def:"https://xtz-tzkt-explorer.api.live.ledger.com",parser:a,desc:"tzkt.io explorer"},API_TEZOS_NODE:{def:"https://xtz-node.api.live.ledger.com",parser:a,desc:"node API for tezos (for broadcast only)"},API_TRONGRID_PROXY:{parser:a,def:"https://tron.coin.ledger.com",desc:"proxy url for trongrid API"},API_SOLANA_PROXY:{parser:a,def:"https://solana.coin.ledger.com",desc:"proxy url for solana API"},SOLANA_VALIDATORS_APP_BASE_URL:{parser:a,def:"https://earn.api.live.ledger.com/v0/network/solana/validator-details",desc:"base url for validators.app validator list"},SOLANA_TESTNET_VALIDATORS_APP_BASE_URL:{parser:a,def:"https://validators-solana.coin.ledger.com/api/v1/validators",desc:"base url for testnet validators.app validator list"},SOLANA_TX_CONFIRMATION_TIMEOUT:{def:1e5,parser:o,desc:"solana transaction broadcast confirmation timeout"},API_HEDERA_MIRROR:{def:"https://hedera.coin.ledger.com",parser:a,desc:"mirror node API for Hedera"},API_VECHAIN_THOREST:{def:"https://vechain.coin.ledger.com",parser:a,desc:"Thorest API for VeChain"},BASE_SOCKET_URL:{def:"wss://scriptrunner.api.live.ledger.com/update",parser:a,desc:"Ledger script runner API"},BOT_TIMEOUT_SCAN_ACCOUNTS:{def:6e5,parser:o,desc:"bot's default timeout for scanAccounts"},BOT_SPEC_DEFAULT_TIMEOUT:{def:18e5,parser:o,desc:"define the default value of spec.skipMutationsTimeout (if not overriden by spec)"},BUY_API_BASE:{def:"https://buy.api.live.ledger.com/buy/v1",parser:a,desc:"Buy crypto API base url - version 1"},CARDANO_API_ENDPOINT:{def:"https://cardano.coin.ledger.com/api",parser:a,desc:"Cardano API url"},CARDANO_TESTNET_API_ENDPOINT:{def:"https://testnet-ledger.cardanoscan.io/api",parser:a,desc:"Cardano API url"},ICON_NODE_ENDPOINT:{parser:a,def:"https://icon.coin.ledger.com/api/v3",desc:"ICON RPC url"},ICON_DEBUG_ENDPOINT:{parser:a,def:"https://icon.coin.ledger.com/api/v3d",desc:"ICON debug RPC url"},ICON_INDEXER_ENDPOINT:{parser:a,def:"https://icon.coin.ledger.com/api/v1",desc:"ICON API url"},ICON_TESTNET_NODE_ENDPOINT:{parser:a,def:"https://berlin.net.solidwallet.io/api/v3",desc:"ICON Berlin Testnet API url"},ICON_TESTNET_DEBUG_ENDPOINT:{parser:a,def:"https://berlin.net.solidwallet.io/api/v3d",desc:"ICON Berlin Testnet debug"},ICON_TESTNET_INDEXER_ENDPOINT:{parser:a,def:"https://tracker.berlin.icon.community/api/v1",desc:"ICON Berlin Testnet API url"},COINAPPS:{def:"",parser:a,desc:"(dev feature) defines the folder for speculos mode that contains Nano apps binaries (.elf) in a specific structure: <device>/<firmware>/<appName>/app_<appVersion>.elf"},CRYPTO_ORG_INDEXER:{def:"https://cryptoorg-rpc-indexer.coin.ledger.com",parser:a,desc:"location of the Cronos POS Chain (formerly Crypto.org) indexer API"},CRYPTO_ORG_TESTNET_INDEXER:{def:"https://cronos-pos.org/explorer/croeseid4",parser:a,desc:"location of the Cronos POS Chain (formerly Crypto.org) indexer testnet API"},CRYPTO_ORG_RPC_URL:{def:"https://cryptoorg-rpc-node.coin.ledger.com",parser:a,desc:"location of the Cronos POS Chain (formerly Crypto.org) chain node"},CRYPTO_ORG_TESTNET_RPC_URL:{def:"https://rpc-testnet-croeseid-4.crypto.org",parser:a,desc:"location of the Cronos POS Chain (formerly Crypto.org) chain testnet node"},DEBUG_UTXO_DISPLAY:{def:4,parser:o,desc:"define maximum number of utxos to display in CLI"},DEBUG_HTTP_RESPONSE:{def:!1,parser:i,desc:"includes HTTP response body in logs"},DEVICE_CANCEL_APDU_FLUSH_MECHANISM:{def:!0,parser:i,desc:"enable a mechanism that send a 0x00 apdu to force device to awake from its 'Processing' UI state"},DEVICE_PROXY_URL:{def:"",parser:a,desc:"enable a proxy to use instead of a physical device"},DEVICE_PROXY_MODEL:{def:"nanoS",parser:a,desc:"allow to override the default model of a proxied device"},DISABLE_TRANSACTION_BROADCAST:{def:!1,parser:i,desc:"disable broadcast of transactions"},DISABLE_SYNC_TOKEN:{def:!0,parser:i,desc:"disable a problematic mechanism of our API"},DISABLE_FW_UPDATE_VERSION_CHECK:{def:!1,parser:i,desc:"disable the version check for firmware update eligibility"},EIP1559_MINIMUM_FEES_GATE:{def:!0,parser:i,desc:"prevents the user from doing an EIP1559 transaction with fees too low"},EIP1559_PRIORITY_FEE_LOWER_GATE:{def:.85,parser:s,desc:"minimum priority fee percents allowed compared to network conditions allowed when EIP1559_MINIMUM_FEES_GATE is activated"},EIP1559_BASE_FEE_MULTIPLIER:{def:1.27,parser:s,desc:"mutiplier for the base fee that is composing the maxFeePerGas property"},EXPERIMENTAL_BLE:{def:!1,parser:i,desc:"enable experimental support of Bluetooth"},EXPERIMENTAL_CURRENCIES:{def:"",parser:a,desc:"enable experimental support of currencies (comma separated)"},EXPERIMENTAL_EXPLORERS:{def:!1,parser:i,desc:"enable experimental explorer APIs"},EXPERIMENTAL_LANGUAGES:{def:!1,parser:i,desc:"enable experimental languages"},EXPERIMENTAL_MANAGER:{def:!1,parser:i,desc:"enable an experimental version of Manager"},EXPERIMENTAL_ROI_CALCULATION:{def:!1,parser:i,desc:"enable an experimental version of the portfolio percentage calculation"},EXPERIMENTAL_SEND_MAX:{def:!1,parser:i,desc:"force enabling SEND MAX even if not yet stable"},EXPERIMENTAL_USB:{def:!1,parser:i,desc:"enable an experimental implementation of USB support"},EXPERIMENTAL_SWAP:{def:!1,parser:i,desc:"enable an experimental swap interface"},EXPLORER:{def:"https://explorers.api.live.ledger.com",parser:a,desc:"Ledger generic explorer API"},EXPLORER_STAGING:{def:"https://explorers.api-01.live.ledger-stg.com",parser:a,desc:"Ledger staging explorer API"},EXPLORER_BETA:{def:"https://explorers.api.live.ledger.com",parser:a,desc:"Ledger generic explorer beta API"},EXPLORER_SATSTACK:{def:"http://localhost:20000",parser:a,desc:"Ledger satstack Bitcoin explorer API"},EXPORT_EXCLUDED_LOG_TYPES:{def:"ble-frame",parser:a,desc:"comma-separated list of excluded log types for exported logs"},EXPORT_MAX_LOGS:{def:5e3,parser:o,desc:"maximum logs to keep for export"},DISABLE_APP_VERSION_REQUIREMENTS:{def:!1,parser:i,desc:"force an old application version to be accepted regardless of its version"},FORCE_PROVIDER:{def:1,parser:o,desc:"use a different provider for app store (for developers only)"},FILTER_ZERO_AMOUNT_ERC20_EVENTS:{def:!0,parser:i,desc:"Remove filter of address poisoning"},GET_CALLS_RETRY:{def:2,parser:o,desc:"how many times to retry a GET http call"},GET_CALLS_TIMEOUT:{def:6e4,parser:o,desc:"how much time to timeout a GET http call"},HIDE_EMPTY_TOKEN_ACCOUNTS:{def:!1,parser:i,desc:"hide the sub accounts when they are empty"},KEYCHAIN_OBSERVABLE_RANGE:{def:0,parser:o,desc:"overrides the gap limit specified by BIP44 (default to 20)"},LEDGER_CLIENT_VERSION:{def:"",parser:a,desc:"the 'X-Ledger-Client-Version' HTTP header to use for queries to Ledger APIs"},LEDGER_COUNTERVALUES_API:{def:"https://countervalues.live.ledger.com",parser:a,desc:"Ledger countervalues API"},LEDGER_REST_API_BASE:{def:"https://explorers.api.live.ledger.com",parser:a,desc:"DEPRECATED"},LEGACY_KT_SUPPORT_TO_YOUR_OWN_RISK:{def:!1,parser:i,desc:"enable sending to KT accounts. Not tested."},MANAGER_API_BASE:{def:"https://manager.api.live.ledger.com/api",parser:a,desc:"Ledger Manager API"},MANAGER_DEV_MODE:{def:!1,parser:i,desc:"enable visibility of utility apps in Manager"},MANAGER_INSTALL_DELAY:{def:1e3,parser:o,desc:"defines the time to wait before installing apps to prevent known glitch (<=1.5.5) when chaining installs"},MAPPING_SERVICE:{def:"https://mapping-service.api.ledger.com",parser:a,desc:""},MAX_ACCOUNT_NAME_SIZE:{def:50,parser:o,desc:"maximum size of account names"},MOCK:{def:"",parser:a,desc:"switch the app into a MOCK mode for test purpose, the value will be used as a seed for the rng. Avoid falsy values."},MOCK_COUNTERVALUES:{def:"",parser:a,desc:"switch the countervalues resolution into a MOCK mode for test purpose"},MOCK_APP_UPDATE:{def:!1,parser:i,desc:"Always shows app update in the manager"},MOCK_EXCHANGE_TEST_CONFIG:{def:!1,parser:i,desc:"mock the cryptoassets config and test partner (in the context of app-exchange)"},MOCK_REMOTE_LIVE_MANIFEST:{def:"",parser:a,desc:"mock remote live app manifest"},MOCK_OS_VERSION:{def:"",parser:a,desc:"if defined, overrides the os and version. format: os@version. Example: Windows_NT@6.1.7601"},MOCK_NO_BYPASS:{def:!1,parser:i,desc:"if defined, avoids bypass of the currentDevice in the store."},NFT_CURRENCIES:{def:["avalanche_c_chain","bsc","ethereum","polygon"],parser:l,desc:"set the currencies where NFT is active"},NFT_ETH_METADATA_SERVICE:{def:"https://nft.api.live.ledger.com",parser:a,desc:"service uri used to get the metadata of an nft"},OPERATION_ADDRESSES_LIMIT:{def:100,parser:o,desc:"limit the number of addresses in from/to of operations"},OPERATION_OPTIMISTIC_RETENTION:{def:18e5,parser:o,desc:"timeout to keep an optimistic operation that was broadcasted but not yet visible from the coin implementation or the API"},OPERATION_PAGE_SIZE_INITIAL:{def:100,parser:o,desc:"defines the initial default operation length page to use"},POLKADOT_ELECTION_STATUS_THRESHOLD:{def:25,parser:o,desc:"in blocks - number of blocks before Polkadot election effectively opens to consider it as open and disable all staking features"},SATSTACK:{def:!1,parser:i,desc:"Switch to satstack mode"},SCAN_FOR_INVALID_PATHS:{def:!1,parser:i,desc:"enable searching accounts in exotic derivation paths"},SEED:{def:"",parser:a,desc:"(dev feature) seed to be used by speculos (device simulator)"},SHOW_LEGACY_NEW_ACCOUNT:{def:!1,parser:i,desc:"allow the creation of legacy accounts"},SIMPLE_HASH_API_BASE:{def:"https://simplehash.api.live.ledger.com/api/v0",parser:a,desc:"SimpleHash API base url"},SKIP_ONBOARDING:{def:!1,parser:i,desc:"dev flag to skip onboarding flow"},SPECULOS_API_PORT:{def:0,parser:o,desc:"API port for speculos"},SPECULOS_PID_OFFSET:{def:0,parser:o,desc:"offset to be added to the speculos pid and avoid collision with other instances"},SPECULOS_USE_WEBSOCKET:{def:!1,parser:i,desc:"Use speculos websocket interface instead of Rest API"},SWAP_API_BASE:{def:"https://swap.ledger.com/v5",parser:a,desc:"Swap API base"},SWAP_USER_IP:{def:"",parser:a,desc:"Swap IP"},SWAP_DISABLE_APPS_INSTALL:{def:!1,parser:i,desc:"bypass app checks on Nano for speculos swap tests"},SYNC_ALL_INTERVAL:{def:48e4,parser:o,desc:"delay between successive sync"},SYNC_BOOT_DELAY:{def:2e3,parser:o,desc:"delay before the sync starts"},SYNC_PENDING_INTERVAL:{def:1e4,parser:o,desc:"delay between sync when an operation is still pending"},SYNC_OUTDATED_CONSIDERED_DELAY:{def:6e5,parser:o,desc:"delay until Live consider a sync outdated"},SYNC_MAX_CONCURRENT:{def:4,parser:o,desc:"maximum limit to synchronize accounts concurrently to limit overload"},BOT_MAX_CONCURRENT:{def:10,parser:o,desc:"maximum limit to run bot spec in parallel"},USER_ID:{def:"",parser:a,desc:"unique identifier of app instance. used to derivate dissociated ids for difference purposes (e.g. the firmware update incremental deployment)."},WALLETCONNECT:{def:!1,parser:i,desc:"is walletconnect enabled"},CLOUD_SYNC_API_STAGING:{def:"https://cloud-sync-backend.api.aws.stg.ldg-tech.com",parser:a,desc:"wallet sync api staging base url"},CLOUD_SYNC_API_PROD:{def:"https://cloud-sync.api.live.ledger.com",parser:a,desc:"wallet sync api production base url"},WITH_DEVICE_POLLING_DELAY:{def:500,parser:s,desc:"delay when polling device"},ANNOUNCEMENTS_API_URL:{def:"https://cdn.live.ledger.com/announcements",parser:a,desc:"url used to fetch new announcements"},ANNOUNCEMENTS_API_VERSION:{def:1,parser:o,desc:"version used for the announcements api"},STATUS_API_URL:{def:"https://ledger.statuspage.io/api",parser:a,desc:"url used to fetch ledger status"},STATUS_API_VERSION:{def:2,parser:o,desc:"version used for ledger status api"},TEZOS_MAX_TX_QUERIES:{def:100,parser:o,desc:"safe max on maximum number of queries to synchronize a tezos account"},TRUSTCHAIN_API_STAGING:{def:"https://trustchain-backend.api.aws.stg.ldg-tech.com",parser:a,desc:"Trustchain API Staging"},TRUSTCHAIN_API_PROD:{def:"https://trustchain.api.live.ledger.com",parser:a,desc:"Trustchain API Prod"},PLATFORM_DEBUG:{def:!1,parser:i,desc:"enable visibility of debug apps and tools in Platform Catalog"},PLATFORM_EXPERIMENTAL_APPS:{def:!1,parser:i,desc:"enable visibility of experimental apps and tools in Platform Catalog"},PLATFORM_MANIFEST_API_URL:{def:"https://live-app-catalog.ledger.com/api/v1/apps",parser:a,desc:"url used to fetch platform app manifests"},PLATFORM_LOCAL_MANIFEST_JSON:{def:"",parser:a,desc:'json manifest for a local (test) platform app manifests. How to use: PLATFORM_LOCAL_MANIFEST_JSON="$(cat /path/to/file.json)"'},PLATFORM_GLOBAL_CATALOG_API_URL:{def:"https://cdn.live.ledger.com/platform/catalog/v1/data.json",parser:a,desc:"url used to fetch platform app manifests"},PLATFORM_GLOBAL_CATALOG_STAGING_API_URL:{def:"https://cdn.live.ledger-stg.com/platform/catalog/v1/data.json",parser:a,desc:"url used to fetch platform app manifests (staging)"},PLATFORM_RAMP_CATALOG_API_URL:{def:"https://cdn.live.ledger.com/platform/trade/v1/data.json",parser:a,desc:"url used to fetch platform app manifests"},PLATFORM_RAMP_CATALOG_STAGING_API_URL:{def:"https://cdn.live.ledger-stg.com/platform/trade/v1/data.json",parser:a,desc:"url used to fetch platform app manifests (staging)"},PLATFORM_API_URL:{def:"",parser:a,desc:"url used to fetch platform catalog"},PLATFORM_API_VERSION:{def:1,parser:o,desc:"version used for the platform api"},PLAYWRIGHT_RUN:{def:!1,parser:i,desc:"true when launched for E2E testing"},MARKET_API_URL:{def:"https://proxycg.api.live.ledger.com/api/v3",parser:a,desc:"Market data api"},USE_LEARN_STAGING_URL:{def:!1,parser:i,desc:"use the staging URL for the learn page"},DYNAMIC_CAL_BASE_URL:{def:"https://cdn.live.ledger.com/cryptoassets",parser:a,desc:"bucket S3 of the dynamic cryptoassets list"},CAL_SERVICE_URL:{def:"https://crypto-assets-service.api.ledger.com",parser:a,desc:"Cryptoassets list service url"},FEATURE_FLAGS:{def:"{}",parser:e=>{try{if("string"!=typeof e)throw new Error;return JSON.parse(e)}catch(e){return undefined}},desc:"key value map for feature flags: {[key in FeatureId]?: Feature]}"},PERFORMANCE_CONSOLE:{def:!1,parser:i,desc:"Show a performance overlay on the app UI"},ETHEREUM_STUCK_TRANSACTION_TIMEOUT:{def:3e5,parser:o,desc:"Time after which an optimisc operation is considered stuck"},EVM_REPLACE_TX_LEGACY_GASPRICE_FACTOR:{def:1.3,parser:s,desc:"Replace transaction gasprice factor for legacy evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_REPLACE_TX_EIP1559_MAXFEE_FACTOR:{def:1.3,parser:s,desc:"Replace transaction max fee factor for EIP1559 evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_REPLACE_TX_EIP1559_MAXPRIORITYFEE_FACTOR:{def:1.1,parser:s,desc:"Replace transaction max priority fee factor for EIP1559 evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_FORCE_LEGACY_TRANSACTIONS:{def:!1,parser:i,desc:"Force transaction type 0 on EVM networks"},ENABLE_NETWORK_LOGS:{def:!1,parser:i,desc:"Enable network request and responses logs. Errors are always logged"},CRYPTO_ASSET_SEARCH_KEYS:{def:["ticker","name","keywords"],parser:l,desc:"Fuse search attributes to find a currency according to user input"},VERBOSE:{def:[],parser:l,desc:'Sets up debug console printing of logs. `VERBOSE=1` or `VERBOSE=true`: to print all logs | `VERBOSE="apdu,hw,transport,hid-verbose"` : filtering on a list of log `type` separated by a `,`'},DEFAULT_TRANSACTION_POLLING_INTERVAL:{def:3e4,parser:o,desc:"Default interval to poll for transaction confirmation in speedup/cancel evm flow (in ms)"},LOW_BATTERY_PERCENTAGE:{def:20,parser:o,desc:"Configure the low battery percentage threshold"},LOG_DRAWERS:{def:!1,parser:i,desc:"Enable logs for drawers"}};r.getDefinition=e=>e in c?c[e]:undefined;const d=Object.keys(c).reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:c[t].def}),{}),u=Object.assign({},d);r.getAllEnvNames=()=>Object.keys(c);r.getAllEnvs=()=>Object.assign({},u);r.getEnv=e=>u[e];r.getEnvDefault=e=>d[e];r.isEnvDefault=e=>u[e]===d[e];r.getEnvDesc=e=>c[e].desc,r.changes=new n.Subject;r.setEnv=(e,t)=>{const n=u[e];n!==t&&(u[e]=t,r.changes.next({name:e,value:t,oldValue:n}))};r.setEnvUnsafe=(e,t)=>{const n=(0,r.getDefinition)(e);if(!n)return!1;const{parser:o}=n,s=o(t);return s===undefined||null===s?(console.warn(`Invalid ENV value for ${e}`),!1):((0,r.setEnv)(e,s),!0)}}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/evm-tools>@ledgerhq/live-env",file:"node_modules/@ledgerhq/live-env/lib/env.js"}],[881,{"./env":880},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),o(e("./env"),r)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/evm-tools>@ledgerhq/live-env",file:"node_modules/@ledgerhq/live-env/lib/index.js"}],[882,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.listen=r.LocalTracer=r.trace=r.log=void 0;let n=0;const o=[];r.log=(e,t,r)=>{const o={type:e,id:String(++n),date:new Date};t&&(o.message=t),r&&(o.data=r),i(o)};r.trace=({type:e,message:t,data:r,context:o})=>{const s={type:e,id:String(++n),date:new Date};t&&(s.message=t),r&&(s.data=r),o&&(s.context=o),i(s)};class s{constructor(e,t){this.type=e,this.context=t}trace(e,t){(0,r.trace)({type:this.type,message:e,data:t,context:this.context})}getContext(){return this.context}setContext(e){this.context=e}updateContext(e){this.context=Object.assign(Object.assign({},this.context),e)}getType(){return this.type}setType(e){this.type=e}withType(e){return new s(e,this.context)}withContext(e){return new s(this.type,e)}withUpdatedContext(e){return new s(this.type,Object.assign(Object.assign({},this.context),e))}}r.LocalTracer=s;function i(e){for(let t=0;t<o.length;t++)try{o[t](e)}catch(e){console.error(e)}}r.listen=e=>(o.push(e),()=>{const t=o.indexOf(e);-1!==t&&(o[t]=o[o.length-1],o.pop())}),"undefined"!=typeof window&&(window.__ledgerLogsListen=r.listen)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/logs",file:"node_modules/@ledgerhq/logs/lib/index.js"}],[89,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSmartTransactionsControllerInitMessenger=function(e){return e.getRestricted({name:"SmartTransactionsControllerInit",allowedActions:["MetaMetricsController:trackEvent"],allowedEvents:[]})},r.getSmartTransactionsControllerMessenger=function(e){return e.getRestricted({name:"SmartTransactionsController",allowedActions:["NetworkController:getNetworkClientById","NetworkController:getState"],allowedEvents:["NetworkController:stateChange"]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/smart-transactions-controller-messenger.ts"}],[9,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.PHISHING_WARNING_PAGE=r.PHISHING_STREAM=r.PHISHING_SAFELIST=r.METAMASK_INPAGE=r.METAMASK_EIP_1193_PROVIDER=r.METAMASK_COOKIE_HANDLER=r.METAMASK_CAIP_MULTICHAIN_PROVIDER=r.LEGACY_PUBLIC_CONFIG=r.LEGACY_PROVIDER=r.LEGACY_INPAGE=r.LEGACY_CONTENT_SCRIPT=r.CONTENT_SCRIPT=void 0;r.CONTENT_SCRIPT="metamask-contentscript",r.METAMASK_INPAGE="metamask-inpage",r.PHISHING_WARNING_PAGE="metamask-phishing-warning-page",r.METAMASK_COOKIE_HANDLER="metamask-cookie-handler",r.METAMASK_EIP_1193_PROVIDER="metamask-provider",r.METAMASK_CAIP_MULTICHAIN_PROVIDER="metamask-multichain-provider",r.PHISHING_SAFELIST="metamask-phishing-safelist",r.PHISHING_STREAM="phishing",r.LEGACY_CONTENT_SCRIPT="contentscript",r.LEGACY_INPAGE="inpage",r.LEGACY_PROVIDER="provider",r.LEGACY_PUBLIC_CONFIG="publicConfig"}}},{package:"$root$",file:"app/scripts/constants/stream.ts"}],[90,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getCronjobControllerMessenger=function(e){return e.getRestricted({name:"CronjobController",allowedEvents:["SnapController:snapInstalled","SnapController:snapUpdated","SnapController:snapUninstalled","SnapController:snapEnabled","SnapController:snapDisabled"],allowedActions:["PermissionController:getPermissions","SnapController:handleRequest"]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/cronjob-controller-messenger.ts"}],[91,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getExecutionServiceMessenger=function(e){return e.getRestricted({name:"ExecutionService",allowedEvents:[],allowedActions:[]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/execution-service-messenger.ts"}],[92,{"./cronjob-controller-messenger":90,"./execution-service-messenger":91,"./rate-limit-controller-messenger":93,"./snap-controller-messenger":94,"./snap-insights-controller-messenger":95,"./snap-interface-controller-messenger":96,"./snaps-name-provider-messenger":97,"./snaps-registry-messenger":98,"./websocket-service-messenger":99},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getCronjobControllerMessenger",{enumerable:!0,get:function(){return n.getCronjobControllerMessenger}}),Object.defineProperty(r,"getExecutionServiceMessenger",{enumerable:!0,get:function(){return o.getExecutionServiceMessenger}}),Object.defineProperty(r,"getRateLimitControllerInitMessenger",{enumerable:!0,get:function(){return s.getRateLimitControllerInitMessenger}}),Object.defineProperty(r,"getRateLimitControllerMessenger",{enumerable:!0,get:function(){return s.getRateLimitControllerMessenger}}),Object.defineProperty(r,"getSnapControllerInitMessenger",{enumerable:!0,get:function(){return i.getSnapControllerInitMessenger}}),Object.defineProperty(r,"getSnapControllerMessenger",{enumerable:!0,get:function(){return i.getSnapControllerMessenger}}),Object.defineProperty(r,"getSnapInsightsControllerMessenger",{enumerable:!0,get:function(){return a.getSnapInsightsControllerMessenger}}),Object.defineProperty(r,"getSnapInterfaceControllerMessenger",{enumerable:!0,get:function(){return l.getSnapInterfaceControllerMessenger}}),Object.defineProperty(r,"getSnapsNameProviderMessenger",{enumerable:!0,get:function(){return c.getSnapsNameProviderMessenger}}),Object.defineProperty(r,"getSnapsRegistryMessenger",{enumerable:!0,get:function(){return d.getSnapsRegistryMessenger}}),Object.defineProperty(r,"getWebSocketServiceMessenger",{enumerable:!0,get:function(){return u.getWebSocketServiceMessenger}});var n=e("./cronjob-controller-messenger"),o=e("./execution-service-messenger"),s=e("./rate-limit-controller-messenger"),i=e("./snap-controller-messenger"),a=e("./snap-insights-controller-messenger"),l=e("./snap-interface-controller-messenger"),c=e("./snaps-name-provider-messenger"),d=e("./snaps-registry-messenger"),u=e("./websocket-service-messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/index.ts"}],[93,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getRateLimitControllerInitMessenger=function(e){return e.getRestricted({name:"RateLimitController",allowedActions:["SubjectMetadataController:getState","NotificationServicesController:updateMetamaskNotificationsList"],allowedEvents:[]})},r.getRateLimitControllerMessenger=function(e){return e.getRestricted({name:"RateLimitController",allowedEvents:[],allowedActions:[]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/rate-limit-controller-messenger.ts"}],[94,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapControllerInitMessenger=function(e){return e.getRestricted({name:"SnapControllerInit",allowedEvents:[],allowedActions:["KeyringController:getKeyringsByType","PreferencesController:getState","MetaMetricsController:trackEvent"]})},r.getSnapControllerMessenger=function(e){return e.getRestricted({name:"SnapController",allowedEvents:["ExecutionService:unhandledError","ExecutionService:outboundRequest","ExecutionService:outboundResponse","KeyringController:lock"],allowedActions:["PermissionController:getEndowments","PermissionController:getPermissions","PermissionController:hasPermission","PermissionController:hasPermissions","PermissionController:requestPermissions","PermissionController:revokeAllPermissions","PermissionController:revokePermissions","PermissionController:revokePermissionForAllSubjects","PermissionController:getSubjectNames","PermissionController:updateCaveat","ApprovalController:addRequest","ApprovalController:updateRequestState","PermissionController:grantPermissions","SubjectMetadataController:getSubjectMetadata","SubjectMetadataController:addSubjectMetadata","ExecutionService:executeSnap","ExecutionService:terminateSnap","ExecutionService:terminateAllSnaps","ExecutionService:handleRpcRequest","NetworkController:getNetworkClientById","SelectedNetworkController:getNetworkClientIdForDomain","SnapsRegistry:get","SnapsRegistry:getMetadata","SnapsRegistry:update","SnapsRegistry:resolveVersion","SnapInterfaceController:createInterface","SnapInterfaceController:getInterface"]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snap-controller-messenger.ts"}],[95,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapInsightsControllerMessenger=function(e){return e.getRestricted({name:"SnapInsightsController",allowedActions:["SnapController:handleRequest","SnapController:getAll","PermissionController:getPermissions","SnapInterfaceController:deleteInterface"],allowedEvents:["TransactionController:unapprovedTransactionAdded","TransactionController:transactionStatusUpdated","SignatureController:stateChange"]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snap-insights-controller-messenger.ts"}],[96,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapInterfaceControllerMessenger=function(e){return e.getRestricted({name:"SnapInterfaceController",allowedActions:["PhishingController:maybeUpdateState","PhishingController:testOrigin","ApprovalController:hasRequest","ApprovalController:acceptRequest","SnapController:get","MultichainAssetsController:getState","AccountsController:getSelectedMultichainAccount","AccountsController:getAccountByAddress","AccountsController:listMultichainAccounts"],allowedEvents:["NotificationServicesController:notificationsListUpdated"]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snap-interface-controller-messenger.ts"}],[97,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapsNameProviderMessenger=function(e){return e.getRestricted({name:"SnapsNameProvider",allowedActions:["SnapController:getAll","SnapController:get","SnapController:handleRequest","PermissionController:getState"],allowedEvents:[]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snaps-name-provider-messenger.ts"}],[98,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapsRegistryMessenger=function(e){return e.getRestricted({name:"SnapsRegistry",allowedEvents:[],allowedActions:[]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snaps-registry-messenger.ts"}],[99,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getWebSocketServiceMessenger=function(e){return e.getRestricted({name:"WebSocketService",allowedActions:["SnapController:handleRequest"],allowedEvents:["SnapController:snapUpdated","SnapController:snapUninstalled","SnapController:snapInstalled"]})}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/websocket-service-messenger.ts"}],[4,{"../../shared/constants/app":5415,"../../shared/constants/background-liveness-check":5416,"../../shared/constants/errors":5420,"../../shared/constants/infura-project-id":5425,"../../shared/constants/messages":5429,"../../shared/constants/metametrics":5430,"../../shared/constants/offscreen-communication":5435,"../../shared/constants/onboarding":5436,"../../shared/constants/referrals":5440,"../../shared/constants/start-up-errors":5445,"../../shared/lib/get-first-preferred-lang-code":5500,"../../shared/lib/manifestFlags":5502,"../../shared/lib/promise-with-resolvers":5510,"../../shared/modules/browser-runtime.utils":5526,"../../shared/modules/caip-stream":5527,"../../shared/modules/fetch-with-timeout":5533,"../../shared/modules/mv3.utils":5538,"../../shared/modules/object.utils":5540,"../../shared/modules/selectors/networks":5547,"./constants/marketing-site-whitelist":6,"./constants/sentry-state":7,"./constants/snaps":8,"./constants/stream":9,"./first-time-state":182,"./lib/CronjobControllerStorageManager":187,"./lib/createHyperliquidReferralMiddleware":196,"./lib/deep-links/deep-link-router":207,"./lib/deep-links/metrics":208,"./lib/ens-ipfs/setup":213,"./lib/getObjStructure":215,"./lib/migrator":219,"./lib/notification-manager":223,"./lib/safe-reload":251,"./lib/setup-initial-state-hooks":254,"./lib/start-up-errors/start-up-errors":264,"./lib/state-corruption/state-corruption-recovery":265,"./lib/stores/extension-store":267,"./lib/stores/persistence-manager":269,"./lib/stores/read-only-network-store":270,"./lib/stream-utils":271,"./lib/util":290,"./metamask-controller":291,"./migrations":502,"./offscreen":503,"./platforms/extension":504,"@metamask/notification-services-controller":2240,"@metamask/utils":2799,"extension-port-stream":4075,loglevel:4542,"readable-stream":4977,"webextension-polyfill":5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.loadStateFromPersistence=Me,r.setupController=Ue,e("./lib/setup-initial-state-hooks"),e("../../shared/constants/infura-project-id");var n=e("readable-stream"),o=Z(e("loglevel")),s=Z(e("webextension-polyfill")),i=e("@metamask/utils"),a=Z(e("extension-port-stream")),l=e("@metamask/notification-services-controller"),c=e("../../shared/lib/promise-with-resolvers"),d=e("../../shared/constants/onboarding"),u=e("../../shared/constants/app"),f=e("../../shared/constants/messages"),p=e("../../shared/constants/background-liveness-check"),h=e("../../shared/constants/metametrics"),g=e("../../shared/modules/browser-runtime.utils"),m=e("../../shared/modules/mv3.utils"),E=e("../../shared/modules/object.utils"),_=(e("../../shared/constants/offscreen-communication"),e("../../shared/modules/selectors/networks")),S=e("../../shared/modules/caip-stream"),A=Z(e("../../shared/modules/fetch-with-timeout")),P=e("../../shared/constants/errors"),v=Z(e("../../shared/lib/get-first-preferred-lang-code")),C=(e("../../shared/lib/manifestFlags"),e("../../shared/constants/start-up-errors")),T=e("../../shared/constants/referrals"),I=e("./lib/state-corruption/state-corruption-recovery"),b=e("./lib/stores/persistence-manager"),y=Z(e("./lib/stores/extension-store")),w=(Z(e("./lib/stores/read-only-network-store")),Z(e("./migrations"))),N=Z(e("./lib/migrator")),O=Z(e("./platforms/extension")),R=e("./constants/sentry-state"),M=z(e("./lib/notification-manager")),x=z(e("./metamask-controller")),L=Z(e("./lib/getObjStructure")),k=Z(e("./lib/ens-ipfs/setup")),U=e("./lib/util"),D=e("./offscreen"),B=e("./lib/stream-utils"),F=Z(e("./first-time-state")),j=e("./constants/marketing-site-whitelist"),G=e("./constants/stream"),H=e("./constants/snaps"),V=e("./lib/deep-links/deep-link-router"),q=e("./lib/deep-links/metrics"),K=e("./lib/safe-reload"),Y=e("./lib/start-up-errors/start-up-errors"),W=e("./lib/CronjobControllerStorageManager"),$=e("./lib/createHyperliquidReferralMiddleware");function X(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(X=function(e){return e?r:t})(e)}function z(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=X(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&{}.hasOwnProperty.call(e,s)){var i=o?Object.getOwnPropertyDescriptor(e,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}function Z(e){return e&&e.__esModule?e:{default:e}}const Q="#0376C9",J="#D73847",ee=9,te=new y.default,re=new b.PersistenceManager({localStore:te});global.stateHooks.getMostRecentPersistedState=()=>re.mostRecentRetrievedState,global.logEncryptedVault=()=>{re.logEncryptedVault()};const{sentry:ne}=global;let oe={...F.default};const se={[u.ENVIRONMENT_TYPE_POPUP]:!0,[u.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[u.ENVIRONMENT_TYPE_FULLSCREEN]:!0},ie=["trezor-connect"];o.default.setLevel("info",!1);const ae=new O.default,le=new M.default,ce=(0,U.getPlatform)()===u.PLATFORM_FIREFOX;let de=0,ue=!1,fe=!1;const pe={},he={};let ge;const me={},Ee={};const _e=new URL("https://metamask.github.io/phishing-warning/v5.1.0/"),Se=_e.toString();let Ae,Pe,ve;function Ce(){const e=(0,c.withResolvers)();Ae=e.promise,Pe=e.resolve,ve=e.reject}globalThis.stateHooks.onInstalledListener?globalThis.stateHooks.onInstalledListener.then(Fe):s.default.runtime.onInstalled.addListener(function e(t){s.default.runtime.onInstalled.removeListener(e),Fe(t)}),Ce();let Te,Ie,be,ye;const we=new I.CorruptionHandler;function Ne(){const e=(new Date).toISOString();s.default.storage.session.set({timestamp:e})}async function Oe(e){const t=m.isManifestV3?(0,D.createOffscreen)():null,r=await Me(e),n=r.data,i=await(0,v.default)();let a;if(m.isManifestV3){var l;if(!1!==(null===(l=n.PreferencesController)||void 0===l?void 0:l.enableMV3TimestampSave)){const e=2e3;Ne(),setInterval(Ne,e)}const e=await s.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);a=(null==e?void 0:e.isFirstMetaMaskControllerSetup)===undefined,await s.default.storage.session.set({isFirstMetaMaskControllerSetup:a})}const c={},d=await async function(){const e=(0,A.default)(),t=H.PREINSTALLED_SNAPS_URLS.map(async t=>{const r=await e(t);if(t.pathname.endsWith(".json.gz")){const e=new DecompressionStream("gzip"),t=r.body.pipeThrough(e);return await new Response(t).json()}return await r.json()});return Promise.all(t)}(),u=new W.CronjobControllerStorageManager;await u.init();const{update:p,requestSafeReload:E}=(0,K.getRequestSafeReload)(re);Ue(n,i,c,a,r.meta,t,d,E,u),ge.store.on("update",p),ge.store.on("error",e=>{o.default.error("MetaMask controller.store error:",e),null==ne||ne.captureException(e)}),function(e){async function t(e,t){try{return await s.default.tabs.update(e,{url:t})}catch(e){return null==ne?void 0:ne.captureException(e)}}const r=!m.isManifestV3;s.default.webRequest.onBeforeRequest.addListener(n=>{var o,i,a;if(n.tabId===s.default.tabs.TAB_ID_NONE)return{};const{completedOnboarding:l}=e.onboardingController.state;if(!l)return{};if(!e.preferencesController.state.usePhishDetect)return{};if(n.initiator&&"null"!==n.initiator&&new URL(n.initiator).host===_e.host)return{};const{hostname:c,href:d,searchParams:u}=new URL(n.url);e.phishingController.maybeUpdateState();const f=e.phishingController.isBlockedRequest(n.url);let p,g;if("main_frame"!==n.type&&"sub_frame"!==n.type||(p=e.phishingController.test(n.url)),!(null!==(o=p)&&void 0!==o&&o.result||f.result))return{};let m=c;null!==(i=p)&&void 0!==i&&i.result&&f.result?g=`${p.type} and ${f.type}`:null!==(a=p)&&void 0!==a&&a.result?g=p.type:(g=f.type,m=n.initiator),ce||e.metaMetricsController.trackEvent({event:h.MetaMetricsEventName.PhishingPageDisplayed,category:h.MetaMetricsEventCategory.Phishing,properties:{url:m,referrer:{url:m},reason:g,requestDomain:f.result?c:undefined}},{excludeMetaMetricsId:!0});const E=new URLSearchParams({hostname:c,href:d}),_=new URL(Se);_.hash=E.toString();const S=_.toString();return r?"main_frame"===n.type?{redirectUrl:S}:(t(n.tabId,S),{cancel:!0}):(t(n.tabId,S),{})},{urls:["http://*/*","https://*/*","ws://*/*","wss://*/*"]},r?["blocking"]:[])}(ge),m.isManifestV3||await async function(){let e;try{const t=new URL(Se);let r,n;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const o=new Promise((e,t)=>{r=e,n=t});e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout(()=>n(new Re),1e3),await o}catch(e){e instanceof Re?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await(async()=>{const e=await s.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then(e=>((0,g.checkForLastErrorAndLog)(),e)).catch(()=>{(0,g.checkForLastErrorAndLog)()});for(const t of e)s.default.tabs.sendMessage(t.id,{name:f.EXTENSION_MESSAGES.READY}).then(()=>{(0,g.checkForLastErrorAndLog)()}).catch(()=>{(0,g.checkForLastErrorAndLog)()})})(),new V.DeepLinkRouter({getExtensionURL:ae.getExtensionURL,getState:ge.getState.bind(ge)}).on("navigate",async({url:e,parsed:t})=>{"redirectTo"in t||await ge.metaMetricsController.trackEvent((0,q.createEvent)({signature:t.signature,url:e}))}).on("error",e=>null==ne?void 0:ne.captureException(e)).install()}s.default.runtime.onConnect.addListener(async e=>{e.postMessage({data:{method:p.BACKGROUND_LIVENESS_METHOD},name:"background-liveness"});try{await Ae,Te(e)}catch(r){if(null==ne||ne.captureException(r),(0,P.isStateCorruptionError)(r))await we.handleStateCorruptionError({port:e,error:r,database:re,repairCallback:async e=>{Ce(),(0,I.hasVault)(e)?(await je(e),ge.onboardingController.setFirstTimeFlowType(d.FirstTimeFlowType.restore)):(await re.reset(),await je(null))}});else{var t;const n=(0,i.isObject)(r)?{message:r.message??"Unknown error",name:r.name??"UnknownError",stack:r.stack}:{message:String(r),name:"UnknownError",stack:""};(0,Y.tryPostMessage)(e,C.DISPLAY_GENERAL_STARTUP_ERROR,{error:n,currentLocale:null===(t=ge)||void 0===t||null===(t=t.preferencesController)||void 0===t||null===(t=t.state)||void 0===t?void 0:t.currentLocale})}}}),s.default.runtime.onConnectExternal.addListener(async(...e)=>{await Ae,Ie(...e)});class Re extends Error{constructor(){super("Timeout failed")}}async function Me(e){var t,r;let n;if(e){n={data:{},meta:{}};for(const t of b.backedUpStateKeys)(0,i.hasProperty)(e,t)&&(n.data[t]=e[t]);(0,i.hasProperty)(e,"meta")&&(0,i.isObject)(e.meta)&&(n.meta=e.meta),"number"!=typeof n.meta.version&&(o.default.error("The `backup`'s `meta.version` property was missing during backup restore."),n.meta.version=155)}else{const e=!0;n=await re.get({validateVault:e})}const s=new N.default({migrations:w.default,defaultVersion:null});s.on("error",e=>{console.warn(e);const t=(0,L.default)(n);ne.captureException(e,{extra:{vaultStructure:t}})}),null!==(t=n)&&void 0!==t&&t.data||null!==(r=n)&&void 0!==r&&r.meta||(n=s.generateInitialState(oe));const a=await s.migrateData(n);if(!a)throw new Error("MetaMask - migrator returned undefined");if(!(0,i.isObject)(a.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof a.meta}'`);if("number"!=typeof a.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof a.meta.version}'`);if(!(0,i.isObject)(a.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof a.data}'`);return re.setMetadata(a.meta),await re.set(a.data),a}function xe(e){const{metaMetricsId:t}=ge.metaMetricsController.state;if(!(0,U.shouldEmitDappViewedEvent)(t))return;const r=ge.getPermittedAccounts(e).length;if(0===r)return;const n=ge.controllerMessenger.call("PreferencesController:getState"),o=Object.keys(n.identities).length;ge.metaMetricsController.trackEvent({event:h.MetaMetricsEventName.DappViewed,category:h.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:o,number_of_accounts_connected:r}},{excludeMetaMetricsId:!0})}function Le(e){var t,r,n;if(null===(t=e.sender)||void 0===t||!t.tab||null===(r=e.sender)||void 0===r||!r.url||null===(n=e.sender)||void 0===n||null===(n=n.tab)||void 0===n||!n.url)return;const o=e.sender.tab.id,s=new URL(e.sender.url),{origin:i}=s,a=new URL(e.sender.tab.url),{origin:l}=a;Object.keys(me).includes(o)||(me[o]=i),o in Ee||(Ee[o]=l);const c=ge.controllerMessenger.call("PermissionController:hasPermissions",i),d="New Tab"!==e.sender.tab.title;c&&d&&xe(i)}function ke(e){const t=[u.ENVIRONMENT_TYPE_POPUP,u.ENVIRONMENT_TYPE_NOTIFICATION,u.ENVIRONMENT_TYPE_FULLSCREEN];!(Object.values(pe).some(Boolean)||ue||de>0)&&t.includes(e)&&function(){const{metaMetricsId:e,participateInMetaMetrics:t}=ge.metaMetricsController.state;(null!==e||t)&&ge.metaMetricsController.trackEvent({event:h.MetaMetricsEventName.AppOpened,category:h.MetaMetricsEventCategory.App})}()}function Ue(e,t,r,i,c,d,f,p,g){var A;ge=new x.default({infuraProjectId:globalThis.INFURA_PROJECT_ID,showUserConfirmation:De,initState:e,initLangCode:t,platform:ae,notificationManager:le,browser:s.default,getRequestAccountTabIds:()=>he,getOpenMetamaskTabsIds:()=>pe,overrides:r,isFirstMetaMaskControllerSetup:i,currentMigrationVersion:c.version,featureFlags:{},offscreenPromise:d,preinstalledSnaps:f,requestSafeReload:p,cronjobControllerStorageManager:g}),(0,k.default)({getCurrentChainId:()=>(0,_.getCurrentChainId)({metamask:ge.networkController.state}),getIpfsGateway:ge.preferencesController.getIpfsGateway.bind(ge.preferencesController),getUseAddressBarEnsResolution:()=>ge.preferencesController.state.useAddressBarEnsResolution,provider:ge.provider}),A=ge,global.stateHooks.getSentryAppState=function(){const e=A.memStore.getState();return(0,E.maskObject)(e,R.SENTRY_BACKGROUND_STATE)};const P=()=>de>0||Boolean(Object.keys(pe).length)||ue,v=(e,t)=>{if(!1===e)ge.onClientClosed();else{if(t===u.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(pe).length))return;ge.onEnvironmentTypeClosed(t)}};function C(e,t){return e>t?`${t}+`:String(e)}function T(){const e=I(),t=function(){try{const{isNotificationServicesEnabled:e,isFeatureAnnouncementsEnabled:t}=ge.notificationServicesController.state,r=Object.values(ge.notificationServicesController.state.metamaskNotificationsList).filter(e=>e.type===l.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP&&null===e.readDate).length,n=t?ge.notificationServicesController.state.metamaskNotificationsList.filter(e=>!e.isRead&&e.type===l.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT).length:0,o=e?ge.notificationServicesController.state.metamaskNotificationsList.filter(e=>!e.isRead&&e.type!==l.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT&&e.type!==l.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP).length:0;return r+n+o}catch(e){return console.error("Failed to get unread notifications count:",e),0}}();let r="",n=Q;e?r=C(e,ee):t>0&&(r=C(t,ee),n=J);try{const e={text:r},t={color:n};m.isManifestV3?(s.default.action.setBadgeText(e),s.default.action.setBadgeBackgroundColor(t)):(s.default.browserAction.setBadgeText(e),s.default.browserAction.setBadgeBackgroundColor(t))}catch(e){console.error("Error updating browser badge:",e)}}function I(){try{return ge.appStateController.waitingForUnlock.length+ge.approvalController.getTotalApprovalCount()}catch(e){return console.error("Failed to get pending approval count:",e),0}}Te=e=>{var t;const i=e.name;if(ie.includes(e.name))return;let l=!1;const c=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(l=ce?se[i]:(null==c?void 0:c.origin)===`chrome-extension://${s.default.runtime.id}`,l){var d;const t=(null==r||null===(d=r.getPortStream)||void 0===d?void 0:d.call(r,e))||new a.default(e);if(ge.isClientOpen=!0,ge.setupTrustedCommunication(t,e.sender),ke(i),async function(){try{await ge.remoteFeatureFlagController.updateRemoteFeatureFlags()}catch(e){o.default.error("Error initializing remote feature flags:",e)}}(),i===u.ENVIRONMENT_TYPE_POPUP&&(de+=1,(0,n.finished)(t,()=>{de-=1;const e=P();ge.isClientOpen=e,v(e,u.ENVIRONMENT_TYPE_POPUP)})),i===u.ENVIRONMENT_TYPE_NOTIFICATION&&(ue=!0,(0,n.finished)(t,()=>{ue=!1;const e=P();ge.isClientOpen=e,v(e,u.ENVIRONMENT_TYPE_NOTIFICATION)})),i===u.ENVIRONMENT_TYPE_FULLSCREEN){const r=e.sender.tab.id;pe[r]=!0,(0,n.finished)(t,()=>{delete pe[r];const e=P();ge.isClientOpen=e,v(e,u.ENVIRONMENT_TYPE_FULLSCREEN)})}}else if(c&&c.origin===_e.origin&&c.pathname===_e.pathname){var f;const t=(null==r||null===(f=r.getPortStream)||void 0===f?void 0:f.call(r,e))||new a.default(e);ge.setupPhishingCommunication({connectionStream:t})}else{var p;if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;Le(e),e.onMessage.addListener(e=>{e.data&&e.data.method===u.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(he[n]=t)})}if(c&&j.COOKIE_ID_MARKETING_WHITELIST_ORIGINS.some(e=>e===c.origin)){var h;const t=(null==r||null===(h=r.getPortStream)||void 0===h?void 0:h.call(r,e))||new a.default(e);ge.setUpCookieHandlerCommunication({connectionStream:t})}const t=(null==r||null===(p=r.getPortStream)||void 0===p?void 0:p.call(r,e))||new a.default(e);if(be(t,e.sender),ce||!m.isManifestV3){const r=(0,B.setupMultiplex)(t);r.ignoreStream(G.METAMASK_EIP_1193_PROVIDER),ye(r.createStream(G.METAMASK_CAIP_MULTICHAIN_PROVIDER),e.sender)}}},Ie=e=>{var t;const n=(null==r||null===(t=r.getPortStream)||void 0===t?void 0:t.call(r,e))||new a.default(e);if(!e.sender.id){if(ie.includes(e.name))return;Le(e),ye((0,S.createCaipStream)(n),e.sender)}else be(n,e.sender)},be=(e,t)=>{ge.setupUntrustedCommunicationEip1193({connectionStream:e,sender:t})},ye=(e,t)=>{ge.setupUntrustedCommunicationCaip({connectionStream:e,sender:t})},null!=r&&r.registerConnectListeners&&r.registerConnectListeners(Te,be),T(),ge.controllerMessenger.subscribe(x.METAMASK_CONTROLLER_EVENTS.DECRYPT_MESSAGE_MANAGER_UPDATE_BADGE,T),ge.controllerMessenger.subscribe(x.METAMASK_CONTROLLER_EVENTS.ENCRYPTION_PUBLIC_KEY_MANAGER_UPDATE_BADGE,T),ge.signatureController.hub.on(x.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,T),ge.controllerMessenger.subscribe(x.METAMASK_CONTROLLER_EVENTS.APP_STATE_UNLOCK_CHANGE,T),ge.controllerMessenger.subscribe(x.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,T),ge.controllerMessenger.subscribe(x.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_LIST_UPDATED,T),ge.controllerMessenger.subscribe(x.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_MARK_AS_READ,T),le.on(M.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,({automaticallyClosed:e})=>{e?I()>0&&De():(ge.signatureController.rejectUnapproved(h.REJECT_NOTIFICATION_CLOSE_SIG),ge.decryptMessageController.rejectUnapproved(h.REJECT_NOTIFICATION_CLOSE),ge.encryptionPublicKeyController.rejectUnapproved(h.REJECT_NOTIFICATION_CLOSE),ge.rejectAllPendingApprovals()),T()}),Object.values(ge.snapController.state.snaps).some(e=>!e.preinstalled)&&ge.snapController.updateBlockedSnaps()}async function De(){const e=await ae.getActiveTabs(),t=Boolean(e.find(e=>pe[e.id])),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!fe&&(r||0===de)&&!t){fe=!0;try{const e=ge.appStateController.getCurrentPopupId();await le.showPopup(e=>ge.appStateController.setCurrentPopupId(e),e)}finally{fe=!1}}}const Be=()=>{if(ge)return ge.metaMetricsController.updateTraits({[h.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void ge.metaMetricsController.addEventBeforeMetricsOptIn({category:h.MetaMetricsEventCategory.App,event:h.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout(()=>{Be()},500)};function Fe(e){"install"===e.reason?(o.default.debug("First install detected"),Be(),ae.openExtensionInBrowser()):"update"===e.reason&&e.previousVersion&&e.previousVersion!==ae.getVersion()&&async function(){await Ae,o.default.debug("Update installation detected"),ge.appStateController.setLastUpdatedAt(Date.now())}()}async function je(e){s.default.tabs.onActivated.addListener(e=>{if(ge){const{tabId:t}=e,r=me[t],n=Ee[t];r&&ge.permissionController.state.subjects[r]!==undefined&&xe(r),n===T.HYPERLIQUID_ORIGIN&&ge.permissionController.state.subjects[n]!==undefined&&ge.handleHyperliquidReferral(t,$.HyperliquidPermissionTriggerType.OnNavigateConnectedTab).catch(e=>{o.default.error("Failed to handle Hyperliquid referral after navigation to connected tab: ",e)})}});try{await Oe(e),re.cleanUpMostRecentRetrievedState(),o.default.info("MetaMask initialization complete."),Pe()}catch(e){o.default.error(e),ve(e)}}s.default.runtime.onUpdateAvailable.addListener(async function(){await Ae,o.default.debug("An update is available"),ge.appStateController.setIsUpdateAvailable(!0)}),je(null)}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});